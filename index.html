<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4169e1">
    <meta name="apple-mobile-web-app-title" content="TAU Africa">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>TAU AFRICA INTERNATIONAL</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <style>
        /* Safari/iOS Compatibility Fixes */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        body {
            -webkit-overflow-scrolling: touch;
            overflow-scrolling: touch;
        }

        button, input[type="submit"], input[type="button"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        input, select, textarea {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 10px;
        }

        .modal {
            -webkit-overflow-scrolling: touch;
            overflow-scrolling: touch;
        }

        .modal-content {
            -webkit-overflow-scrolling: touch;
            overflow-scrolling: touch;
        }

        input[type="date"] {
            -webkit-appearance: none;
            appearance: none;
            min-height: 44px;
        }

        .btn, .level-btn, .house-btn, .corporate-btn {
            cursor: pointer;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298, #87ceeb);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #000080, #4169e1, #87ceeb);
            color: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .emancipation-scroll {
            position: absolute;
            bottom: 5px;
            left: 0;
            width: 100%;
            height: 20px;
            overflow: hidden;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 10px;
        }

        .emancipation-text {
            display: inline-block;
            white-space: nowrap;
            font-size: 12px;
            font-weight: bold;
            color: #ffd700;
            animation: scrollText 15s linear infinite;
            line-height: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        @keyframes scrollText {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .logo {
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, #87ceeb, #4169e1);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            border: 4px solid #ffd700;
        }

        .main-title {
            font-size: 2.8rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            letter-spacing: 2px;
        }

        .vision {
            font-size: 1.2rem;
            font-style: italic;
            opacity: 0.9;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .social-link {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .social-link:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .wings-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .wing {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .wing:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .auffi {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
        }

        .valenta {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .wing-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .wing-description {
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .houses-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .house-btn, .corporate-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: bold;
        }

        .house-btn:hover, .corporate-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .galaxy-banner {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            margin-top: 15px;
        }

        .main-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }

        .section:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2a5298;
            margin-bottom: 15px;
            text-align: center;
        }

        .btn {
            background: linear-gradient(45deg, #4169e1, #87ceeb);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-block;
            text-decoration: none;
        }

        .btn:hover {
            background: linear-gradient(45deg, #2a5298, #4169e1);
            transform: scale(1.05);
        }

        .btn-register {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            font-size: 1.1rem;
            padding: 15px 30px;
        }

        .btn-kabiru {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            font-weight: bold;
            width: 100%;
            padding: 15px;
            margin-top: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 95vh;
            overflow-y: auto;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 15px;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2a5298;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #4169e1;
            outline: none;
        }

        .payment-info {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .level-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .level-btn {
            padding: 10px;
            border: 2px solid #4169e1;
            background: rgba(65, 105, 225, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .level-btn.selected {
            background: #4169e1;
            color: white;
        }

        .kabiru-section {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            text-align: center;
            padding: 30px;
            border-radius: 20px;
            margin-top: 30px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1001;
            display: none;
            max-width: 350px;
        }

        .success { background: #2ecc71; }
        .error { background: #e74c3c; }
        .info { background: #3498db; }

        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #4169e1, #87ceeb);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .ai-assistant {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 100;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        .ai-chat-window {
            position: fixed;
            bottom: 170px;
            right: 30px;
            width: 350px;
            height: 450px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
            flex-direction: column;
            z-index: 200;
        }

        .ai-chat-header {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 15px 20px;
            border-radius: 20px 20px 0 0;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 300px;
        }

        .ai-message {
            background: #f0f0f0;
            padding: 10px 15px;
            border-radius: 15px;
            margin: 10px 0;
            max-width: 80%;
        }

        .user-message {
            background: linear-gradient(45deg, #4169e1, #87ceeb);
            color: white;
            margin-left: auto;
        }

        .ai-chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid #eee;
        }

        .ai-chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }

        .ai-chat-input button {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            margin-left: 10px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .wings-container {
                grid-template-columns: 1fr;
            }
            
            .main-title {
                font-size: 2rem;
            }
            
            .houses-grid {
                grid-template-columns: 1fr;
            }
            
            .ai-chat-window {
                width: 90%;
                right: 5%;
                left: 5%;
            }
            
            .social-links {
                gap: 10px;
            }
            
            .social-link {
                font-size: 12px;
                padding: 6px 12px;
            }
        }
        
        .btn-small {
            padding: 10px 15px;
            font-size: 14px;
            min-width: 120px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">üåç TAU</div>
            <h1 class="main-title">TAU AFRICA INTERNATIONAL</h1>
            <p class="vision">Community ‚Ä¢ Value ‚Ä¢ Corporate ‚Ä¢ Sovereignty</p>
            
            <!-- Social Media Links -->
            <div class="social-links">
                <a href="https://x.com/grouptauafrica?t=pFlJ-gky_A7Dp3e0lbZ5Sg&s=09" target="_blank" class="social-link">
                    üê¶ Twitter/X
                </a>
                <a href="https://www.tiktok.com/@tau.africa.nairob?_t=ZM-8zwbvmFtmt2&_r=1" target="_blank" class="social-link">
                    üéµ TikTok
                </a>
                <a href="https://youtube.com/@tauafrica8922?si=wwgxc2AvYHYwsHTh" target="_blank" class="social-link">
                    üì∫ YouTube
                </a>
                <span class="social-link" style="opacity: 0.7;">
                    üìò Facebook (Coming Soon)
                </span>
            </div>
            
            <div class="emancipation-scroll">
                <div class="emancipation-text">EMANCIPATION PROCLAMATIONS ‚Ä¢ FREEDOM FOR ALL AFRICANS ‚Ä¢ UNITY IN DIVERSITY ‚Ä¢ ECONOMIC LIBERATION ‚Ä¢ SPIRITUAL AWAKENING ‚Ä¢ SOCIAL JUSTICE</div>
            </div>
        </div>

        <!-- Two Wings -->
        <div class="wings-container">
            <!-- AUFFI Wing -->
            <div class="wing auffi">
                <h2 class="wing-title">üåç AUFFI</h2>
                <p class="wing-description">Africa Unity Freedom Fund Initiative. The Pan African Digital value Currency for uniting and awakening Africa socially, economically and spiritually. A movement that return Oloo's Sovereignty back home to Africa, bringing together the children of Oloo and the Galaxy restoration to rebuild Africa</p>
                
                <div class="houses-grid">
                    <div class="house-btn" onclick="showNotification('Galaxy 0 house - join with G0 Card!', 'success')">Galaxy 0 [Secretariat Board G0]</div>
                    <div class="house-btn" onclick="showNotification('Galaxy 1 house - join with G1 Card!', 'success')">Galaxy 1 [Representative Board]</div>
                    <div class="house-btn" onclick="showNotification('Galaxy 2 house - join with G2 Card!', 'success')">Galaxy 2 [Coordination Board]</div>
                    <div class="house-btn" onclick="showNotification('Galaxy 3 house - join with G3 Card!', 'success')">Galaxy 3 [Implementation Board]</div>
                </div>
                
                <div class="galaxy-banner">
                    Auffi - Pan African Trust Graph & R4<br> [REPARTRIATION - RESURRECTION-RESTORATION - RECONNECTION] (sovereignty). Our digital Ecosystem uses human & environmental values to create the Africa's Sovereign Wealth, and subsequently bring back Sovereignty to black people and humanity. join the Kabiru Mining App to mine your values in building The African digital currency (Kabiru)
                </div>
                
                <button class="btn" onclick="openModal('parSirai')">Par Sirai Center</button>
            </div>

            <!-- Valenta Wing -->
            <div class="wing valenta">
                <h2 class="wing-title">üè¢ VALENTA</h2>
                <p class="wing-description">Value Enter Africa - Our Corporate Holding company, building Kabiru Digital currency for Africa value harnessing, erecting a sustainable Kabiru digital ecosystem, & Empowering African communities through Education - Economic and Social Literacy. Come let us build our sovereignty together, and make Africa great again</p>

                <div class="houses-grid">
                    <div class="corporate-btn" onclick="openModal('corporate')">Corporate company</div>
                    <div class="corporate-btn" onclick="openModal('trustGraph')">Generation Trust Graph</div>
                    <div class="corporate-btn" onclick="openModal('foundation')">Family Foundation</div>
                    <div class="corporate-btn" onclick="openModal('holdings')">Holding Company</div>
                </div>
            </div>
        </div>

        <!-- Main Sections -->
        <div class="main-sections">
            <!-- Membership Registration -->
            <div class="section">
                <h3 class="section-title">üë• MEMBERSHIP</h3>
                <p>Join our community through TASK & TALK teams</p>
                <button class="btn btn-register" onclick="openModal('taskRegistration')">Join TASK Team</button>
                <button class="btn btn-register" onclick="openModal('talkRegistration')">Join TALK Team</button>
                <p style="margin-top: 15px; font-weight: bold; color: #e74c3c;">TASK Fee: KSH 500 | TALK Fee: KSH 2,000</p>
            </div>

            <!-- Value Submission -->
            <div class="section">
                <h3 class="section-title">üíé SUBMIT VALUE</h3>
                <p>Submit products, services, skills, labour, or time</p>
                <button class="btn" onclick="openValueSubmissionModal()">Submit Your Value</button>
                <p style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                    Earn iKb when your value is validated!
                </p>
            </div>
            
            <!-- Activity Area -->
            <div class="section">
                <h3 class="section-title">üìö ACTIVITIES</h3>
                <p>Training workshops, job creation & research services</p>
                <button class="btn" onclick="openModal('training')">Join member training</button>
                <button class="btn" onclick="openModal('workshop')">Host corporate Workshop</button>
                <button class="btn" onclick="openModal('research')">Research Services</button>
                <button class="btn" onclick="openModal('jobCreation')">Job Creation workshop</button>
            </div>

            <!-- Jobs Area -->
            <div class="section">
                <h3 class="section-title">üíº TASKS</h3>
                <p>Connect job seekers with verified opportunities</p>
                <button class="btn" onclick="openModal('insertJob')">Insert value</button>
                <button class="btn" onclick="openModal('retrieveJob')">Search value</button>
                <button class="btn" onclick="openModal('availableJobs')">Browse value</button>
                <button class="btn" onclick="openModal('applyJob')">seek value</button>
            </div>

            <!-- Community -->
            <div class="section">
                <h3 class="section-title">ü§ù COMMUNITY</h3>
                <p>Community support programs</p>
                <button class="btn" onclick="openModal('community')">Join Programs</button>
                <div style="margin-top: 10px; font-size: 0.9rem;">
                    Agriculture ‚Ä¢ Climate ‚Ä¢ Environment<br>
                    Water & Sanitation ‚Ä¢ Education ‚Ä¢ Child Care
                </div>
            </div>

            <!-- Interactive Forum -->
            <div class="section">
                <h3 class="section-title">üí¨ MEMBER FORUM</h3>
                <p>Connect, share ideas, and collaborate with fellow members</p>
                <button class="btn" onclick="openModal('forum')">Access Forum</button>
                <div style="margin-top: 10px; font-size: 0.9rem;">
                    Discussions ‚Ä¢ Job Sharing ‚Ä¢ Training Materials<br>
                    Voice Calls ‚Ä¢ Messaging ‚Ä¢ Networking
                </div>
            </div>
        </div>

        <!-- Public Opportunities Section -->
        <div class="main-sections" style="margin-top: 40px;">
            <div class="section" style="grid-column: 1 / -1;">
                <h3 class="section-title">üéØ AVAILABLE OPPORTUNITIES</h3>
                <p style="text-align: center; margin-bottom: 20px;">Complete these to earn iKbp and iKb!</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; max-width: 400px; margin-left: auto; margin-right: auto;">
                    <button class="btn btn-small" onclick="filterOpportunities('all')" id="filter-all">All</button>
                    <button class="btn btn-small" onclick="filterOpportunities('activities')" id="filter-activities">Activities</button>
                    <button class="btn btn-small" onclick="filterOpportunities('tasks')" id="filter-tasks">Tasks</button>
                    <button class="btn btn-small" onclick="filterOpportunities('values')" id="filter-values">Values</button>
                </div>
                
                <div id="publicOpportunitiesContainer"></div>
            </div>
        </div>

        <!-- Kabiru Mining Section -->
        <div class="kabiru-section">
            <h2>‚ö° KABIRU MINING</h2>
            <p>Mine Kabiru coins by proving and validating real values</p>
            <button class="btn-kabiru" onclick="window.open('https://magero1985.github.io/Kabiru-Mining-Portal-/', '_blank')">Access Kabiru Mining App</button>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Notification Bell Icon -->
    <div id="tauNotificationBell" style="position: fixed; top: 20px; right: 80px; z-index: 1000;">
        <button onclick="openTauNotifications()" style="background: #667eea; color: white; border: none; padding: 12px; border-radius: 50%; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2); position: relative;">
            üîî
            <span id="tauNotifBadge" style="display: none; position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 10px; line-height: 20px; text-align: center;">0</span>
        </button>
    </div>

    <!-- Notification Panel -->
    <div id="tauNotificationPanel" style="display: none; position: fixed; top: 70px; right: 20px; width: 350px; max-height: 500px; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000; overflow-y: auto;">
        <div style="padding: 20px; border-bottom: 2px solid #eee;">
            <h3 style="margin: 0;">üîî Notifications</h3>
        </div>
        <div id="tauNotificationList" style="padding: 10px;"></div>
    </div>

    <!-- Floating Member Access Button -->
    <div class="floating-btn" onclick="showMemberLogin()" title="Member Access">üë§</div>

    <!-- AI Assistant -->
    <div class="ai-assistant" onclick="toggleAIChat()" title="AI Assistant - Get Help">ü§ñ</div>

    <!-- AI Chat Window -->
    <div class="ai-chat-window" id="aiChatWindow">
        <div class="ai-chat-header">
            <span>TAU AI Assistant</span>
            <span onclick="toggleAIChat()" style="cursor: pointer;">‚úñ</span>
        </div>
        <div class="ai-chat-messages" id="aiChatMessages">
            <div class="ai-message">
                Hello! I'm your TAU Africa AI assistant. I can help you with:
                <br>‚Ä¢ Navigating the app
                <br>‚Ä¢ Understanding registration process
                <br>‚Ä¢ Payment procedures
                <br>‚Ä¢ Technical support
                <br>‚Ä¢ General questions about TAU Africa
                <br><br>How can I assist you today?
            </div>
        </div>
        <div class="ai-chat-input">
            <input type="text" id="aiChatInput" placeholder="Ask me anything..." onkeypress="handleAIChatKeyPress(event)">
            <button onclick="sendAIMessage()">‚û§</button>
        </div>
    </div>

    <script>
        // ============================================
        // INITIALIZE EMAILJS
        // ============================================
        (function() {
            try {
                emailjs.init({ publicKey: "GhjI14eQVGgOli0j1" });
                console.log('‚úÖ EmailJS initialized');
            } catch (error) {
                console.error('‚ùå EmailJS init failed:', error);
            }
        })();

        // ============================================
        // FIREBASE INITIALIZATION
        // ============================================
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyAW0vk_gg03xXEm6I1TQnU8KRiv1RhcrQ4",
            authDomain: "tau-africa-ecosystem.firebaseapp.com",
            projectId: "tau-africa-ecosystem",
            storageBucket: "tau-africa-ecosystem.firebasestorage.app",
            messagingSenderId: "1047279398196",
            appId: "1:1047279398196:web:06d43661650c794268c961"
        };

        let db, auth, isOnline = false;

        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(FIREBASE_CONFIG);
            }
            db = firebase.firestore();
            auth = firebase.auth();
            isOnline = true;
            console.log('‚úÖ Firebase initialized');
        } catch (error) {
            console.error('‚ö†Ô∏è Firebase initialization failed:', error);
            db = null;
            auth = null;
            isOnline = false;
        }

        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let selectedLevel = null;
        let selectedCategory = null;
        let currentModal = null;
        let currentFilter = 'all';

        // ============================================
        // NOTIFICATION SYSTEM
        // ============================================
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            if (window.notificationTimeout) {
                clearTimeout(window.notificationTimeout);
            }
            
            const duration = type === 'info' ? 3000 : type === 'error' ? 8000 : 6000;
            
            window.notificationTimeout = setTimeout(() => {
                notification.style.display = 'none';
            }, duration);
            
            console.log(`üì¢ Notification [${type}]: ${message}`);
        }

        // ============================================
        // MODAL MANAGEMENT
        // ============================================
        function openModal(type) {
            closeAllModals();
            
            const modalContent = getModalContent(type);
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = modalContent;
            document.body.appendChild(modal);
            currentModal = modal;
        }

        function closeAllModals() {
            const modals = document.querySelectorAll('.modal, .payment-modal');
            modals.forEach(modal => modal.remove());
            currentModal = null;
        }

        // Click outside modal to close
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                closeAllModals();
            }
        });

        // ESC key to close
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeAllModals();
                document.getElementById('aiChatWindow').style.display = 'none';
            }
        });

        // ============================================
        // LEVEL & CATEGORY SELECTION
        // ============================================
        function selectLevel(level, element) {
            const buttons = document.querySelectorAll('.level-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            const target = element || (window.event && window.event.target);
            if (target) {
                target.classList.add('selected');
            }
            selectedLevel = level;
            const levelInput = document.getElementById('supportLevel');
            if (levelInput) levelInput.value = level;
            
            const enhanced = document.getElementById('enhancedRequirements');
            if (enhanced && (level === 'middle' || level === 'upper' || level === 'high' || level === 'top')) {
                enhanced.style.display = 'block';
            }
        }

        function selectCategory(category, element) {
            const buttons = document.querySelectorAll('.level-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            const target = element || (window.event && window.event.target);
            if (target) {
                target.classList.add('selected');
            }
            selectedCategory = category;
            const categoryInput = document.getElementById('taskCategory');
            if (categoryInput) categoryInput.value = category;
        }

        // ============================================
        // AI ASSISTANT FUNCTIONS
        // ============================================
        function toggleAIChat() {
            const chatWindow = document.getElementById('aiChatWindow');
            if (chatWindow.style.display === 'none' || !chatWindow.style.display) {
                chatWindow.style.display = 'flex';
            } else {
                chatWindow.style.display = 'none';
            }
        }

        function handleAIChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendAIMessage();
            }
        }

        function sendAIMessage() {
            const input = document.getElementById('aiChatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const messagesContainer = document.getElementById('aiChatMessages');
            
            const userMessage = document.createElement('div');
            userMessage.className = 'ai-message user-message';
            userMessage.textContent = message;
            messagesContainer.appendChild(userMessage);
            
            input.value = '';
            
            setTimeout(() => {
                const aiResponse = generateAIResponse(message);
                const aiMessage = document.createElement('div');
                aiMessage.className = 'ai-message';
                aiMessage.innerHTML = aiResponse;
                messagesContainer.appendChild(aiMessage);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 1000);
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function generateAIResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            if (message.includes('register') || message.includes('join')) {
                return `To register with TAU Africa, you can choose between:<br>
                ‚Ä¢ <strong>TASK Team (KSH 500)</strong> - For service providers and skilled professionals<br>
                ‚Ä¢ <strong>TALK Team (KSH 2,000)</strong> - For investors and financial supporters<br>
                ‚Ä¢ <strong>Job Creation Training (KSH 1,500)</strong> - For aspiring entrepreneurs<br>
                <br>Click the relevant buttons in the Membership section to get started!`;
            }
            
            if (message.includes('payment') || message.includes('mpesa')) {
                return `Our payment process uses M-PESA:<br>
                1. Enter your M-PESA number (254XXXXXXXXX format)<br>
                2. You'll receive a payment prompt on your phone<br>
                3. Enter your M-PESA PIN to confirm<br>
                4. Wait for confirmation<br>
                <br>All payments are secure and processed instantly!`;
            }
            
            if (message.includes('kabiru') || message.includes('mining')) {
                return `Kabiru is our digital currency! You can:<br>
                ‚Ä¢ Mine Kabiru by validating real values in the community<br>
                ‚Ä¢ Use the mining portal<br>
                ‚Ä¢ Earn through community contributions<br>
                ‚Ä¢ Convert to other currencies through our ecosystem`;
            }
            
            if (message.includes('help') || message.includes('support')) {
                return `I'm here to help! You can ask me about:<br>
                ‚Ä¢ Registration processes and payments<br>
                ‚Ä¢ Kabiru mining and digital currency<br>
                ‚Ä¢ Community programs and training<br>
                ‚Ä¢ Technical issues with the app<br>
                ‚Ä¢ Business registration services<br>
                <br>What specific area would you like help with?`;
            }
            
            return `Thank you for your question! Here are some ways I can help:<br>
            ‚Ä¢ Registration and membership information<br>
            ‚Ä¢ Payment and M-PESA guidance<br>
            ‚Ä¢ Kabiru mining and digital currency<br>
            ‚Ä¢ Community programs and forum access<br>
            ‚Ä¢ Technical support<br>
            <br>Please ask a specific question, or contact <strong>grouptauafrica@gmail.com</strong> for detailed support.`;
        }

        // ============================================
        // CORE DATABASE FUNCTIONS
        // ============================================
        function generateMemberID(team, referralCode = null) {
            const prefix = team === 'TASK' ? 'TSK' : team === 'TALK' ? 'TLK' : 'JOB';
            const timestamp = Date.now().toString().slice(-6);
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            const id = `${prefix}-${timestamp}-${random}`;
            
            if (referralCode) {
                trackReferral(referralCode, id);
            }
            
            return id;
        }

        function generateReferralCode(memberId) {
            return btoa(memberId).substring(0, 8).toUpperCase();
        }

        function trackReferral(referralCode, newMemberId) {
            try {
                const referrals = JSON.parse(localStorage.getItem('tauReferrals') || '{}');
                const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
                const referrer = members.find(m => m.referralCode === referralCode);
                
                if (referrer) {
                    if (!referrals[referrer.id]) {
                        referrals[referrer.id] = {
                            memberId: referrer.id,
                            referredMembers: [],
                            totalEarnings: 0
                        };
                    }
                    
                    const earnings = 500;
                    referrals[referrer.id].referredMembers.push({
                        memberId: newMemberId,
                        date: new Date().toISOString(),
                        earnings: earnings
                    });
                    referrals[referrer.id].totalEarnings += earnings;
                    
                    localStorage.setItem('tauReferrals', JSON.stringify(referrals));
                    updateMemberBalance(referrer.id, earnings);
                    
                    console.log(`‚úÖ Referral tracked: ${referrer.id} earned ${earnings} iKbp`);
                }
            } catch (error) {
                console.error('Referral tracking error:', error);
            }
        }

        function updateMemberBalance(memberId, amount) {
            try {
                const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
                const memberIndex = members.findIndex(m => m.id === memberId);
                
                if (memberIndex !== -1) {
                    members[memberIndex].iKbpBalance = (members[memberIndex].iKbpBalance || 0) + amount;
                    localStorage.setItem('tauAfricaDB', JSON.stringify(members));
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Balance update error:', error);
                return false;
            }
        }

        function checkReferralCode() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('ref');
        }

        // ============================================
        // TAU DATABASE CONNECTOR
        // ============================================
        window.TauDB = {
            sync: function(formData, team, referralCode = null) {
                try {
                    const existingMembers = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
                    
                    const memberId = generateMemberID(team, referralCode);
                    const memberReferralCode = generateReferralCode(memberId);
                    
                    const member = {
                        id: memberId,
                        referralCode: memberReferralCode,
                        team: team,
                        fullName: formData.fullName || formData.name,
                        email: formData.email,
                        phone: formData.phone,
                        location: formData.location,
                        paymentStatus: 'Paid',
                        dateJoined: new Date().toISOString().split('T')[0],
                        status: 'Active',
                        fee: team === 'TASK' ? 500 : team === 'TALK' ? 2000 : 1500,
                        accountCreated: new Date().toISOString(),
                        lastLogin: null,
                        activities: [],
                        tasks: [],
                        jobs: [],
                        forumPosts: [],
                        iKbpBalance: 500,
                        iKbBalance: 0,
                        referredBy: referralCode || null
                    };
                    
                    Object.keys(formData).forEach(key => {
                        if (!member[key]) {
                            member[key] = formData[key];
                        }
                    });
                    
                    existingMembers.push(member);
                    localStorage.setItem('tauAfricaDB', JSON.stringify(existingMembers));
                    
                    // Store credentials
                    const credentials = JSON.parse(localStorage.getItem('tauCredentials') || '{}');
                    credentials[member.id] = {
                        email: member.email,
                        phone: member.phone.slice(-4),
                        fullName: member.fullName
                    };
                    localStorage.setItem('tauCredentials', JSON.stringify(credentials));
                    
                    window.dispatchEvent(new CustomEvent('tauMemberAdded', { detail: member }));
                    
                    console.log('‚úÖ Member synced to database:', memberId);
                    return { success: true, memberId, member };
                    
                } catch (error) {
                    console.error('‚ùå Database sync error:', error);
                    return { success: false, error: error.message };
                }
            },
            
            authenticate: function(identifier, phoneLastFour) {
                try {
                    const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
                    const member = members.find(m => 
                        (m.id === identifier || m.email === identifier) && 
                        m.phone.slice(-4) === phoneLastFour
                    );
                    
                    if (member) {
                        member.lastLogin = new Date().toISOString();
                        const memberIndex = members.findIndex(m => m.id === member.id);
                        members[memberIndex] = member;
                        localStorage.setItem('tauAfricaDB', JSON.stringify(members));
                        sessionStorage.setItem('tauCurrentUser', JSON.stringify(member));
                        return { success: true, member };
                    }
                    
                    return { success: false, error: 'Invalid credentials' };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            getCurrentMember: function() {
                const sessionData = sessionStorage.getItem('tauCurrentUser');
                if (sessionData) {
                    const member = JSON.parse(sessionData);
                    const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
                    const freshMember = members.find(m => m.id === member.id);
                    if (freshMember) {
                        sessionStorage.setItem('tauCurrentUser', JSON.stringify(freshMember));
                        return freshMember;
                    }
                }
                return null;
            },
            
            logout: function() {
                sessionStorage.removeItem('tauCurrentUser');
                return true;
            },
            
            addActivity: function(memberId, activity) {
                try {
                    const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
                    const memberIndex = members.findIndex(m => m.id === memberId);
                    
                    if (memberIndex !== -1) {
                        const activityRecord = {
                            id: `ACT-${Date.now()}`,
                            type: activity.type,
                            title: activity.title,
                            description: activity.description,
                            dateAdded: new Date().toISOString(),
                            status: 'Active',
                            iKbpReward: activity.reward || 100
                        };
                        
                        members[memberIndex].activities.push(activityRecord);
                        members[memberIndex].iKbpBalance += activityRecord.iKbpReward;
                        localStorage.setItem('tauAfricaDB', JSON.stringify(members));
                        
                        return { 
                            success: true, 
                            activity: activityRecord,
                            newBalance: members[memberIndex].iKbpBalance,
                            earned: activityRecord.iKbpReward
                        };
                    }
                    
                    return { success: false, error: 'Member not found' };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            addTask: function(memberId, task) {
                try {
                    const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
                    const memberIndex = members.findIndex(m => m.id === memberId);
                    
                    if (memberIndex !== -1) {
                        const taskRecord = {
                            id: `TSK-${Date.now()}`,
                            title: task.title,
                            description: task.description,
                            category: task.category,
                            dateAssigned: new Date().toISOString(),
                            dueDate: task.dueDate || null,
                            status: 'Assigned',
                            iKbpReward: task.reward || 200,
                            completedDate: null
                        };
                        
                        members[memberIndex].tasks.push(taskRecord);
                        localStorage.setItem('tauAfricaDB', JSON.stringify(members));
                        return { success: true, task: taskRecord };
                    }
                    
                    return { success: false, error: 'Member not found' };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            completeTask: function(memberId, taskId) {
                try {
                    const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
                    const memberIndex = members.findIndex(m => m.id === memberId);
                    
                    if (memberIndex !== -1) {
                        const task = members[memberIndex].tasks.find(t => t.id === taskId);
                        
                        if (task && task.status !== 'Completed') {
                            task.status = 'Completed';
                            task.completedDate = new Date().toISOString();
                            members[memberIndex].iKbpBalance += task.iKbpReward;
                            localStorage.setItem('tauAfricaDB', JSON.stringify(members));
                            
                            return { 
                                success: true, 
                                task, 
                                newBalance: members[memberIndex].iKbpBalance,
                                earned: task.iKbpReward
                            };
                        }
                    }
                    
                    return { success: false, error: 'Task not found or already completed' };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            },
            
            updateBalance: updateMemberBalance,
            checkReferralCode: checkReferralCode
        };

        // ============================================
        // EMAIL FUNCTIONS
        // ============================================
        const EMAIL_CONFIG = {
            serviceId: 'service_xfira7g',
            templateId: 'template_bqxztig',
            publicKey: 'GhjI14eQVGgOli0j1',
            adminEmail: 'grouptauafrica@gmail.com'
        };

        async function sendEmailToAdmin(formData, subject) {
            console.log('üìß Sending admin email...', { subject, email: formData.email });
            
            if (typeof emailjs === 'undefined') {
                console.error('‚ùå EmailJS not available');
                return false;
            }
            
            const templateParams = {
                to_name: 'TAU Africa Admin',
                to_email: EMAIL_CONFIG.adminEmail,
                from_name: formData.fullName || formData.name || 'New Member',
                subject: subject,
                message: `
NEW REGISTRATION RECEIVED
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üë§ Name: ${formData.fullName || formData.name}
üìß Email: ${formData.email}
üì± Phone: ${formData.phone}
üìç Location: ${formData.location}
üë• Team: ${formData.team || 'N/A'}
üí∞ Fee: KSH ${formData.fee || (formData.team === 'TASK' ? '500' : formData.team === 'TALK' ? '2,000' : '1,500')}
üìÖ Date: ${new Date().toLocaleString()}

Status: PAID ‚úÖ
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

TAU Africa System
                `.trim()
            };
            
            try {
                const response = await emailjs.send(EMAIL_CONFIG.serviceId, EMAIL_CONFIG.templateId, templateParams);
                console.log('‚úÖ Admin email sent:', response.status);
                return true;
            } catch (error) {
                console.error('‚ùå Admin email failed:', error);
                return false;
            }
        }

        async function sendWelcomeEmail(formData) {
            console.log('üìß Sending welcome email...', { email: formData.email });
            
            if (typeof emailjs === 'undefined') {
                console.error('‚ùå EmailJS not available');
                return false;
            }
            
            const memberId = formData.id || generateMemberID(formData.team || 'TASK');
            const referralCode = formData.referralCode || generateReferralCode(memberId);
            
            const templateParams = {
                to_name: formData.fullName || formData.name || 'Member',
                to_email: formData.email,
                from_name: 'TAU Africa',
                subject: 'üéâ Welcome to TAU Africa International!',
                message: `
Dear ${formData.fullName || formData.name},

üéâ WELCOME TO TAU AFRICA! üéâ

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
YOUR MEMBERSHIP DETAILS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üë§ Member ID: ${memberId}
üìß Email: ${formData.email}
üì± Phone: ${formData.phone}
üìç Location: ${formData.location}
üë• Team: ${formData.team || 'TASK'}
üí∞ Registration Fee: KSH ${formData.fee || (formData.team === 'TASK' ? '500' : formData.team === 'TALK' ? '2,000' : '1,500')} ‚úÖ PAID

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
YOUR BENEFITS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üéÅ Welcome Bonus: 500 iKbp (automatically credited!)
üîë Referral Code: ${referralCode}
   Share to earn 500 iKbp per referral!

üíé Start earning:
   ‚Ä¢ Complete activities: 50-500 iKbp
   ‚Ä¢ Complete tasks: 100-5000 iKbp
   ‚Ä¢ Submit values: Earn iKb

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
NEXT STEPS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

1. Login with your Member ID or Email
2. Complete your first activity (earn 100 iKbp!)
3. Share your referral code
4. Explore the Kabiru Mining App

üåê Access your dashboard:
   ${window.location.origin}

üìß Need help? Contact:
   grouptauafrica@gmail.com

Welcome to the TAU Africa family!

Best regards,
TAU Africa Team
üåç Building Africa's Digital Future
                `.trim()
            };
            
            try {
                const response = await emailjs.send(EMAIL_CONFIG.serviceId, EMAIL_CONFIG.templateId, templateParams);
                console.log('‚úÖ Welcome email sent:', response.status);
                return true;
            } catch (error) {
                console.error('‚ùå Welcome email failed:', error);
                return false;
            }
        }

        window.sendEmailToAdmin = sendEmailToAdmin;
        window.sendWelcomeEmail = sendWelcomeEmail;

        // ============================================
        // NOTIFICATION CREATION
        // ============================================
        function createNotification(memberId, title, message, type = 'info') {
            const NOTIF_KEY = 'tauNotifications';
            const allNotifications = JSON.parse(localStorage.getItem(NOTIF_KEY) || '{}');
            
            if (!allNotifications[memberId]) {
                allNotifications[memberId] = [];
            }
            
            const notification = {
                id: `NOTIF-${Date.now()}`,
                title: title,
                message: message,
                timestamp: new Date().toISOString(),
                read: false,
                type: type
            };
            
            allNotifications[memberId].unshift(notification);
            
            if (allNotifications[memberId].length > 50) {
                allNotifications[memberId] = allNotifications[memberId].slice(0, 50);
            }
            
            localStorage.setItem(NOTIF_KEY, JSON.stringify(allNotifications));
            console.log(`üì¨ Notification created for ${memberId}:`, title);
            
            updateNotificationBadge();
            
            return notification;
        }

        function updateNotificationBadge() {
            const currentMember = window.TauDB?.getCurrentMember();
            if (!currentMember) return;
            
            const notifs = JSON.parse(localStorage.getItem('tauNotifications') || '{}');
            const memberNotifs = notifs[currentMember.id] || [];
            const unread = memberNotifs.filter(n => !n.read).length;
            
            const badge = document.getElementById('tauNotifBadge');
            if (badge) {
                if (unread > 0) {
                    badge.style.display = 'block';
                    badge.textContent = unread;
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        function openTauNotifications() {
            const panel = document.getElementById('tauNotificationPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            loadNotifications();
        }

        function loadNotifications() {
            const currentMember = window.TauDB?.getCurrentMember();
            if (!currentMember) {
                document.getElementById('tauNotificationList').innerHTML = 
                    '<p style="text-align: center; color: #666;">Please login to view notifications</p>';
                return;
            }
            
            const allNotifications = JSON.parse(localStorage.getItem('tauNotifications') || '{}');
            const memberNotifs = allNotifications[currentMember.id] || [];
            
            const list = document.getElementById('tauNotificationList');
            if (memberNotifs.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No notifications yet</p>';
                return;
            }
            
            list.innerHTML = memberNotifs.map(notif => `
                <div style="padding: 15px; border-bottom: 1px solid #eee; background: ${notif.read ? '#fff' : '#f0f4ff'}; border-left: 4px solid ${notif.read ? '#ddd' : '#667eea'};">
                    <strong>${notif.title}</strong>
                    <p style="margin: 5px 0; font-size: 14px; color: #666;">${notif.message}</p>
                    <small style="color: #999;">${new Date(notif.timestamp).toLocaleString()}</small>
                    ${!notif.read ? `<button onclick="markNotificationRead('${notif.id}')" style="margin-top: 8px; background: #667eea; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px;">Mark as read</button>` : ''}
                </div>
            `).join('');
        }

        function markNotificationRead(notifId) {
            const currentMember = window.TauDB?.getCurrentMember();
            if (!currentMember) return;
            
            const allNotifications = JSON.parse(localStorage.getItem('tauNotifications') || '{}');
            if (allNotifications[currentMember.id]) {
                const notif = allNotifications[currentMember.id].find(n => n.id === notifId);
                if (notif) notif.read = true;
                localStorage.setItem('tauNotifications', JSON.stringify(allNotifications));
                loadNotifications();
                updateNotificationBadge();
            }
        }

        window.createNotification = createNotification;
        window.openTauNotifications = openTauNotifications;
        window.markNotificationRead = markNotificationRead;

        // ============================================
        // REGISTRATION SUCCESS HANDLERS
        // ============================================
        async function processTaskSuccess(formData) {
            console.log('üéØ Processing TASK registration...', formData);
            
            formData.team = 'TASK';
            formData.fee = 500;
            
            showNotification('‚è≥ Processing registration...', 'info');
            
            try {
                const referralCode = window.TauDB?.checkReferralCode();
                const syncResult = window.TauDB?.sync(formData, 'TASK', referralCode);
                
                if (!syncResult || !syncResult.success) {
                    throw new Error('Database sync failed');
                }
                
                const member = syncResult.member;
                console.log('‚úÖ Member saved:', member.id);
                
                if (window.TauDB?.updateBalance) {
                    window.TauDB.updateBalance(member.id, 500);
                    console.log('üéÅ Welcome bonus awarded: 500 iKbp');
                }
                
                if (typeof createNotification === 'function') {
                    createNotification(
                        member.id,
                        'üéâ Welcome to TAU Africa!',
                        `Welcome bonus: 500 iKbp credited! Your Member ID: ${member.id}`,
                        'success'
                    );
                }
                
                showNotification('üìß Sending confirmation emails...', 'info');
                
                const emailPromises = [];
                
                if (typeof sendEmailToAdmin === 'function') {
                    emailPromises.push(
                        sendEmailToAdmin(formData, 'NEW TASK REGISTRATION - PAYMENT CONFIRMED')
                            .catch(err => {
                                console.error('Admin email error:', err);
                                return false;
                            })
                    );
                }
                
                if (typeof sendWelcomeEmail === 'function') {
                    emailPromises.push(
                        sendWelcomeEmail(formData)
                            .catch(err => {
                                console.error('Welcome email error:', err);
                                return false;
                            })
                    );
                }
                
                const emailResults = await Promise.all(emailPromises);
                const adminSent = emailResults[0];
                const memberSent = emailResults[1];
                
                let successMessage;
                if (adminSent && memberSent) {
                    successMessage = '‚úÖ Registration complete! Confirmation emails sent to you and admin.';
                } else if (adminSent || memberSent) {
                    successMessage = '‚úÖ Registration complete! One confirmation email sent successfully.';
                } else {
                    successMessage = '‚úÖ Registration complete! Emails may be delayed. Check your inbox in a few minutes.';
                }
                
                showNotification(successMessage, 'success');
                
                setTimeout(() => {
                    closeAllModals();
                    if (typeof showSuccessModal === 'function') showSuccessModal(member);
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå Registration error:', error);
                showNotification('‚ùå Registration failed: ' + error.message, 'error');
            }
        }

        async function processTalkSuccess(formData) {
            console.log('üéØ Processing TALK registration...', formData);
            
            formData.team = 'TALK';
            formData.fee = 2000;
            
            showNotification('‚è≥ Processing registration...', 'info');
            
            try {
                const referralCode = window.TauDB?.checkReferralCode();
                const syncResult = window.TauDB?.sync(formData, 'TALK', referralCode);
                
                if (!syncResult || !syncResult.success) {
                    throw new Error('Database sync failed');
                }
                
                const member = syncResult.member;
                console.log('‚úÖ Member saved:', member.id);
                
                if (window.TauDB?.updateBalance) {
                    window.TauDB.updateBalance(member.id, 500);
                    console.log('üéÅ Welcome bonus awarded: 500 iKbp');
                }
                
                if (typeof createNotification === 'function') {
                    createNotification(
                        member.id,
                        'üéâ Welcome to TAU Africa!',
                        `Welcome bonus: 500 iKbp credited! Your Member ID: ${member.id}`,
                        'success'
                    );
                }
                
                showNotification('üìß Sending confirmation emails...', 'info');
                
                const emailPromises = [];
                
                if (typeof sendEmailToAdmin === 'function') {
                    emailPromises.push(
                        sendEmailToAdmin(formData, 'NEW TALK REGISTRATION - PAYMENT CONFIRMED')
                            .catch(err => {
                                console.error('Admin email error:', err);
                                return false;
                            })
                    );
                }
                
                if (typeof sendWelcomeEmail === 'function') {
                    emailPromises.push(
                        sendWelcomeEmail(formData)
                            .catch(err => {
                                console.error('Welcome email error:', err);
                                return false;
                            })
                    );
                }
                
                const emailResults = await Promise.all(emailPromises);
                const adminSent = emailResults[0];
                const memberSent = emailResults[1];
                
                let successMessage;
                if (adminSent && memberSent) {
                    successMessage = '‚úÖ Registration complete! Confirmation emails sent to you and admin.';
                } else if (adminSent || memberSent) {
                    successMessage = '‚úÖ Registration complete! One confirmation email sent successfully.';
                } else {
                    successMessage = '‚úÖ Registration complete! Emails may be delayed. Check your inbox in a few minutes.';
                }
                
                showNotification(successMessage, 'success');
                
                setTimeout(() => {
                    closeAllModals();
                    if (typeof showSuccessModal === 'function') showSuccessModal(member);
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå Registration error:', error);
                showNotification('‚ùå Registration failed: ' + error.message, 'error');
            }
        }

        window.processTaskSuccess = processTaskSuccess;
        window.processTalkSuccess = processTalkSuccess;

        // ============================================
        // FORM SUBMISSION HANDLERS
        // ============================================
        function processTaskRegistration(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            if (!data.phone || !data.fullName || !data.email || !selectedCategory) {
                showNotification('Please fill all required fields and select a category', 'error');
                return;
            }
            
            if (!data.phone.match(/^254[0-9]{9}$/)) {
                showNotification('Please use correct phone format: 254XXXXXXXXX', 'error');
                return;
            }
            
            data.category = selectedCategory;
            processTaskSuccess(data);
        }

        function processTalkRegistration(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            if (!data.phone || !data.fullName || !data.email || !selectedLevel) {
                showNotification('Please fill all required fields and select a support level', 'error');
                return;
            }
            
            if (!data.phone.match(/^254[0-9]{9}$/)) {
                showNotification('Please use correct phone format: 254XXXXXXXXX', 'error');
                return;
            }
            
            data.supportLevel = selectedLevel;
            processTalkSuccess(data);
        }

        window.processTaskRegistration = processTaskRegistration;
        window.processTalkRegistration = processTalkRegistration;

        // ============================================
        // MEMBER LOGIN & DASHBOARD
        // ============================================
        function showMemberLogin() {
            showRealMemberLogin();
        }

        function showRealMemberLogin() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                    <h2 style="text-align: center;">üîê Member Login</h2>
                    
                    <form onsubmit="processRealLogin(event)" style="margin-top: 30px;">
                        <div class="form-group">
                            <label>Member ID or Email *</label>
                            <input type="text" id="loginIdentifier" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Phone (Last 4 digits) *</label>
                            <input type="text" id="loginPhone" required maxlength="4" pattern="[0-9]{4}">
                        </div>
                        
                        <button type="submit" class="btn" style="width: 100%;">Login</button>
                    </form>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <p>No account?</p>
                        <button class="btn btn-small" onclick="closeAllModals(); openModal('taskRegistration')">Join TASK</button>
                        <button class="btn btn-small" onclick="closeAllModals(); openModal('talkRegistration')">Join TALK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function processRealLogin(event) {
            event.preventDefault();
            
            const identifier = document.getElementById('loginIdentifier').value.trim();
            const phoneLastFour = document.getElementById('loginPhone').value.trim();
            
            const result = window.TauDB.authenticate(identifier, phoneLastFour);
            
            if (result.success) {
                showNotification('‚úÖ Login successful!', 'success');
                setTimeout(() => {
                    closeAllModals();
                    showRealMemberDashboard(result.member);
                }, 1000);
            } else {
                showNotification('‚ùå Invalid credentials', 'error');
            }
        }

        function showRealMemberDashboard(member) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            
            const currentMember = window.TauDB.getCurrentMember() || member;
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 1200px;">
                    <span class="close" onclick="window.TauDB.logout(); this.parentElement.parentElement.remove()">&times;</span>
                    
                    <div style="background: linear-gradient(45deg, #4169e1, #87ceeb); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                        <h1 style="margin: 0;">Welcome, ${currentMember.fullName}! üëã</h1>
                        <p style="margin: 10px 0 0 0;">Member ID: ${currentMember.id} ‚Ä¢ Team: ${currentMember.team}</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: #ffd700; padding: 25px; border-radius: 15px; text-align: center;">
                            <h3>üí∞ Balance</h3>
                            <h1 style="font-size: 2.5rem;">${currentMember.iKbpBalance || 0}</h1>
                            <p>iKbp (${((currentMember.iKbpBalance || 0) / 10).toFixed(2)} KSH)</p>
                        </div>
                        
                        <div style="background: #667eea; color: white; padding: 25px; border-radius: 15px; text-align: center;">
                            <h3>‚úÖ Tasks</h3>
                            <h1 style="font-size: 2.5rem;">${currentMember.tasks ? currentMember.tasks.filter(t => t.status !== 'Completed').length : 0}</h1>
                            <button class="btn" onclick="closeAllModals(); openModal('tasks')" style="margin-top: 10px; width: 100%;">View</button>
                        </div>
                        
                        <div style="background: #ff6b6b; color: white; padding: 25px; border-radius: 15px; text-align: center;">
                            <h3>üìö Activities</h3>
                            <h1 style="font-size: 2.5rem;">${currentMember.activities ? currentMember.activities.length : 0}</h1>
                            <button class="btn" onclick="closeAllModals(); openModal('activities')" style="margin-top: 10px; width: 100%;">View</button>
                        </div>
                    </div>
                    
                    <div style="background: #667eea; color: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; text-align: center;">
                        <h4>üéÅ Your Referral Code</h4>
                        <h1 style="letter-spacing: 3px;">${currentMember.referralCode}</h1>
                        <button class="btn" onclick="copyReferralLink('${currentMember.referralCode}')" style="background: white; color: #667eea; width: 100%;">Copy Link</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button class="btn" onclick="closeAllModals(); openModal('forum')">üí¨ Forum</button>
                        <button class="btn" onclick="closeAllModals(); openModal('activities')">üìö Activities</button>
                        <button class="btn" onclick="closeAllModals(); openModal('tasks')">‚úÖ Tasks</button>
                        <button class="btn" onclick="window.open('https://magero1985.github.io/Kabiru-Mining-Portal-/', '_blank')">‚ö° Mining</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function copyReferralLink(referralCode) {
            const link = `${window.location.origin}${window.location.pathname}?ref=${referralCode}`;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(link).then(() => {
                    showNotification('‚úÖ Referral link copied! Share to earn 500 iKbp!', 'success');
                }).catch(() => {
                    prompt('Copy your referral link:', link);
                });
            } else {
                prompt('Copy your referral link:', link);
            }
        }

        function showSuccessModal(member) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2 style="color: #2ecc71; text-align: center;">üéâ Registration Successful!</h2>
                    
                    <div style="background: #4169e1; color: white; padding: 30px; border-radius: 15px; margin: 20px 0; text-align: center;">
                        <h3>Your Member ID</h3>
                        <h1 style="font-size: 2.5rem; letter-spacing: 2px;">${member.id}</h1>
                    </div>
                    
                    <div style="background: #ffd700; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h4 style="color: #333;">üí∞ Referral Code</h4>
                        <h2 style="color: #333; letter-spacing: 3px;">${member.referralCode}</h2>
                        <button class="btn" onclick="copyReferralLink('${member.referralCode}')" style="width: 100%;">Copy Link</button>
                        <p style="color: #333; margin-top: 10px;">Earn 500 iKbp per referral!</p>
                    </div>
                    
                    <button class="btn" onclick="closeAllModals(); showRealMemberLogin()" style="width: 100%;">Access Account</button>
                    <button class="btn" onclick="closeAllModals()" style="width: 100%; margin-top: 10px; background: #95a5a6;">Close</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        window.showMemberLogin = showMemberLogin;
        window.showRealMemberLogin = showRealMemberLogin;
        window.processRealLogin = processRealLogin;
        window.showRealMemberDashboard = showRealMemberDashboard;
        window.copyReferralLink = copyReferralLink;
        window.showSuccessModal = showSuccessModal;

        // ============================================
        // GET MODAL CONTENT - ALL FORMS
        // ============================================
        function getModalContent(type) {
            switch(type) {
                case 'taskRegistration':
                    return createTaskRegistrationModal();
                case 'talkRegistration':
                    return createTalkRegistrationModal();
                case 'training':
                    return createTrainingModal();
                case 'workshop':
                    return createWorkshopModal();
                case 'research':
                    return createResearchModal();
                case 'jobCreation':
                    return createJobCreationModal();
                case 'insertJob':
                    return createInsertJobModal();
                case 'retrieveJob':
                    return createRetrieveJobModal();
                case 'availableJobs':
                    return createAvailableJobsModal();
                case 'applyJob':
                    return createApplyJobModal();
                case 'community':
                    return createCommunityModal();
                case 'corporate':
                    return createCorporateModal();
                case 'parSirai':
                    return createParSiraiModal();
                case 'trustGraph':
                    return createTrustGraphModal();
                case 'foundation':
                    return createFoundationModal();
                case 'holdings':
                    return createHoldingsModal();
                case 'forum':
                    return createForumModal();
                case 'activities':
                    return createActivitiesModal();
                case 'tasks':
                    return createTasksModal();
                default:
                    return '<div class="modal-content"><span class="close" onclick="closeAllModals()">&times;</span><h2>Feature Coming Soon</h2><p>This feature is under development.</p></div>';
            }
        }

        function createTaskRegistrationModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>Join TASK Team</h2>
                    <p>Declare the values or services you're offering to the TAU Africa community</p>
                    
                    <div class="payment-info">
                        <h3>Registration Fee: KSH 500</h3>
                        <p>Secure M-PESA payment required ‚Ä¢ One-time membership fee</p>
                    </div>
                    
                    <form onsubmit="processTaskRegistration(event)" id="taskForm">
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" name="fullName" required placeholder="Enter your full legal name">
                        </div>
                        
                        <div class="form-group">
                            <label>Email Address *</label>
                            <input type="email" name="email" required placeholder="your.email@example.com">
                        </div>
                        
                        <div class="form-group">
                            <label>Phone Number (M-PESA) *</label>
                            <input type="tel" name="phone" required placeholder="254XXXXXXXXX" pattern="254[0-9]{9}">
                            <small>Format: 254XXXXXXXXX (include country code)</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Country/Location *</label>
                            <input type="text" name="location" required placeholder="City, Country">
                        </div>

                        <div class="form-group">
                            <label>Date of Birth *</label>
                            <input type="date" name="dateOfBirth" required>
                        </div>

                        <div class="form-group">
                            <label>Gender *</label>
                            <select name="gender" required>
                                <option value="">Select gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                                <option value="Prefer not to say">Prefer not to say</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Nationality *</label>
                            <input type="text" name="nationality" required placeholder="Your nationality">
                        </div>
                        
                        <div class="form-group">
                            <label>Value Category *</label>
                            <div class="level-selection">
                                <div class="level-btn" onclick="selectCategory('skills', this)">Skills & Crafts</div>
                                <div class="level-btn" onclick="selectCategory('knowledge', this)">Knowledge & Expertise</div>
                                <div class="level-btn" onclick="selectCategory('service', this)">Professional Service</div>
                                <div class="level-btn" onclick="selectCategory('profession', this)">Licensed Profession</div>
                                <div class="level-btn" onclick="selectCategory('creativity', this)">Creative Arts</div>
                                <div class="level-btn" onclick="selectCategory('leadership', this)">Leadership & Management</div>
                                <div class="level-btn" onclick="selectCategory('business', this)">Business & Entrepreneurship</div>
                            </div>
                            <input type="hidden" name="category" id="taskCategory" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Describe Your Value/Service *</label>
                            <textarea name="valueDescription" rows="4" placeholder="Provide a detailed description of what you offer" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Experience Level *</label>
                            <select name="experience" required>
                                <option value="">Select level</option>
                                <option value="Beginner">Beginner (0-2 years)</option>
                                <option value="Intermediate">Intermediate (2-5 years)</option>
                                <option value="Advanced">Advanced (5-10 years)</option>
                                <option value="Expert">Expert (10+ years)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Languages Spoken *</label>
                            <input type="text" name="languages" required placeholder="e.g., English, Swahili, French">
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="terms" required style="width: auto; margin-right: 10px;">
                                I agree to the TAU Africa Terms of Service and Privacy Policy *
                            </label>
                        </div>
                        
                        <button type="submit" class="btn btn-register">Complete Registration (KSH 500)</button>
                    </form>
                </div>
            `;
        }

        function createTalkRegistrationModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>Join TALK Team</h2>
                    <p>Declare financial support, grants, or investments you're offering to the African development ecosystem</p>
                    
                    <div class="payment-info">
                        <h3>Registration Fee: KSH 2,000</h3>
                        <p>Secure M-PESA payment ‚Ä¢ Deposit goes to Valenta Liquid Pool Reserve</p>
                    </div>
                    
                    <form onsubmit="processTalkRegistration(event)" id="talkForm">
                        <div class="form-group">
                            <label>Full Name/Organization Name *</label>
                            <input type="text" name="fullName" required placeholder="Individual name or organization">
                        </div>
                        
                        <div class="form-group">
                            <label>Email Address *</label>
                            <input type="email" name="email" required placeholder="your.email@example.com">
                        </div>
                        
                        <div class="form-group">
                            <label>Phone Number (M-PESA) *</label>
                            <input type="tel" name="phone" required placeholder="254XXXXXXXXX" pattern="254[0-9]{9}">
                        </div>
                        
                        <div class="form-group">
                            <label>Country/Location *</label>
                            <input type="text" name="location" required>
                        </div>

                        <div class="form-group">
                            <label>Organization Type *</label>
                            <select name="organizationType" required>
                                <option value="">Select type</option>
                                <option value="Individual Investor">Individual Investor</option>
                                <option value="Corporation">Corporation</option>
                                <option value="Foundation">Foundation/NGO</option>
                                <option value="Government Agency">Government Agency</option>
                                <option value="Investment Fund">Investment Fund</option>
                                <option value="Development Bank">Development Bank</option>
                                <option value="Family Office">Family Office</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Financial Support Level *</label>
                            <div class="level-selection">
                                <div class="level-btn" onclick="selectLevel('ground', this)">Ground Level (&lt; $1,000)</div>
                                <div class="level-btn" onclick="selectLevel('middle', this)">Middle Level ($1,000-$5,000)</div>
                                <div class="level-btn" onclick="selectLevel('upper', this)">Upper Level ($5,000-$10,000)</div>
                                <div class="level-btn" onclick="selectLevel('high', this)">High Level ($10,000-$50,000)</div>
                                <div class="level-btn" onclick="selectLevel('top', this)">Top Level ($50,000+)</div>
                            </div>
                            <input type="hidden" name="supportLevel" id="supportLevel" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Focus Areas/Industries *</label>
                            <textarea name="focusAreas" rows="3" placeholder="What sectors do you want to support?" required></textarea>
                        </div>
                        
                        <div id="enhancedRequirements" style="display: none;">
                            <h3 style="color: #2a5298; margin: 25px 0 15px 0;">Enhanced Requirements (Middle Level & Above)</h3>
                            
                            <div class="form-group">
                                <label>Financial Track Record *</label>
                                <textarea name="financialTrack" rows="3" placeholder="Previous investments, business ventures"></textarea>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="terms" required style="width: auto; margin-right: 10px;">
                                I agree to the TAU Africa Terms of Service and Privacy Policy *
                            </label>
                        </div>
                        
                        <button type="submit" class="btn btn-register">Complete Registration (KSH 2,000)</button>
                    </form>
                </div>
            `;
        }

        function createTrainingModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üìö Join Training Programs</h2>
                    
                    <form>
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" name="fullName" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" name="email" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Phone Number *</label>
                            <input type="tel" name="phone" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Training Category *</label>
                            <select name="trainingCategory" required>
                                <option value="">Select training area</option>
                                <option>Digital Skills & Technology</option>
                                <option>Business & Entrepreneurship</option>
                                <option>Financial Literacy</option>
                                <option>Leadership Development</option>
                                <option>Agricultural Innovation</option>
                                <option>Pan-African Studies</option>
                                <option>Health & Wellness</option>
                                <option>Creative Arts</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn">Register for Training</button>
                    </form>
                </div>
            `;
        }

        function createWorkshopModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üéØ Host a Workshop</h2>
                    
                    <form>
                        <div class="form-group">
                            <label>Your Name *</label>
                            <input type="text" name="hostName" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" name="email" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Workshop Title *</label>
                            <input type="text" name="workshopTitle" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Workshop Description *</label>
                            <textarea name="description" rows="4" required></textarea>
                        </div>
                        
                        <button type="submit" class="btn">Submit Workshop Proposal</button>
                    </form>
                </div>
            `;
        }

        function createResearchModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üî¨ Research Services</h2>
                    
                    <form>
                        <div class="form-group">
                            <label>Organization/Individual Name *</label>
                            <input type="text" name="clientName" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Contact Email *</label>
                            <input type="email" name="email" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Research Type *</label>
                            <select name="researchType" required>
                                <option value="">Select research type</option>
                                <option>Market Research</option>
                                <option>Academic Research</option>
                                <option>Policy Research</option>
                                <option>Social Impact Assessment</option>
                                <option>Business Intelligence</option>
                                <option>Pan-African Studies</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn">Submit Research Request</button>
                    </form>
                </div>
            `;
        }

        function createJobCreationModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üíº Job Creation Training Program</h2>
                    
                    <div class="payment-info">
                        <h3>Training Fee: KSH 1,500</h3>
                        <p>6-week intensive program</p>
                    </div>
                    
                    <form>
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" name="fullName" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" name="email" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Phone Number *</label>
                            <input type="tel" name="phone" required placeholder="254XXXXXXXXX">
                        </div>
                        
                        <div class="form-group">
                            <label>Location *</label>
                            <input type="text" name="location" required>
                        </div>
                        
                        <button type="submit" class="btn btn-register">Enroll Now (KSH 1,500)</button>
                    </form>
                </div>
            `;
        }

        function createInsertJobModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üìù Post a Job Opening</h2>
                    <p>Feature coming soon</p>
                    <button class="btn" onclick="closeAllModals()">Close</button>
                </div>
            `;
        }

        function createRetrieveJobModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üîç Job Search Portal</h2>
                    <p>Feature coming soon</p>
                    <button class="btn" onclick="closeAllModals()">Close</button>
                </div>
            `;
        }

        function createAvailableJobsModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üìã Available Jobs</h2>
                    <p>Feature coming soon</p>
                    <button class="btn" onclick="closeAllModals()">Close</button>
                </div>
            `;
        }

        function createApplyJobModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üìã Job Application</h2>
                    <p>Feature coming soon</p>
                    <button class="btn" onclick="closeAllModals()">Close</button>
                </div>
            `;
        }

        function createCommunityModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>ü§ù Join Community Programs</h2>
                    <p>Feature coming soon</p>
                    <button class="btn" onclick="closeAllModals()">Close</button>
                </div>
            `;
        }

        function createCorporateModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üè¢ Corporate Registration</h2>
                    <p>Feature coming soon</p>
                    <button class="btn" onclick="closeAllModals()">Close</button>
                </div>
            `;
        }

        function createParSiraiModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üèõÔ∏è Par Sirai Center</h2>
                    <p>Center for Knowledge and Spirituality</p>
                    <button class="btn" onclick="closeAllModals()">Close</button>
                </div>
            `;
        }

        function createTrustGraphModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üîó Trust Graph Ledger</h2>
                    <p>Blockchain-Based Trust System</p>
                    <button class="btn" onclick="closeAllModals()">Close</button>
                </div>
            `;
        }

        function createFoundationModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üåç TAU Africa Foundation</h2>
                    <p>Foundation for Sustainable Development</p>
                    <button class="btn" onclick="closeAllModals()">Close</button>
                </div>
            `;
        }

        function createHoldingsModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üè¢ Company Holdings</h2>
                    <p>Valenta Holdings Portfolio</p>
                    <button class="btn" onclick="closeAllModals()">Close</button>
                </div>
            `;
        }

        function createForumModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üí¨ Member Forum</h2>
                    <p>Connect with fellow TAU Africa members</p>
                    <button class="btn" onclick="closeAllModals(); showRealMemberLogin()">Login to Access</button>
                </div>
            `;
        }

        function createActivitiesModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üìö Your Activities</h2>
                    <p>Login required</p>
                    <button class="btn" onclick="closeAllModals(); showRealMemberLogin()">Login</button>
                </div>
            `;
        }

        function createTasksModal() {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>‚úÖ Your Tasks</h2>
                    <p>Login required</p>
                    <button class="btn" onclick="closeAllModals(); showRealMemberLogin()">Login</button>
                </div>
            `;
        }

        window.getModalContent = getModalContent;

        // ============================================
        // VALUE SUBMISSION SYSTEM
        // ============================================
        function openValueSubmissionModal() {
            showNotification('Value submission feature coming soon!', 'info');
        }

        window.openValueSubmissionModal = openValueSubmissionModal;

        // ============================================
        // PUBLIC OPPORTUNITIES
        // ============================================
        function filterOpportunities(filter) {
            currentFilter = filter;
            document.querySelectorAll('[id^="filter-"]').forEach(btn => {
                btn.style.background = 'linear-gradient(45deg, #95a5a6, #7f8c8d)';
            });
            const filterBtn = document.getElementById('filter-' + filter);
            if (filterBtn) {
                filterBtn.style.background = 'linear-gradient(45deg, #4169e1, #87ceeb)';
            }
            refreshPublicOpportunities();
        }

        function refreshPublicOpportunities() {
            const container = document.getElementById('publicOpportunitiesContainer');
            if (!container) return;
            
            container.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">No opportunities available yet</p>';
        }

        window.filterOpportunities = filterOpportunities;
        window.refreshPublicOpportunities = refreshPublicOpportunities;

        // ============================================
        // STARTUP LOG
        // ============================================
        setTimeout(() => {
            console.log('========================================');
            console.log('TAU AFRICA INTERNATIONAL - INITIALIZED');
            console.log('========================================');
            console.log('‚úÖ EmailJS Status:', typeof emailjs !== 'undefined' ? 'READY' : 'FAILED');
            console.log('‚úÖ Firebase Status:', isOnline ? 'ONLINE' : 'OFFLINE');
            console.log('‚úÖ All Functions Loaded');
            console.log('========================================');
            
            const ref = checkReferralCode();
            if (ref) {
                showNotification(`üéÅ Referral code: ${ref} - Referrer earns 500 iKbp when you register!`, 'info');
            }
        }, 2000);
        
    </script>
    <script>
    // ============================================
// TAU AFRICA PART 2 - ADVANCED FEATURES
// Add this script AFTER the main HTML
// ============================================

(function() {
    'use strict';
    
    console.log('üöÄ Loading TAU Africa Advanced Features...');

    // ============================================
    // VALUE SUBMISSION SYSTEM - COMPLETE
    // ============================================
    window.openValueSubmissionModal = function() {
        const currentMember = window.TauDB?.getCurrentMember();
        
        if (!currentMember) {
            showNotification('Please login to submit values', 'error');
            showRealMemberLogin();
            return;
        }
        
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'block';
        modal.innerHTML = `
            <div class="modal-content" style="max-width: 700px;">
                <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                
                <div style="background: linear-gradient(45deg, #ffd700, #ffed4e); color: #333; padding: 25px; border-radius: 15px; margin-bottom: 25px; text-align: center;">
                    <h2 style="margin: 0;">üíé Submit Your Value</h2>
                    <p style="margin: 10px 0 0 0;">Turn your skills, products, and services into iKb</p>
                </div>
                
                <form onsubmit="submitValue(event)" id="valueSubmissionForm">
                    <div class="form-group">
                        <label>Value Type *</label>
                        <select name="valueType" required>
                            <option value="">Select type</option>
                            <option value="Product">üì¶ Product</option>
                            <option value="Service">üõ†Ô∏è Service</option>
                            <option value="Skill">üéØ Skill</option>
                            <option value="Labour">üí™ Labour</option>
                            <option value="Time">‚è∞ Time</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Value Title *</label>
                        <input type="text" name="valueTitle" placeholder="e.g., Professional Web Design Services" required maxlength="100">
                    </div>
                    
                    <div class="form-group">
                        <label>Detailed Description *</label>
                        <textarea name="valueDescription" rows="6" placeholder="Describe what you're offering" required maxlength="2000"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Estimated Worth (KSH) *</label>
                        <input type="number" name="worthKsh" placeholder="Enter value in KSH" required min="0" step="0.01">
                        <small>This will be converted to iKb (1 iKb = 100,000 KSH)</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Category</label>
                        <select name="valueCategory">
                            <option value="">Select category (optional)</option>
                            <option value="Technology">Technology & IT</option>
                            <option value="Creative">Creative & Design</option>
                            <option value="Business">Business & Finance</option>
                            <option value="Education">Education & Training</option>
                            <option value="Health">Health & Wellness</option>
                            <option value="Agriculture">Agriculture & Food</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" name="termsAgree" required style="width: auto; margin-right: 10px;">
                            I certify that this value is genuine *
                        </label>
                    </div>
                    
                    <button type="submit" class="btn" style="width: 100%; padding: 15px;">
                        üíé Submit Value for Validation
                    </button>
                </form>
            </div>
        `;
        
        document.body.appendChild(modal);
    };

    window.submitValue = function(event) {
        event.preventDefault();
        const currentMember = window.TauDB?.getCurrentMember();
        if (!currentMember) return;
        
        const formData = new FormData(event.target);
        const worthKsh = parseFloat(formData.get('worthKsh'));
        const worthIkb = (worthKsh / 100000).toFixed(6);
        
        const value = {
            id: 'VAL-' + Date.now(),
            type: formData.get('valueType'),
            title: formData.get('valueTitle'),
            description: formData.get('valueDescription'),
            worthKsh: worthKsh,
            worthIkb: worthIkb,
            category: formData.get('valueCategory') || 'Uncategorized',
            submittedBy: currentMember.id,
            submittedByName: currentMember.fullName,
            validationCode: generateValueCode(),
            status: 'Pending Review',
            created: new Date().toISOString(),
            validated: false
        };
        
        const values = JSON.parse(localStorage.getItem('tauValues') || '[]');
        values.push(value);
        localStorage.setItem('tauValues', JSON.stringify(values));
        
        if (typeof createNotification === 'function') {
            createNotification(currentMember.id, 'üíé Value Submitted!', 
                `Your value "${value.title}" submitted. Code: ${value.validationCode}`, 
                'success');
        }
        
        closeAllModals();
        showNotification('‚úÖ Value submitted successfully!', 'success');
    };

    function generateValueCode() {
        const timestamp = Date.now().toString(36).toUpperCase();
        const random = Math.random().toString(36).substring(2, 6).toUpperCase();
        return 'VAL-' + timestamp + '-' + random;
    }
</script>
<script>
    // ============================================
    // PUBLIC OPPORTUNITIES DISPLAY - ENHANCED
    // ============================================
    window.refreshPublicOpportunities = function() {
        const container = document.getElementById('publicOpportunitiesContainer');
        if (!container) return;
        
        const tasks = JSON.parse(localStorage.getItem('tauTasks') || '[]').filter(t => t.validated);
        const activities = JSON.parse(localStorage.getItem('tauActivities') || '[]').filter(a => a.validated);
        const values = JSON.parse(localStorage.getItem('tauValues') || '[]').filter(v => v.validated && v.status === 'Approved');
        
        let items = [];
        
        if (currentFilter === 'all' || currentFilter === 'activities') {
            items = items.concat(activities.map(a => ({...a, type: 'activity'})));
        }
        if (currentFilter === 'all' || currentFilter === 'tasks') {
            items = items.concat(tasks.map(t => ({...t, type: 'task'})));
        }
        if (currentFilter === 'all' || currentFilter === 'values') {
            items = items.concat(values.map(v => ({...v, type: 'value'})));
        }
        
        if (items.length === 0) {
            container.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">No opportunities available yet</p>';
            return;
        }
        
        container.innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                ${items.map(item => `
                    <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-left: 4px solid ${getColorForType(item.type)};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0; color: #2a5298;">${item.title}</h4>
                            <span style="background: ${getColorForType(item.type)}; color: white; padding: 5px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                ${item.type.toUpperCase()}
                            </span>
                        </div>
                        
                        <p style="color: #666; margin-bottom: 15px;">${item.description}</p>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <span style="background: #ffd700; color: #333; padding: 8px 15px; border-radius: 20px; font-weight: bold;">
                                ${item.type === 'value' ? item.worthIkb + ' iKb' : (item.reward || '100') + ' iKbp'}
                            </span>
                        </div>
                        
                        <button class="btn" onclick="claimOpportunity('${item.type}', '${item.id}')" style="width: 100%; padding: 12px;">
                            ${item.type === 'value' ? 'üíé Claim Value' : '‚úÖ Complete & Earn'}
                        </button>
                    </div>
                `).join('')}
            </div>
        `;
    };

    function getColorForType(type) {
        switch(type) {
            case 'activity': return '#ff6b6b';
            case 'task': return '#4169e1';
            case 'value': return '#ffd700';
            default: return '#95a5a6';
        }
    }

    window.claimOpportunity = function(type, id) {
        const currentMember = window.TauDB?.getCurrentMember();
        
        if (!currentMember) {
            showNotification('Please login to claim opportunities', 'error');
            showRealMemberLogin();
            return;
        }
        
        showNotification('Claiming opportunity...', 'info');
        setTimeout(() => {
            showNotification('‚úÖ Opportunity claimed! Check your dashboard.', 'success');
        }, 1000);
    };
</script>
<script>
    // ============================================
    // FIREBASE ENHANCEMENT FOR TAUDB
    // ============================================
    if (window.TauDB && window.db) {
        const originalSync = window.TauDB.sync;
        
        window.TauDB.sync = async function(formData, team, referralCode) {
            const result = originalSync.call(this, formData, team, referralCode);
            
            if (result.success && window.db) {
                try {
                    await window.db.collection('members').doc(result.memberId).set({
                        ...result.member,
                        lastSync: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    console.log('‚úÖ Member synced to Firestore:', result.memberId);
                } catch (error) {
                    console.error('‚ö†Ô∏è Firestore sync warning:', error);
                }
            }
            
            return result;
        };
        
        console.log('‚úÖ Firebase enhancement applied to TauDB');
    }
</script>
<script>
    // ============================================
    // REAL-TIME SYNC SOCKET
    // ============================================
    const SYNC_INTERVAL = 5000;
    let lastState = {};
    
    function initSync() {
        const STORAGE_KEYS = {
            members: 'tauAfricaDB',
            tasks: 'tauTasks',
            activities: 'tauActivities',
            values: 'tauValues',
            notifications: 'tauNotifications'
        };
        
        Object.keys(STORAGE_KEYS).forEach(key => {
            const data = localStorage.getItem(STORAGE_KEYS[key]) || '[]';
            lastState[key] = data;
        });
        
        console.log('‚úÖ Sync socket initialized');
    }
    
    function checkForChanges() {
        const STORAGE_KEYS = {
            members: 'tauAfricaDB',
            tasks: 'tauTasks',
            activities: 'tauActivities',
            values: 'tauValues',
            notifications: 'tauNotifications'
        };
        
        let hasChanges = false;
        
        Object.keys(STORAGE_KEYS).forEach(key => {
            const currentData = localStorage.getItem(STORAGE_KEYS[key]) || '[]';
            
            if (currentData !== lastState[key]) {
                hasChanges = true;
                lastState[key] = currentData;
                console.log(`üîÑ Data changed: ${key}`);
            }
        });
        
        if (hasChanges) {
            if (typeof updateNotificationBadge === 'function') updateNotificationBadge();
            if (typeof refreshPublicOpportunities === 'function') refreshPublicOpportunities();
        }
    }
    
    initSync();
    setInterval(checkForChanges, SYNC_INTERVAL);
    
    window.addEventListener('storage', function(e) {
        console.log('üîÑ Storage event detected:', e.key);
        checkForChanges();
    });
</script>
<script>
    // ============================================
    // WELCOME BONUS AUTOMATION
    // ============================================
    function checkAndAwardBonuses() {
        try {
            const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
            const bonusTracking = JSON.parse(localStorage.getItem('tauWelcomeBonuses') || '{}');
            let newBonuses = 0;
            
            members.forEach(member => {
                if (!bonusTracking[member.id]) {
                    member.iKbpBalance = (member.iKbpBalance || 0) + 500;
                    
                    bonusTracking[member.id] = {
                        awarded: true,
                        amount: 500,
                        date: new Date().toISOString(),
                        memberId: member.id
                    };
                    
                    newBonuses++;
                    console.log(`‚úÖ Welcome bonus awarded: ${member.fullName} (+500 iKbp)`);
                }
            });
            
            if (newBonuses > 0) {
                localStorage.setItem('tauAfricaDB', JSON.stringify(members));
                localStorage.setItem('tauWelcomeBonuses', JSON.stringify(bonusTracking));
            }
        } catch (error) {
            console.error('Welcome bonus error:', error);
        }
    }
    
    setInterval(checkAndAwardBonuses, 5000);
    checkAndAwardBonuses();
</script>
<script>
    // ============================================
    // KABIRU WITHDRAWAL SYSTEM
    // ============================================
    window.initiateKabiruWithdrawal = async function() {
        const currentMember = window.TauDB?.getCurrentMember();
        
        if (!currentMember) {
            showNotification('‚ùå Please login first', 'error');
            showRealMemberLogin();
            return;
        }
        
        const availableIkbp = currentMember.iKbpBalance || 0;
        const availableIkb = currentMember.iKbBalance || 0;
        
        if (availableIkbp < 10000 && availableIkb < 0.0001) {
            showNotification('‚ùå Minimum required: 10,000 iKbp or 0.0001 iKb', 'error');
            return;
        }
        
        const confirmMsg = `Transfer to Kabiru Mining App?\n\n` +
                          `${availableIkbp.toLocaleString()} iKbp\n` +
                          `${availableIkb.toFixed(4)} iKb\n\n` +
                          `This will transfer to your Kabiru mining wallet.`;
        
        if (!confirm(confirmMsg)) return;
        
        try {
            if (window.db) {
                await window.db.collection('kabiru_transfers').add({
                    transferId: 'XFER-' + Date.now(),
                    memberId: currentMember.id,
                    memberName: currentMember.fullName,
                    iKbp: availableIkbp,
                    iKb: availableIkb,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'pending',
                    direction: 'tau_to_kabiru'
                });
                
                const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
                const memberIndex = members.findIndex(m => m.id === currentMember.id);
                if (memberIndex !== -1) {
                    members[memberIndex].iKbpBalance = 0;
                    members[memberIndex].iKbBalance = 0;
                    localStorage.setItem('tauAfricaDB', JSON.stringify(members));
                    sessionStorage.setItem('tauCurrentUser', JSON.stringify(members[memberIndex]));
                }
                
                showNotification('‚úÖ Transfer initiated! Open Kabiru Mining App to receive.', 'success');
            } else {
                showNotification('‚ö†Ô∏è Offline mode - saved locally', 'info');
            }
        } catch (error) {
            console.error('‚ùå Transfer failed:', error);
            showNotification('‚ùå Transfer failed: ' + error.message, 'error');
        }
    };
        </script>
<script>
    // ============================================
    // ENHANCED MEMBER DASHBOARD WITH TRANSFER
    // ============================================
    const originalShowDashboard = window.showRealMemberDashboard;
    
    window.showRealMemberDashboard = function(member) {
        if (originalShowDashboard) {
            originalShowDashboard(member);
        }
        
        setTimeout(() => {
            const modal = document.querySelector('.modal[style*="display: block"]');
            if (!modal) return;
            
            const modalContent = modal.querySelector('.modal-content');
            if (!modalContent || modalContent.querySelector('#kabiruTransferSection')) return;
            
            const currentMember = window.TauDB?.getCurrentMember() || member;
            
            const transferSection = document.createElement('div');
            transferSection.id = 'kabiruTransferSection';
            transferSection.innerHTML = `
                <div style="margin-top: 30px; padding: 20px; background: linear-gradient(45deg, #FFD700, #FFA500); border-radius: 15px; text-align: center;">
                    <h3 style="color: #333; margin-bottom: 15px;">üíé Kabiru Mining Transfer</h3>
                    <div style="background: rgba(0,0,0,0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <div style="font-size: 24px; font-weight: bold; color: #333;">
                            ${(currentMember.iKbpBalance || 0).toLocaleString()} iKbp
                        </div>
                        <div style="font-size: 18px; color: #333; margin-top: 5px;">
                            ${(currentMember.iKbBalance || 0).toFixed(4)} iKb
                        </div>
                    </div>
                    <button onclick="initiateKabiruWithdrawal()" class="btn" style="width: 100%; background: #333; color: #FFD700;">
                        üí∏ Withdraw to Kabiru Mining
                    </button>
                    <p style="color: #333; font-size: 12px; margin-top: 10px;">
                        Minimum: 10,000 iKbp or 0.0001 iKb
                    </p>
                </div>
            `;
            
            const lastDiv = modalContent.querySelector('div[style*="grid-template-columns"]');
            if (lastDiv) {
                lastDiv.parentNode.insertBefore(transferSection, lastDiv);
            } else {
                modalContent.appendChild(transferSection);
            }
            
            console.log('‚úÖ Transfer button added to dashboard');
        }, 500);
    };
    </script>
<script>
    // ============================================
    // INTEGRATION HEALTH CHECK
    // ============================================
    function runHealthCheck() {
        console.log('\n' + '='.repeat(60));
        console.log('üè• TAU AFRICA INTEGRATION HEALTH CHECK');
        console.log('='.repeat(60) + '\n');
        
        const tests = {
            emailJS: typeof emailjs !== 'undefined',
            firebase: typeof firebase !== 'undefined' && window.db,
            tauDB: typeof window.TauDB !== 'undefined',
            notifications: typeof createNotification === 'function',
            opportunities: typeof refreshPublicOpportunities === 'function'
        };
        
        console.log('EmailJS:', tests.emailJS ? '‚úÖ' : '‚ùå');
        console.log('Firebase:', tests.firebase ? '‚úÖ' : '‚ùå');
        console.log('TauDB:', tests.tauDB ? '‚úÖ' : '‚ùå');
        console.log('Notifications:', tests.notifications ? '‚úÖ' : '‚ùå');
        console.log('Opportunities:', tests.opportunities ? '‚úÖ' : '‚ùå');
        
        const allPassed = Object.values(tests).every(t => t);
        
        console.log('\n' + '='.repeat(60));
        if (allPassed) {
            console.log('üéâ ALL SYSTEMS OPERATIONAL');
        } else {
            console.log('‚ö†Ô∏è SOME ISSUES DETECTED');
        }
        console.log('='.repeat(60) + '\n');
        
        return tests;
    }

    window.TauIntegration = {
        healthCheck: runHealthCheck
    };

    // ============================================
    // AUTO-RUN ON LOAD
    // ============================================
    setTimeout(() => {
        runHealthCheck();
        refreshPublicOpportunities();
        
        console.log('‚úÖ TAU Africa Advanced Features - LOADED');
        console.log('üí° Run window.TauIntegration.healthCheck() to check status');
    }, 3000);

})();
</script>
 </body>
    </html>
