<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>TAU AFRICA INTERNATIONAL</title>
    
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <style>
        /* iOS/Android Compatibility */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298, #87ceeb);
            min-height: 100vh;
            color: #333;
            -webkit-overflow-scrolling: touch;
        }

        button, input[type="submit"], input[type="button"] {
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        input, select, textarea {
            -webkit-appearance: none;
            appearance: none;
            border-radius: 10px;
        }

        input[type="date"] {
            min-height: 44px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #000080, #4169e1, #87ceeb);
            color: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .logo {
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, #87ceeb, #4169e1);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            border: 4px solid #ffd700;
        }

        .main-title {
            font-size: 2.8rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            letter-spacing: 2px;
        }

        .vision {
            font-size: 1.2rem;
            font-style: italic;
            opacity: 0.9;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .social-link {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .social-link:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .emancipation-scroll {
            position: absolute;
            bottom: 5px;
            left: 0;
            width: 100%;
            height: 20px;
            overflow: hidden;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 10px;
        }

        .emancipation-text {
            display: inline-block;
            white-space: nowrap;
            font-size: 12px;
            font-weight: bold;
            color: #ffd700;
            animation: scrollText 15s linear infinite;
            line-height: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        @keyframes scrollText {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        /* Wings Container */
        .wings-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .wing {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .wing:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .auffi {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
        }

        .valenta {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .wing-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .wing-description {
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .houses-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .house-btn, .corporate-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: bold;
            touch-action: manipulation;
        }

        .house-btn:hover, .corporate-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .galaxy-banner {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            margin-top: 15px;
        }

        /* Main Sections */
        .main-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }

        .section:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2a5298;
            margin-bottom: 15px;
            text-align: center;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(45deg, #4169e1, #87ceeb);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-block;
            text-decoration: none;
            touch-action: manipulation;
        }

        .btn:hover {
            background: linear-gradient(45deg, #2a5298, #4169e1);
            transform: scale(1.05);
        }

        .btn-register {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            font-size: 1.1rem;
            padding: 15px 30px;
        }

        .btn-kabiru {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            font-weight: bold;
            width: 100%;
            padding: 15px;
            margin-top: 20px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-success {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 95vh;
            overflow-y: auto;
            position: relative;
            -webkit-overflow-scrolling: touch;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 15px;
        }

        .close:hover {
            color: #000;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2a5298;
        }

        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }

        .form-group input:focus, 
        .form-group select:focus, 
        .form-group textarea:focus {
            border-color: #4169e1;
            outline: none;
        }

        .payment-info {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .level-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .level-btn {
            padding: 10px;
            border: 2px solid #4169e1;
            background: rgba(65, 105, 225, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            touch-action: manipulation;
        }

        .level-btn.selected {
            background: #4169e1;
            color: white;
        }

        /* Kabiru Section */
        .kabiru-section {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            text-align: center;
            padding: 30px;
            border-radius: 20px;
            margin-top: 30px;
        }

        /* Payment Modal */
        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .payment-widget {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .payment-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 16px;
            text-align: center;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4169e1;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 3000;
            display: none;
            max-width: 350px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .success { background: #2ecc71; }
        .error { background: #e74c3c; }
        .info { background: #3498db; }

        /* Floating Buttons */
        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #4169e1, #87ceeb);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .ai-assistant {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 100;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        /* AI Chat Window */
        .ai-chat-window {
            position: fixed;
            bottom: 170px;
            right: 30px;
            width: 350px;
            height: 450px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
            flex-direction: column;
            z-index: 200;
        }

        .ai-chat-header {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 15px 20px;
            border-radius: 20px 20px 0 0;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 300px;
        }

        .ai-message {
            background: #f0f0f0;
            padding: 10px 15px;
            border-radius: 15px;
            margin: 10px 0;
            max-width: 80%;
        }

        .user-message {
            background: linear-gradient(45deg, #4169e1, #87ceeb);
            color: white;
            margin-left: auto;
        }

        .ai-chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid #eee;
        }

        .ai-chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }

        .ai-chat-input button {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            margin-left: 10px;
            cursor: pointer;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .wings-container {
                grid-template-columns: 1fr;
            }
            
            .main-title {
                font-size: 2rem;
            }
            
            .houses-grid {
                grid-template-columns: 1fr;
            }
            
            .ai-chat-window {
                width: 90%;
                right: 5%;
                left: 5%;
            }
            
            .social-links {
                gap: 10px;
            }
            
            .social-link {
                font-size: 12px;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">üåç TAU</div>
            <h1 class="main-title">TAU AFRICA INTERNATIONAL</h1>
            <p class="vision">Community ‚Ä¢ Value ‚Ä¢ Corporate ‚Ä¢ Sovereignty</p>
            
            <!-- Social Media Links -->
            <div class="social-links">
                <a href="https://x.com/grouptauafrica?t=pFlJ-gky_A7Dp3e0lbZ5Sg&s=09" target="_blank" class="social-link">
                    üê¶ Twitter/X
                </a>
                <a href="https://www.tiktok.com/@tau.africa.nairob?_t=ZM-8zwbvmFtmt2&_r=1" target="_blank" class="social-link">
                    üéµ TikTok
                </a>
                <a href="https://youtube.com/@tauafrica8922?si=wwgxc2AvYHYwsHTh" target="_blank" class="social-link">
                    üì∫ YouTube
                </a>
                <span class="social-link" style="opacity: 0.7;">
                    üìò Facebook (Coming Soon)
                </span>
            </div>
            
            <div class="emancipation-scroll">
                <div class="emancipation-text">EMANCIPATION PROCLAMATIONS ‚Ä¢ FREEDOM FOR ALL AFRICANS ‚Ä¢ UNITY IN DIVERSITY ‚Ä¢ ECONOMIC LIBERATION ‚Ä¢ SPIRITUAL AWAKENING ‚Ä¢ SOCIAL JUSTICE</div>
            </div>
        </div>

        <!-- Two Wings -->
        <div class="wings-container">
            <!-- AUFFI Wing -->
            <div class="wing auffi">
                <h2 class="wing-title">üåç AUFFI</h2>
                <p class="wing-description">Africa Unity Freedom Fund Initiative. The Pan African Digital value Currency for uniting and awakening Africa socially, economically and spiritually. A movement that return Oloo's Sovereignty back home to Africa, bringing together the children of Oloo and the Galaxy restoration to rebuild Africa</p>
                
                <div class="houses-grid">
                    <div class="house-btn" onclick="showNotification('Galaxy 0 house - join with G0 Card!', 'success')">Galaxy 0 [Secretariat Board G0]</div>
                    <div class="house-btn" onclick="showNotification('Galaxy 1 house - join with G1 Card!', 'success')">Galaxy 1 [Representative Board]</div>
                    <div class="house-btn" onclick="showNotification('Galaxy 2 house - join with G2 Card!', 'success')">Galaxy 2 [Coordination Board  ]</div>
                    <div class="house-btn" onclick="showNotification('Galaxy 3 house - join with G3 Card!', 'success')">Galaxy 3 [Implementation Board]</div>
                </div>
                
                <div class="galaxy-banner">
                    Auffi - Pan African Trust Graph & R4<br> [REPARTRIATION - RESURRECTION-RESTORATION - RECONNECTION] (sovereignty). Our digital Ecosystem uses human & environmental values to create the Africa's Sovereign Wealth, and subsequently bring back Sovereignty to black people and humanity. join the Kabiru Mining App to mine your values in building The African digital currency (Kabiru)
                </div>
                
                <button class="btn" onclick="openModal('parSirai')">Par Sirai Center</button>
            </div>

            <!-- Valenta Wing -->
            <div class="wing valenta">
                <h2 class="wing-title">üè¢ VALENTA</h2>
                <p class="wing-description">Value Enter Africa - Our Corporate Holding company, building Kabiru Digital currency for Africa value harnessing, erecting a sustainable Kabiru digital ecosystem, & Empowering African communities through Education - Economic and Social Literacy. Come let us build our sovereignty together, and make Africa great again</p>

                <div class="houses-grid">
                    <div class="corporate-btn" onclick="openModal('corporate')">Corporate company</div>
                    <div class="corporate-btn" onclick="openModal('trustGraph')">Generation Trust Graph</div>
                    <div class="corporate-btn" onclick="openModal('foundation')">Family Foundation</div>
                    <div class="corporate-btn" onclick="openModal('holdings')">Holding Company</div>
                </div>
            </div>
        </div>

        <!-- Main Sections -->
        <div class="main-sections">
            <!-- Membership Registration -->
            <div class="section">
                <h3 class="section-title">üë• MEMBERSHIP</h3>
                <p>Join our community through TASK & TALK teams</p>
                <button class="btn btn-register" onclick="openModal('taskRegistration')">Join TASK Team</button>
                <button class="btn btn-register" onclick="openModal('talkRegistration')">Join TALK Team</button>
                <p style="margin-top: 15px; font-weight: bold; color: #e74c3c;">TASK Fee: KSH 500 | TALK Fee: KSH 2,000</p>
            </div>

            <!-- Activity Area -->
            <div class="section">
                <h3 class="section-title">üìö ACTIVITIES</h3>
                <p>Training workshops, job creation & research services</p>
                <button class="btn" onclick="openModal('training')">Join member training</button>
                <button class="btn" onclick="openModal('workshop')">Host corporate Workshop</button>
                <button class="btn" onclick="openModal('research')">Research Services</button>
                <button class="btn" onclick="openModal('jobCreation')">Job Creation workshop</button>
            </div>

            <!-- Jobs Area -->
            <div class="section">
                <h3 class="section-title">üíº TASKS</h3>
                <p>Connect job seekers with verified opportunities</p>
                <button class="btn" onclick="openModal('insertJob')">Insert value</button>
                <button class="btn" onclick="openModal('retrieveJob')">Search value</button>
                <button class="btn" onclick="openModal('availableJobs')">Browse value</button>
                <button class="btn" onclick="openModal('applyJob')">seek value</button>
            </div>

            <!-- Community -->
            <div class="section">
                <h3 class="section-title">ü§ù COMMUNITY</h3>
                <p>Community support programs</p>
                <button class="btn" onclick="openModal('community')">Join Programs</button>
                <div style="margin-top: 10px; font-size: 0.9rem;">
                    Agriculture ‚Ä¢ Climate ‚Ä¢ Environment<br>
                    Water & Sanitation ‚Ä¢ Education ‚Ä¢ Child Care
                </div>
            </div>

            <!-- Interactive Forum -->
            <div class="section">
                <h3 class="section-title">üí¨ MEMBER FORUM</h3>
                <p>Connect, share ideas, and collaborate with fellow members</p>
                <button class="btn" onclick="openModal('forum')">Access Forum</button>
                <div style="margin-top: 10px; font-size: 0.9rem;">
                    Discussions ‚Ä¢ Job Sharing ‚Ä¢ Training Materials<br>
                    Voice Calls ‚Ä¢ Messaging ‚Ä¢ Networking
                </div>
            </div>
        </div>

        <!-- Kabiru Mining Section -->
        <div class="kabiru-section">
            <h2>‚ö° KABIRU MINING</h2>
            <p>Mine Kabiru coins by proving and validating real values</p>
            <button class="btn-kabiru" onclick="window.open('https://magero1985.github.io/Kabiru-Mining-Portal-/', '_blank')">Access Kabiru Mining App</button>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Floating Member Access Button -->
    <div class="floating-btn" onclick="showMemberLogin()" title="Member Access">üë§</div>

    <!-- AI Assistant -->
    <div class="ai-assistant" onclick="toggleAIChat()" title="AI Assistant - Get Help">ü§ñ</div>

    <!-- AI Chat Window -->
    <div class="ai-chat-window" id="aiChatWindow">
        <div class="ai-chat-header">
            <span>TAU AI Assistant</span>
            <span onclick="toggleAIChat()" style="cursor: pointer;">‚úñ</span>
        </div>
        <div class="ai-chat-messages" id="aiChatMessages">
            <div class="ai-message">
                Hello! I'm your TAU Africa AI assistant. I can help you with:
                <br>‚Ä¢ Navigating the app
                <br>‚Ä¢ Understanding registration process
                <br>‚Ä¢ Payment procedures
                <br>‚Ä¢ Technical support
                <br>‚Ä¢ General questions about TAU Africa
                <br><br>How can I assist you today?
            </div>
        </div>
        <div class="ai-chat-input">
            <input type="text" id="aiChatInput" placeholder="Ask me anything..." onkeypress="handleAIChatKeyPress(event)">
            <button onclick="sendAIMessage()">‚û§</button>
        </div>
    </div>

<script>
// Initialize EmailJS
(function() {
    try {
        emailjs.init({
            publicKey: "GhjI14eQVGgOli0j1",
        });
        console.log('‚úÖ EmailJS initialized successfully');
    } catch (error) {
        console.error('‚ùå EmailJS initialization failed:', error);
    }
})();
    
// Global variables
let currentModal = null;
let selectedLevel = '';
let selectedCategory = '';
function sendEmailToOrganization(formData, subject) {
    console.log('üìß Attempting to send email...');
    console.log('Subject:', subject);
    console.log('Form Data:', formData);

    let messageContent = `${subject}\n\n`;
    for (let key in formData) {
        if (formData.hasOwnProperty(key)) {
            messageContent += `${key}: ${formData[key]}\n`;
        }
    }
    messageContent += `\nSubmitted: ${new Date().toLocaleString()}`;

    const templateParams = {
        from_name: formData.fullName || formData.name || formData.contactName || 'TAU Africa User',
        from_email: formData.email || 'noreply@tauafrica.com',
        subject: subject,
        message: messageContent,
        phone: formData.phone || 'Not provided',
        location: formData.location || formData.country || 'Not provided'
    };

    console.log('üì® Sending email with params:', templateParams);

    return emailjs.send('service_xfira7g', 'template_bqxztig', templateParams)
        .then(function(response) {
            console.log('‚úÖ Email sent successfully:', response);
            return true;
        })
        .catch(function(error) {
            console.error('‚ùå Email error:', error);
            return false;
        });
}

// ===== M-PESA PAYMENT INTEGRATION =====
function initiateMpesaPayment(amount, phoneNumber, formData, successCallback) {
    showPaymentModal(amount, phoneNumber, formData, successCallback);
}

function showPaymentModal(amount, phoneNumber, formData, successCallback) {
    const paymentModal = document.createElement('div');
    paymentModal.className = 'payment-modal';
    paymentModal.innerHTML = `
        <div class="payment-widget">
            <h3>üì± M-PESA Payment</h3>
            <div class="payment-step">
                <h4>Amount: KSH ${amount}</h4>
                <p>Phone: ${phoneNumber}</p>
                <p style="color: #666; font-size: 0.9em;">A payment prompt will be sent to your phone</p>
            </div>
            <div id="paymentSteps">
                <div style="margin: 20px 0; padding: 15px; background: #f0f8ff; border-radius: 10px;">
                    <p><strong>Payment Process:</strong></p>
                    <ol style="text-align: left; margin-top: 10px;">
                        <li>Check your phone for M-PESA prompt</li>
                        <li>Enter your M-PESA PIN</li>
                        <li>Confirm the payment</li>
                        <li>Wait for confirmation</li>
                    </ol>
                </div>
                <input type="text" class="payment-input" placeholder="Enter confirmation code (if received)" id="confirmationCode">
                <button class="btn" onclick="simulatePayment(${amount}, '${phoneNumber}')">Confirm Payment</button>
            </div>
            <button class="btn" style="background: #e74c3c; margin-top: 20px;" onclick="cancelPayment()">Cancel Payment</button>
        </div>
    `;
    paymentModal.formData = formData;
    paymentModal.successCallback = successCallback;
    document.body.appendChild(paymentModal);
}

function simulatePayment(amount, phoneNumber) {
    const paymentModal = document.querySelector('.payment-modal');
    const confirmationCode = document.getElementById('confirmationCode').value;
    
    if (confirmationCode.length < 4) {
        showNotification('Please enter a valid confirmation code', 'error');
        return;
    }

    paymentModal.innerHTML = `
        <div class="payment-widget">
            <h3>Processing Payment...</h3>
            <div class="spinner"></div>
            <p>Verifying M-PESA transaction</p>
            <p style="font-size: 0.9em; color: #666;">Transaction ID: MPX${Date.now()}</p>
        </div>
    `;

    setTimeout(() => {
        if (Math.random() > 0.05) {
            const storedFormData = paymentModal.formData;
            const callback = paymentModal.successCallback;
            
            paymentModal.remove();
            
            if (callback === 'processTaskSuccess') {
                processTaskSuccess(storedFormData);
            } else if (callback === 'processTalkSuccess') {
                processTalkSuccess(storedFormData);
            } else if (callback === 'processJobCreationSuccess') {
                processJobCreationSuccess(storedFormData);
            }
            
            showNotification(`M-PESA payment of KSH ${amount} successful! Transaction ID: MPX${Date.now()}`, 'success');
        } else {
            paymentModal.remove();
            showNotification('Payment failed. Please try again or contact support.', 'error');
        }
    }, 3000);
}

function cancelPayment() {
    document.querySelector('.payment-modal')?.remove();
    showNotification('Payment cancelled', 'error');
}

// ===== NOTIFICATION SYSTEM =====
function showNotification(message, type = 'success', duration = 6000) {
    const notification = document.getElementById('notification');
    notification.innerHTML = message;
    notification.className = `notification ${type}`;
    notification.style.display = 'block';
    
    setTimeout(() => {
        notification.style.display = 'none';
    }, duration);
}

// ===== MODAL MANAGEMENT =====
function openModal(type) {
    closeAllModals();
    
    const modalContent = getModalContent(type);
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = modalContent;
    document.body.appendChild(modal);
    currentModal = modal;
}

function closeAllModals() {
    const modals = document.querySelectorAll('.modal, .payment-modal');
    modals.forEach(modal => modal.remove());
    currentModal = null;
}

// ===== SELECTION FUNCTIONS =====
function selectLevel(level, element) {
    const buttons = document.querySelectorAll('.level-btn');
    buttons.forEach(btn => btn.classList.remove('selected'));
    const target = element || (window.event && window.event.target);
    if (target) {
        target.classList.add('selected');
    }
    selectedLevel = level;
    const levelInput = document.getElementById('supportLevel');
    if (levelInput) levelInput.value = level;
    
    const enhanced = document.getElementById('enhancedRequirements');
    if (enhanced && (level === 'middle' || level === 'upper' || level === 'high' || level === 'top')) {
        enhanced.style.display = 'block';
    }
}

function selectCategory(category, element) {
    const buttons = document.querySelectorAll('.level-btn');
    buttons.forEach(btn => btn.classList.remove('selected'));
    const target = element || (window.event && window.event.target);
    if (target) {
        target.classList.add('selected');
    }
    selectedCategory = category;
    const categoryInput = document.getElementById('taskCategory');
    if (categoryInput) categoryInput.value = category;
}

// ===== CHECK REFERRAL CODE =====
function checkReferralCode() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('ref');
}

// ===== TASK REGISTRATION =====
function processTaskRegistration(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    if (!data.phone || !data.fullName || !data.email || !selectedCategory) {
        showNotification('Please fill all required fields and select a category', 'error');
        return;
    }
    
    if (!data.phone.match(/^254[0-9]{9}$/)) {
        showNotification('Please use correct phone format: 254XXXXXXXXX', 'error');
        return;
    }
    
    data.category = selectedCategory;
    initiateMpesaPayment(500, data.phone, data, 'processTaskSuccess');
}

function processTaskSuccess(formData) {
    console.log('Processing TASK registration with database sync...');
    
    const referralCode = checkReferralCode();
    
    const syncResult = window.TauDB.sync(formData, 'TASK', referralCode);
    
    if (syncResult.success) {
        const member = syncResult.member;
        
        window.TauDB.sendWelcomeEmail(member)
            .then(() => {
                console.log('‚úÖ Welcome email sent');
            })
            .catch(err => {
                console.error('Email error:', err);
            });
        
        sendEmailToOrganization(formData, 'NEW TASK TEAM REGISTRATION - PAYMENT CONFIRMED')
            .then(() => {
                console.log('‚úÖ Organization notified');
            });
        
        showNotification(
            `‚úÖ Registration Complete!\n\nMember ID: ${member.id}\nReferral Code: ${member.referralCode}\n\nShare your referral code and earn 500 iKbp (50 KSH) per referral!`,
            'success'
        );
        
        showSuccessModal(member);
        closeAllModals();
    } else {
        showNotification(`‚ö†Ô∏è Registration processed but sync failed: ${syncResult.error}`, 'error');
    }
}

// ===== TALK REGISTRATION =====
function processTalkRegistration(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    if (!data.phone || !data.fullName || !data.email || !selectedLevel) {
        showNotification('Please fill all required fields and select a support level', 'error');
        return;
    }
    
    if (!data.phone.match(/^254[0-9]{9}$/)) {
        showNotification('Please use correct phone format: 254XXXXXXXXX', 'error');
        return;
    }
    
    data.supportLevel = selectedLevel;
    initiateMpesaPayment(2000, data.phone, data, 'processTalkSuccess');
}

function processTalkSuccess(formData) {
    console.log('Processing TALK registration with database sync...');
    
    const referralCode = checkReferralCode();
    
    const syncResult = window.TauDB.sync(formData, 'TALK', referralCode);
    
    if (syncResult.success) {
        const member = syncResult.member;
        
        window.TauDB.sendWelcomeEmail(member)
            .then(() => {
                console.log('‚úÖ Welcome email sent');
            })
            .catch(err => {
                console.error('Email error:', err);
            });
        
        sendEmailToOrganization(formData, 'NEW TALK TEAM REGISTRATION - PAYMENT CONFIRMED')
            .then(() => {
                console.log('‚úÖ Organization notified');
            });
        
        showNotification(
            `‚úÖ Registration Complete!\n\nMember ID: ${member.id}\nReferral Code: ${member.referralCode}\n\nShare your referral code and earn 500 iKbp (50 KSH) per referral!`,
            'success'
        );
        
        showSuccessModal(member);
        closeAllModals();
    } else {
        showNotification(`‚ö†Ô∏è Registration processed but sync failed: ${syncResult.error}`, 'error');
    }
}

// ===== JOB CREATION TRAINING =====
function processJobCreationTraining(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    if (!data.phone || !data.fullName || !data.email) {
        showNotification('Please fill all required fields', 'error');
        return;
    }
    
    if (!data.phone.match(/^254[0-9]{9}$/)) {
        showNotification('Please use correct phone format: 254XXXXXXXXX', 'error');
        return;
    }
    
    initiateMpesaPayment(1500, data.phone, data, 'processJobCreationSuccess');
}

function processJobCreationSuccess(formData) {
    console.log('Processing Job Creation enrollment with database sync...');
    
    const referralCode = checkReferralCode();
    
    const syncResult = window.TauDB.sync(formData, 'JOB_CREATION', referralCode);
    
    if (syncResult.success) {
        const member = syncResult.member;
        
        window.TauDB.sendWelcomeEmail(member)
            .then(() => {
                console.log('‚úÖ Welcome email sent');
            })
            .catch(err => {
                console.error('Email error:', err);
            });
        
        sendEmailToOrganization(formData, 'JOB CREATION TRAINING ENROLLMENT - PAYMENT CONFIRMED')
            .then(() => {
                console.log('‚úÖ Organization notified');
            });
        
        showNotification(
            `‚úÖ Training Enrollment Complete!\n\nMember ID: ${member.id}\nReferral Code: ${member.referralCode}`,
            'success'
        );
        
        showSuccessModal(member);
        closeAllModals();
    } else {
        showNotification(`‚ö†Ô∏è Enrollment processed but sync failed: ${syncResult.error}`, 'error');
    }
}

// ===== SUCCESS MODAL =====
function showSuccessModal(member) {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content">
            <h2 style="color: #2ecc71; text-align: center;">üéâ Registration Successful!</h2>
            
            <div style="background: linear-gradient(45deg, #4169e1, #87ceeb); color: white; padding: 30px; border-radius: 15px; margin: 20px 0; text-align: center;">
                <h3>Your Member ID</h3>
                <h1 style="font-size: 2.5rem; margin: 15px 0; letter-spacing: 2px;">${member.id}</h1>
                <p style="font-size: 1.1rem;">Save this ID - You'll need it to login!</p>
            </div>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h4 style="color: #2a5298; margin-bottom: 15px;">üìß Login Credentials</h4>
                <p><strong>Email:</strong> ${member.email}</p>
                <p><strong>Phone (last 4 digits):</strong> ${member.phone.slice(-4)}</p>
                <p style="margin-top: 15px;"><strong>Team:</strong> ${member.team}</p>
                <p><strong>Membership Fee:</strong> KSH ${member.fee}</p>
            </div>
            
            <div style="background: linear-gradient(45deg, #ffd700, #ffed4e); padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h4 style="color: #333; margin-bottom: 10px;">üí∞ Referral Program</h4>
                <p style="color: #333;"><strong>Your Referral Code:</strong></p>
                <h2 style="color: #333; margin: 10px 0; letter-spacing: 3px;">${member.referralCode}</h2>
                <p style="color: #333; font-size: 0.9rem;">Share this code and earn 500 iKbp (50 KSH) for each successful referral!</p>
                <button class="btn" onclick="copyReferralLink('${member.referralCode}')" style="margin-top: 10px;">
                    üìã Copy Referral Link
                </button>
            </div>
            
            <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h4 style="color: #1976d2;">üì® Welcome Email Sent</h4>
                <p>Check your email (${member.email}) for:</p>
                <ul style="margin-top: 10px;">
                    <li>Complete login instructions</li>
                    <li>Your referral link</li>
                    <li>Getting started guide</li>
                    <li>Kabiru Mining access</li>
                </ul>
            </div>
            
            <div style="margin-top: 30px;">
                <button class="btn" onclick="proceedToLogin()" style="width: 100%; font-size: 1.1rem;">
                    üöÄ Access Your Account Now
                </button>
                <button class="btn" onclick="closeAllModals()" style="width: 100%; margin-top: 10px; background: #95a5a6;">
                    Close
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

// ===== REFERRAL FUNCTIONS =====
function copyReferralLink(referralCode) {
    const link = `${window.location.origin}?ref=${referralCode}`;
    navigator.clipboard.writeText(link).then(() => {
        showNotification('‚úÖ Referral link copied to clipboard!', 'success');
    }).catch(() => {
        prompt('Copy your referral link:', link);
    });
}

function proceedToLogin() {
    closeAllModals();
    showRealMemberLogin();
}

// ===== OTHER FORM SUBMISSIONS =====
function processTrainingRegistration(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    sendEmailToOrganization(data, 'TRAINING PROGRAM REGISTRATION')
        .then(success => {
            if (success) {
                showNotification('‚úÖ Training registration successful!', 'success');
                closeAllModals();
            } else {
                showNotification('‚ùå Email failed. Please contact grouptauafrica@gmail.com', 'error');
            }
        });
}

function processWorkshopProposal(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    sendEmailToOrganization(data, 'WORKSHOP PROPOSAL SUBMISSION')
        .then(success => {
            if (success) {
                showNotification('‚úÖ Workshop proposal submitted!', 'success');
                closeAllModals();
            } else {
                showNotification('‚ùå Email failed. Please contact grouptauafrica@gmail.com', 'error');
            }
        });
}

function processResearchRequest(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    sendEmailToOrganization(data, 'RESEARCH SERVICES REQUEST')
        .then(success => {
            if (success) {
                showNotification('‚úÖ Research request submitted!', 'success');
                closeAllModals();
            } else {
                showNotification('‚ùå Email failed. Please contact grouptauafrica@gmail.com', 'error');
            }
        });
}

function processCommunityRegistration(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    sendEmailToOrganization(data, 'COMMUNITY PROGRAM REGISTRATION')
        .then(success => {
            if (success) {
                showNotification('‚úÖ Community registration successful!', 'success');
                closeAllModals();
            } else {
                showNotification('‚ùå Email failed. Please contact grouptauafrica@gmail.com', 'error');
            }
        });
}

// ===== AI ASSISTANT FUNCTIONS =====
function toggleAIChat() {
    const chatWindow = document.getElementById('aiChatWindow');
    if (chatWindow.style.display === 'none' || !chatWindow.style.display) {
        chatWindow.style.display = 'flex';
    } else {
        chatWindow.style.display = 'none';
    }
}

function handleAIChatKeyPress(event) {
    if (event.key === 'Enter') {
        sendAIMessage();
    }
}

function sendAIMessage() {
    const input = document.getElementById('aiChatInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    const messagesContainer = document.getElementById('aiChatMessages');
    
    const userMessage = document.createElement('div');
    userMessage.className = 'ai-message user-message';
    userMessage.textContent = message;
    messagesContainer.appendChild(userMessage);
    
    input.value = '';
    
    setTimeout(() => {
        const aiResponse = generateAIResponse(message);
        const aiMessage = document.createElement('div');
        aiMessage.className = 'ai-message';
        aiMessage.innerHTML = aiResponse;
        messagesContainer.appendChild(aiMessage);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }, 1000);
    
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function generateAIResponse(userMessage) {
    const message = userMessage.toLowerCase();
    
    if (message.includes('register') || message.includes('join')) {
        return `To register with TAU Africa, you can choose between:<br>
        ‚Ä¢ <strong>TASK Team (KSH 500)</strong> - For service providers<br>
        ‚Ä¢ <strong>TALK Team (KSH 2,000)</strong> - For investors<br>
        ‚Ä¢ <strong>Job Creation Training (KSH 1,500)</strong> - For entrepreneurs<br>
        <br>Click the relevant buttons to get started!`;
    }
    
    if (message.includes('payment') || message.includes('mpesa')) {
        return `Our payment process uses M-PESA:<br>
        1. Enter your M-PESA number (254XXXXXXXXX format)<br>
        2. You'll receive a payment prompt on your phone<br>
        3. Enter your M-PESA PIN to confirm<br>
        4. Wait for confirmation<br>
        <br>All payments are secure!`;
    }
    
    if (message.includes('kabiru') || message.includes('mining')) {
        return `Kabiru is our digital currency! You can:<br>
        ‚Ä¢ Mine Kabiru by validating real values<br>
        ‚Ä¢ Use the mining portal<br>
        ‚Ä¢ Earn through community contributions`;
    }
    
    return `Thank you! I can help you with:<br>
    ‚Ä¢ Registration and membership<br>
    ‚Ä¢ Payment and M-PESA guidance<br>
    ‚Ä¢ Kabiru mining<br>
    ‚Ä¢ Community programs<br>
    <br>Contact: <strong>grouptauafrica@gmail.com</strong>`;
}

// ===== EVENT LISTENERS =====
document.addEventListener('click', function(event) {
    if (event.target.classList.contains('modal')) {
        closeAllModals();
    }
});

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeAllModals();
        document.getElementById('aiChatWindow').style.display = 'none';
    }
});
// ===== TAU AFRICA DATABASE SYSTEM =====

// Database Configuration
const DB_CONFIG = {
    dbKey: 'tauAfricaDB',
    credentialsKey: 'tauCredentials',
    referralsKey: 'tauReferrals',
    jobsPortalKey: 'tauJobsPortal',
    sessionKey: 'tauCurrentUser'
};

// ===== MEMBER ID & REFERRAL CODE GENERATION =====
function generateMemberID(team, referralCode = null) {
    const prefix = team === 'TASK' ? 'TSK' : team === 'TALK' ? 'TLK' : 'JOB';
    const timestamp = Date.now().toString().slice(-6);
    const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
    const id = `${prefix}-${timestamp}-${random}`;
    
    if (referralCode) {
        trackReferral(referralCode, id);
    }
    
    return id;
}

function generateReferralCode(memberId) {
    return btoa(memberId).substring(0, 8).toUpperCase();
}

// ===== REFERRAL TRACKING =====
function trackReferral(referralCode, newMemberId) {
    try {
        const referrals = JSON.parse(localStorage.getItem(DB_CONFIG.referralsKey) || '{}');
        const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
        const referrer = members.find(m => m.referralCode === referralCode);
        
        if (referrer) {
            if (!referrals[referrer.id]) {
                referrals[referrer.id] = {
                    memberId: referrer.id,
                    referredMembers: [],
                    totalEarnings: 0
                };
            }
            
            const earnings = 500;
            referrals[referrer.id].referredMembers.push({
                memberId: newMemberId,
                date: new Date().toISOString(),
                earnings: earnings
            });
            referrals[referrer.id].totalEarnings += earnings;
            
            localStorage.setItem(DB_CONFIG.referralsKey, JSON.stringify(referrals));
            
            sendReferralNotification(referrer, earnings);
        }
    } catch (error) {
        console.error('Referral tracking error:', error);
    }
}

function sendReferralNotification(referrer, earnings) {
    const templateParams = {
        to_email: referrer.email,
        to_name: referrer.fullName,
        subject: 'üéâ Referral Bonus Earned!',
        message: `Congratulations! You've earned ${earnings} iKbp (${earnings/10} KSH) from your referral. Total: ${getReferralEarnings(referrer.id)} iKbp.`,
        from_name: 'TAU Africa',
        from_email: 'grouptauafrica@gmail.com',
        phone: referrer.phone || 'Not provided',
        location: referrer.location || 'Not provided'
    };
    
    emailjs.send('service_xfira7g', 'template_bqxztig', templateParams)
        .catch(err => console.error('Referral email error:', err));
}

function getReferralEarnings(memberId) {
    const referrals = JSON.parse(localStorage.getItem(DB_CONFIG.referralsKey) || '{}');
    return referrals[memberId]?.totalEarnings || 0;
}

// ===== CORE DATABASE SYNC FUNCTION =====
function syncToDatabase(formData, team, referralCode = null) {
    try {
        const existingMembers = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
        
        const memberId = generateMemberID(team, referralCode);
        const memberReferralCode = generateReferralCode(memberId);
        
        const member = {
            id: memberId,
            referralCode: memberReferralCode,
            team: team,
            fullName: formData.fullName || formData.name,
            email: formData.email,
            phone: formData.phone,
            location: formData.location,
            paymentStatus: 'Paid',
            dateJoined: new Date().toISOString().split('T')[0],
            status: 'Active',
            fee: team === 'TASK' ? 500 : team === 'TALK' ? 2000 : 1500,
            accountCreated: new Date().toISOString(),
            lastLogin: null,
            activities: [],
            tasks: [],
            jobs: [],
            iKbpBalance: 0,
            referredBy: referralCode || null
        };
        
        // Add team-specific fields
        if (team === 'TASK') {
            member.dateOfBirth = formData.dateOfBirth;
            member.gender = formData.gender;
            member.nationality = formData.nationality;
            member.category = formData.category;
            member.valueDescription = formData.valueDescription;
            member.experience = formData.experience;
            member.certifications = formData.certifications;
            member.languages = formData.languages;
            member.goodConduct = formData.goodConduct;
            member.healthStatus = formData.healthStatus;
            member.trackRecord = formData.trackRecord;
            member.familySupport = formData.familySupport;
            member.education = formData.education;
            member.emergencyContact = formData.emergencyContact;
            member.referralSource = formData.referralSource;
        } else if (team === 'TALK') {
            member.organizationType = formData.organizationType;
            member.website = formData.website;
            member.supportLevel = formData.supportLevel;
            member.supportTypes = formData.supportTypes;
            member.focusAreas = formData.focusAreas;
            member.geographicFocus = formData.geographicFocus;
            member.investmentCriteria = formData.investmentCriteria;
            member.previousInvestments = formData.previousInvestments;
            member.goodConduct = formData.goodConduct;
            member.healthStatus = formData.healthStatus;
            member.financialTrack = formData.financialTrack;
            member.netWorth = formData.netWorth;
            member.familyFinancial = formData.familyFinancial;
        } else if (team === 'JOB_CREATION') {
            member.ageRange = formData.ageRange;
            member.employmentStatus = formData.employmentStatus;
            member.businessIdea = formData.businessIdea;
            member.targetMarket = formData.targetMarket;
            member.startupFunds = formData.startupFunds;
            member.education = formData.education;
            member.relevantSkills = formData.relevantSkills;
            member.focus = formData.focus;
            member.learningFormat = formData.learningFormat;
            member.businessTimeline = formData.businessTimeline;
        }
        
        existingMembers.push(member);
        localStorage.setItem(DB_CONFIG.dbKey, JSON.stringify(existingMembers));
        
        storeMemberCredentials(member);
        
        window.dispatchEvent(new CustomEvent('tauMemberAdded', { detail: member }));
        
        console.log('‚úÖ Member synced to database:', memberId);
        return { success: true, memberId, member };
        
    } catch (error) {
        console.error('‚ùå Database sync error:', error);
        return { success: false, error: error.message };
    }
}

// ===== CREDENTIALS STORAGE =====
function storeMemberCredentials(member) {
    const credentials = JSON.parse(localStorage.getItem(DB_CONFIG.credentialsKey) || '{}');
    credentials[member.id] = {
        email: member.email,
        phone: member.phone.slice(-4),
        fullName: member.fullName
    };
    localStorage.setItem(DB_CONFIG.credentialsKey, JSON.stringify(credentials));
}

// ===== AUTHENTICATION =====
function authenticateMember(identifier, phoneLastFour) {
    try {
        const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
        const member = members.find(m => 
            (m.id === identifier || m.email === identifier) && 
            m.phone.slice(-4) === phoneLastFour
        );
        
        if (member) {
            member.lastLogin = new Date().toISOString();
            const memberIndex = members.findIndex(m => m.id === member.id);
            members[memberIndex] = member;
            localStorage.setItem(DB_CONFIG.dbKey, JSON.stringify(members));
            
            sessionStorage.setItem(DB_CONFIG.sessionKey, JSON.stringify(member));
            return { success: true, member };
        }
        
        return { success: false, error: 'Invalid credentials' };
    } catch (error) {
        console.error('Authentication error:', error);
        return { success: false, error: error.message };
    }
}

function getCurrentMember() {
    const sessionData = sessionStorage.getItem(DB_CONFIG.sessionKey);
    if (sessionData) {
        const member = JSON.parse(sessionData);
        // Refresh from database to get latest data
        const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
        const freshMember = members.find(m => m.id === member.id);
        if (freshMember) {
            sessionStorage.setItem(DB_CONFIG.sessionKey, JSON.stringify(freshMember));
            return freshMember;
        }
    }
    return null;
}

function logoutMember() {
    sessionStorage.removeItem(DB_CONFIG.sessionKey);
    return true;
}

// ===== UPDATE MEMBER DATA =====
function updateMemberData(memberId, updates) {
    try {
        const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
        const memberIndex = members.findIndex(m => m.id === memberId);
        
        if (memberIndex !== -1) {
            members[memberIndex] = { ...members[memberIndex], ...updates };
            localStorage.setItem(DB_CONFIG.dbKey, JSON.stringify(members));
            
            const currentUser = getCurrentMember();
            if (currentUser && currentUser.id === memberId) {
                sessionStorage.setItem(DB_CONFIG.sessionKey, JSON.stringify(members[memberIndex]));
            }
            
            return { success: true, member: members[memberIndex] };
        }
        
        return { success: false, error: 'Member not found' };
    } catch (error) {
        return { success: false, error: error.message };
    }
}

// ===== ACTIVITY MANAGEMENT =====
function addMemberActivity(memberId, activity) {
    try {
        const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
        const member = members.find(m => m.id === memberId);
        
        if (member) {
            if (!member.activities) member.activities = [];
            
            const activityRecord = {
                id: `ACT-${Date.now()}`,
                type: activity.type,
                description: activity.description,
                dateAdded: new Date().toISOString(),
                status: 'Active',
                iKbpEarned: 0
            };
            
            member.activities.push(activityRecord);
            updateMemberData(memberId, { activities: member.activities });
            
            return { success: true, activity: activityRecord };
        }
        
        return { success: false, error: 'Member not found' };
    } catch (error) {
        return { success: false, error: error.message };
    }
}

// ===== TASK MANAGEMENT =====
function addMemberTask(memberId, task) {
    try {
        const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
        const member = members.find(m => m.id === memberId);
        
        if (member) {
            if (!member.tasks) member.tasks = [];
            
            const taskRecord = {
                id: `TSK-${Date.now()}`,
                title: task.title,
                description: task.description,
                category: task.category,
                dateAssigned: new Date().toISOString(),
                dueDate: task.dueDate || null,
                status: 'Assigned',
                iKbpReward: task.reward || 100,
                completedDate: null
            };
            
            member.tasks.push(taskRecord);
            updateMemberData(memberId, { tasks: member.tasks });
            
            return { success: true, task: taskRecord };
        }
        
        return { success: false, error: 'Member not found' };
    } catch (error) {
        return { success: false, error: error.message };
    }
}

function completeTask(memberId, taskId) {
    try {
        const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
        const member = members.find(m => m.id === memberId);
        
        if (member && member.tasks) {
            const task = member.tasks.find(t => t.id === taskId);
            
            if (task && task.status !== 'Completed') {
                task.status = 'Completed';
                task.completedDate = new Date().toISOString();
                
                member.iKbpBalance = (member.iKbpBalance || 0) + task.iKbpReward;
                
                updateMemberData(memberId, { 
                    tasks: member.tasks,
                    iKbpBalance: member.iKbpBalance
                });
                
                return { 
                    success: true, 
                    task, 
                    newBalance: member.iKbpBalance,
                    earned: task.iKbpReward
                };
            }
        }
        
        return { success: false, error: 'Task not found or already completed' };
    } catch (error) {
        return { success: false, error: error.message };
    }
}

// ===== JOBS PORTAL =====
function postJobToPortal(jobData, posterId) {
    try {
        const jobs = JSON.parse(localStorage.getItem(DB_CONFIG.jobsPortalKey) || '[]');
        
        const job = {
            id: `JOB-${Date.now()}`,
            posterId: posterId,
            title: jobData.title,
            category: jobData.category,
            location: jobData.location,
            description: jobData.description,
            requirements: jobData.requirements,
            salary: jobData.salary,
            datePosted: new Date().toISOString(),
            status: 'Active',
            applications: []
        };
        
        jobs.push(job);
        localStorage.setItem(DB_CONFIG.jobsPortalKey, JSON.stringify(jobs));
        
        const member = getCurrentMember();
        if (member) {
            const newBalance = (member.iKbpBalance || 0) + 50;
            updateMemberData(posterId, { iKbpBalance: newBalance });
        }
        
        return { success: true, job, iKbpEarned: 50 };
    } catch (error) {
        return { success: false, error: error.message };
    }
}

function getJobsFromPortal(filters = {}) {
    try {
        let jobs = JSON.parse(localStorage.getItem(DB_CONFIG.jobsPortalKey) || '[]');
        
        if (filters.category) {
            jobs = jobs.filter(j => j.category === filters.category);
        }
        if (filters.location) {
            jobs = jobs.filter(j => j.location.toLowerCase().includes(filters.location.toLowerCase()));
        }
        if (filters.status) {
            jobs = jobs.filter(j => j.status === filters.status);
        }
        
        return { success: true, jobs };
    } catch (error) {
        return { success: false, error: error.message };
    }
}

function applyForJob(jobId, memberId, applicationData) {
    try {
        const jobs = JSON.parse(localStorage.getItem(DB_CONFIG.jobsPortalKey) || '[]');
        const job = jobs.find(j => j.id === jobId);
        
        if (job) {
            const application = {
                id: `APP-${Date.now()}`,
                memberId: memberId,
                applicantName: applicationData.applicantName,
                applicantEmail: applicationData.applicantEmail,
                applicantPhone: applicationData.applicantPhone,
                coverLetter: applicationData.coverLetter,
                dateApplied: new Date().toISOString(),
                status: 'Pending'
            };
            
            job.applications.push(application);
            localStorage.setItem(DB_CONFIG.jobsPortalKey, JSON.stringify(jobs));
            
            return { success: true, application };
        }
        
        return { success: false, error: 'Job not found' };
    } catch (error) {
        return { success: false, error: error.message };
    }
}

// ===== WELCOME EMAIL =====
function sendWelcomeEmailWithCredentials(member) {
    const templateParams = {
        to_email: member.email,
        to_name: member.fullName,
        subject: 'üéâ Welcome to TAU Africa - Your Account Details',
        message: `
Welcome to TAU Africa Foundation!

Your account has been successfully created:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Member ID: ${member.id}
Team: ${member.team}
Referral Code: ${member.referralCode}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

LOGIN INSTRUCTIONS:
1. Use your Member ID or Email: ${member.email}
2. Use last 4 digits of your phone: ${member.phone.slice(-4)}

REFERRAL REWARDS:
Share your referral code and earn 500 iKbp (50 KSH) for each successful referral!
Your referral link: ${window.location.origin}?ref=${member.referralCode}

ACCESS YOUR ACCOUNT:
‚Ä¢ Main Portal: ${window.location.origin}
‚Ä¢ Kabiru Mining: https://magero1985.github.io/Kabiru-Mining-Portal-/

Start earning Kabiru points (iKbp) by:
‚Ä¢ Completing tasks
‚Ä¢ Participating in activities
‚Ä¢ Referring new members
‚Ä¢ Contributing to the community

Current Balance: ${member.iKbpBalance} iKbp (${member.iKbpBalance/10} KSH)

Welcome to the movement!
TAU Africa Foundation
        `,
        from_name: 'TAU Africa',
        from_email: 'grouptauafrica@gmail.com',
        phone: member.phone,
        location: member.location
    };
    
    return emailjs.send('service_xfira7g', 'template_bqxztig', templateParams);
}

// ===== MEMBER LOGIN =====
function showRealMemberLogin() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content">
            <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
            <h2 style="color: #2a5298; text-align: center;">Member Login</h2>
            <p style="text-align: center; color: #666;">Access your TAU Africa account</p>
            
            <form onsubmit="processRealLogin(event)" style="margin-top: 30px;">
                <div class="form-group">
                    <label>Member ID or Email *</label>
                    <input type="text" id="loginIdentifier" required placeholder="Enter your Member ID or Email">
                </div>
                
                <div class="form-group">
                    <label>Phone Number (Last 4 digits) *</label>
                    <input type="text" id="loginPhone" required placeholder="Last 4 digits" maxlength="4" pattern="[0-9]{4}">
                    <small>Use the last 4 digits of your registered phone number</small>
                </div>
                
                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">
                    üîê Login to Dashboard
                </button>
            </form>
            
            <div style="text-align: center; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                <p style="font-size: 0.9rem; color: #666;">Don't have an account?</p>
                <button class="btn btn-small" onclick="closeAllModals(); openModal('taskRegistration')" style="margin: 5px;">
                    Join TASK Team
                </button>
                <button class="btn btn-small" onclick="closeAllModals(); openModal('talkRegistration')" style="margin: 5px;">
                    Join TALK Team
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function processRealLogin(event) {
    event.preventDefault();
    
    const identifier = document.getElementById('loginIdentifier').value.trim();
    const phoneLastFour = document.getElementById('loginPhone').value.trim();
    
    const result = window.TauDB.authenticate(identifier, phoneLastFour);
    
    if (result.success) {
        showNotification('‚úÖ Login successful! Loading your dashboard...', 'success');
        
        setTimeout(() => {
            closeAllModals();
            showRealMemberDashboard(result.member);
        }, 1000);
    } else {
        showNotification('‚ùå Invalid credentials. Please check your Member ID/Email and phone number.', 'error');
    }
}

function showMemberLogin() {
    showRealMemberLogin();
}

// ===== EXPORT DATABASE API =====
window.TauDB = {
    sync: syncToDatabase,
    authenticate: authenticateMember,
    getCurrentMember: getCurrentMember,
    logout: logoutMember,
    updateMember: updateMemberData,
    addActivity: addMemberActivity,
    addTask: addMemberTask,
    completeTask: completeTask,
    postJob: postJobToPortal,
    getJobs: getJobsFromPortal,
    applyJob: applyForJob,
    sendWelcomeEmail: sendWelcomeEmailWithCredentials,
    getReferralEarnings: getReferralEarnings,
    generateReferralCode: generateReferralCode
};

// ===== INITIALIZATION ON PAGE LOAD =====
document.addEventListener('DOMContentLoaded', function() {
    const ref = checkReferralCode();
    if (ref) {
        showNotification(`üéÅ You're using referral code: ${ref}. The referrer will earn 500 iKbp when you complete registration!`, 'info');
    }
    
    console.log('========================================');
    console.log('TAU AFRICA INTERNATIONAL - INITIALIZED');
    console.log('========================================');
    console.log('‚úÖ EmailJS Status: ACTIVE');
    console.log('‚úÖ Database: READY');
    console.log('‚úÖ Authentication: ENABLED');
    console.log('‚úÖ M-PESA Payment: READY');
    console.log('========================================');
});

console.log('‚úÖ Part 3 Loaded: Database System & Authentication');
    // ===== MEMBER DASHBOARD =====
function showRealMemberDashboard(member) {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.style.overflowY = 'auto';
    
    const currentMember = window.TauDB.getCurrentMember();
    const displayMember = currentMember || member;
    
    modal.innerHTML = `
        <div class="modal-content" style="max-width: 1200px; padding: 20px;">
            <span class="close" onclick="window.TauDB.logout(); this.parentElement.parentElement.remove()">&times;</span>
            
            <!-- Header -->
            <div style="background: linear-gradient(45deg, #4169e1, #87ceeb); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                <h1 style="margin: 0 0 10px 0;">Welcome, ${displayMember.fullName}! üëã</h1>
                <p style="margin: 0; opacity: 0.9;">Member ID: <strong>${displayMember.id}</strong> | Team: <strong>${displayMember.team}</strong></p>
                <p style="margin: 10px 0 0 0; font-size: 0.9rem;">Last login: ${displayMember.lastLogin ? new Date(displayMember.lastLogin).toLocaleString() : 'First login'}</p>
            </div>
            
            <!-- Dashboard Stats -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div style="background: linear-gradient(135deg, #ffd700, #ffed4e); padding: 25px; border-radius: 15px; text-align: center; color: #333;">
                    <h3 style="margin: 0 0 10px 0;">üí∞ Kabiru Points</h3>
                    <h1 style="margin: 0; font-size: 2.5rem;">${displayMember.iKbpBalance || 0}</h1>
                    <p style="margin: 10px 0 0 0;">iKbp ‚âà KSH ${((displayMember.iKbpBalance || 0) / 10).toFixed(2)}</p>
                    <button class="btn" onclick="window.open('https://magero1985.github.io/Kabiru-Mining-Portal-/', '_blank')" style="margin-top: 15px; background: #333; width: 100%;">
                        ‚ö° Mine More Kabiru
                    </button>
                </div>
                
                <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 25px; border-radius: 15px; text-align: center; color: white;">
                    <h3 style="margin: 0 0 10px 0;">‚úÖ Tasks</h3>
                    <h1 style="margin: 0; font-size: 2.5rem;">${(displayMember.tasks || []).filter(t => t.status !== 'Completed').length}</h1>
                    <p style="margin: 10px 0 0 0;">Active | ${(displayMember.tasks || []).filter(t => t.status === 'Completed').length} Completed</p>
                </div>
                
                <div style="background: linear-gradient(135deg, #2ecc71, #27ae60); padding: 25px; border-radius: 15px; text-align: center; color: white;">
                    <h3 style="margin: 0 0 10px 0;">üéÅ Referrals</h3>
                    <h1 style="margin: 0; font-size: 2.5rem;">${window.TauDB.getReferralEarnings(displayMember.id)}</h1>
                    <p style="margin: 10px 0 0 0;">iKbp Earned</p>
                </div>
            </div>
            
            <!-- Profile Info -->
            <div style="background: white; padding: 25px; border-radius: 15px; border: 2px solid #eee; margin-bottom: 20px;">
                <h3 style="color: #2a5298; margin-bottom: 20px;">üë§ Your Profile</h3>
                <div style="display: grid; gap: 10px;">
                    <p><strong>Email:</strong> ${displayMember.email}</p>
                    <p><strong>Phone:</strong> ${displayMember.phone}</p>
                    <p><strong>Location:</strong> ${displayMember.location}</p>
                    <p><strong>Status:</strong> <span style="color: #2ecc71; font-weight: bold;">${displayMember.status}</span></p>
                    <p><strong>Referral Code:</strong> <span style="font-weight: bold; color: #ffd700;">${displayMember.referralCode}</span></p>
                </div>
            </div>
            
            <!-- Referral Section -->
            <div style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                <h4 style="margin: 0 0 15px 0;">üéÅ Your Referral Code</h4>
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h1 style="margin: 0; font-size: 2.5rem; letter-spacing: 3px;">${displayMember.referralCode}</h1>
                </div>
                <button class="btn" onclick="copyReferralLink('${displayMember.referralCode}')" style="background: white; color: #667eea; width: 100%;">
                    üìã Copy Referral Link
                </button>
                <p style="margin-top: 10px; font-size: 0.9rem;">Share and earn 500 iKbp (50 KSH) per referral!</p>
            </div>
            
            <!-- Quick Actions -->
            <div style="background: #f8f9fa; padding: 25px; border-radius: 15px;">
                <h3 style="color: #2a5298; margin-bottom: 20px;">‚ö° Quick Actions</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <button class="btn btn-success" onclick="window.open('https://magero1985.github.io/Kabiru-Mining-Portal-/', '_blank')">‚ö° Kabiru Mining</button>
                    <button class="btn" onclick="copyReferralLink('${displayMember.referralCode}')">üìã Share Referral</button>
                    <button class="btn" onclick="alert('Contact: grouptauafrica@gmail.com')">üí¨ Support</button>
                    <button class="btn" onclick="window.TauDB.logout(); closeAllModals(); showNotification('Logged out successfully', 'success');" style="background: #e74c3c;">üö™ Logout</button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
}

// ===== GET MODAL CONTENT =====
function getModalContent(type) {
    switch(type) {
        case 'taskRegistration':
            return createTaskRegistrationModal();
        case 'talkRegistration':
            return createTalkRegistrationModal();
        case 'jobCreation':
            return createJobCreationModal();
        case 'training':
            return createTrainingModal();
        case 'workshop':
            return createWorkshopModal();
        case 'research':
            return createResearchModal();
        case 'community':
            return createCommunityModal();
        case 'corporate':
            return createCorporateModal();
        case 'parSirai':
            return createParSiraiModal();
        case 'trustGraph':
            return createTrustGraphModal();
        case 'foundation':
            return createFoundationModal();
        case 'holdings':
            return createHoldingsModal();
        case 'forum':
            return createForumModal();
        default:
            return '<div class="modal-content"><span class="close" onclick="closeAllModals()">&times;</span><h2>Feature Coming Soon</h2><p>This feature is under development.</p></div>';
    }
}

// ===== TASK REGISTRATION MODAL =====
function createTaskRegistrationModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>Join TASK Team</h2>
            <p>Declare the values or services you're offering to the TAU Africa community</p>
            
            <div class="payment-info">
                <h3>Registration Fee: KSH 500</h3>
                <p>Secure M-PESA payment required</p>
            </div>
            
            <form onsubmit="processTaskRegistration(event)" id="taskForm">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" name="fullName" required placeholder="Enter your full legal name">
                </div>
                
                <div class="form-group">
                    <label>Email Address *</label>
                    <input type="email" name="email" required placeholder="your.email@example.com">
                </div>
                
                <div class="form-group">
                    <label>Phone Number (M-PESA) *</label>
                    <input type="tel" name="phone" required placeholder="254XXXXXXXXX" pattern="254[0-9]{9}">
                    <small>Format: 254XXXXXXXXX (include country code)</small>
                </div>
                
                <div class="form-group">
                    <label>Country/Location *</label>
                    <input type="text" name="location" required placeholder="City, Country">
                </div>

                <div class="form-group">
                    <label>Date of Birth *</label>
                    <input type="date" name="dateOfBirth" required>
                </div>

                <div class="form-group">
                    <label>Gender *</label>
                    <select name="gender" required>
                        <option value="">Select gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Nationality *</label>
                    <input type="text" name="nationality" required placeholder="Your nationality">
                </div>
                
                <div class="form-group">
                    <label>Value Category *</label>
                    <div class="level-selection">
                        <div class="level-btn" onclick="selectCategory('skills', this)">Skills & Crafts</div>
                        <div class="level-btn" onclick="selectCategory('knowledge', this)">Knowledge & Expertise</div>
                        <div class="level-btn" onclick="selectCategory('service', this)">Professional Service</div>
                        <div class="level-btn" onclick="selectCategory('profession', this)">Licensed Profession</div>
                        <div class="level-btn" onclick="selectCategory('creativity', this)">Creative Arts</div>
                        <div class="level-btn" onclick="selectCategory('leadership', this)">Leadership</div>
                        <div class="level-btn" onclick="selectCategory('business', this)">Business</div>
                    </div>
                    <input type="hidden" name="category" id="taskCategory" required>
                </div>
                
                <div class="form-group">
                    <label>Describe Your Value/Service *</label>
                    <textarea name="valueDescription" rows="4" placeholder="Detailed description of what you offer" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Experience Level *</label>
                    <select name="experience" required>
                        <option value="">Select level</option>
                        <option value="Beginner">Beginner (0-2 years)</option>
                        <option value="Intermediate">Intermediate (2-5 years)</option>
                        <option value="Advanced">Advanced (5-10 years)</option>
                        <option value="Expert">Expert (10+ years)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Professional Certifications</label>
                    <textarea name="certifications" rows="2" placeholder="List certifications"></textarea>
                </div>

                <div class="form-group">
                    <label>Languages Spoken *</label>
                    <input type="text" name="languages" required placeholder="e.g., English, Swahili">
                </div>
                
                <div class="form-group">
                    <label>Certificate of Good Conduct Status *</label>
                    <select name="goodConduct" required>
                        <option value="">Select status</option>
                        <option value="Available">Available</option>
                        <option value="Will obtain">Will obtain</option>
                        <option value="In process">In process</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Health Records Status *</label>
                    <select name="healthStatus" required>
                        <option value="">Select status</option>
                        <option value="Excellent">Excellent</option>
                        <option value="Good">Good</option>
                        <option value="Will provide">Will provide</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Track Record/References</label>
                    <textarea name="trackRecord" rows="3" placeholder="Previous work, achievements"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Family/Support System</label>
                    <textarea name="familySupport" rows="2" placeholder="Brief description"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Educational Qualifications</label>
                    <textarea name="education" rows="2" placeholder="Degrees, certificates"></textarea>
                </div>

                <div class="form-group">
                    <label>Emergency Contact *</label>
                    <input type="text" name="emergencyContact" required placeholder="Name and phone number">
                </div>

                <div class="form-group">
                    <label>How did you hear about TAU Africa? *</label>
                    <select name="referralSource" required>
                        <option value="">Select source</option>
                        <option value="Social Media">Social Media</option>
                        <option value="Friend/Family">Friend or Family</option>
                        <option value="Community Event">Community Event</option>
                        <option value="Online Search">Online Search</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" name="terms" required style="width: auto; margin-right: 10px;">
                        I agree to the TAU Africa Terms of Service *
                    </label>
                </div>
                
                <button type="submit" class="btn btn-register">Proceed to M-PESA Payment (KSH 500)</button>
            </form>
        </div>
    `;
}

// ===== TALK REGISTRATION MODAL =====
function createTalkRegistrationModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>Join TALK Team</h2>
            <p>Declare financial support you're offering to African development</p>
            
            <div class="payment-info">
                <h3>Registration Fee: KSH 2,000</h3>
                <p>Secure M-PESA payment</p>
            </div>
            
            <form onsubmit="processTalkRegistration(event)" id="talkForm">
                <div class="form-group">
                    <label>Full Name/Organization *</label>
                    <input type="text" name="fullName" required>
                </div>
                
                <div class="form-group">
                    <label>Email Address *</label>
                    <input type="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label>Phone Number (M-PESA) *</label>
                    <input type="tel" name="phone" required placeholder="254XXXXXXXXX" pattern="254[0-9]{9}">
                </div>
                
                <div class="form-group">
                    <label>Location *</label>
                    <input type="text" name="location" required>
                </div>

                <div class="form-group">
                    <label>Organization Type *</label>
                    <select name="organizationType" required>
                        <option value="">Select type</option>
                        <option value="Individual Investor">Individual Investor</option>
                        <option value="Corporation">Corporation</option>
                        <option value="Foundation">Foundation/NGO</option>
                        <option value="Government">Government Agency</option>
                        <option value="Investment Fund">Investment Fund</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Website</label>
                    <input type="url" name="website" placeholder="https://example.com">
                </div>
                
                <div class="form-group">
                    <label>Financial Support Level *</label>
                    <div class="level-selection">
                        <div class="level-btn" onclick="selectLevel('ground', this)">Ground (&lt;$1K)</div>
                        <div class="level-btn" onclick="selectLevel('middle', this)">Middle ($1K-$5K)</div>
                        <div class="level-btn" onclick="selectLevel('upper', this)">Upper ($5K-$10K)</div>
                        <div class="level-btn" onclick="selectLevel('high', this)">High ($10K-$50K)</div>
                        <div class="level-btn" onclick="selectLevel('top', this)">Top ($50K+)</div>
                    </div>
                    <input type="hidden" name="supportLevel" id="supportLevel" required>
                </div>
                
                <div class="form-group">
                    <label>Focus Areas/Industries *</label>
                    <textarea name="focusAreas" rows="3" placeholder="What sectors do you want to support?" required></textarea>
                </div>

                <div class="form-group">
                    <label>Geographic Focus</label>
                    <input type="text" name="geographicFocus" placeholder="Countries or regions">
                </div>

                <div class="form-group">
                    <label>Investment Criteria</label>
                    <textarea name="investmentCriteria" rows="3" placeholder="Your evaluation criteria"></textarea>
                </div>

                <div class="form-group">
                    <label>Previous African Investments</label>
                    <textarea name="previousInvestments" rows="2" placeholder="Brief description"></textarea>
                </div>
                
                <div id="enhancedRequirements" style="display: none;">
                    <h3 style="color: #2a5298; margin: 25px 0 15px 0;">Enhanced Requirements</h3>
                    
                    <div class="form-group">
                        <label>Certificate of Good Conduct</label>
                        <select name="goodConduct">
                            <option value="">Select status</option>
                            <option value="Available">Available</option>
                            <option value="Will obtain">Will obtain</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Health Status</label>
                        <select name="healthStatus">
                            <option value="">Select status</option>
                            <option value="Excellent">Excellent</option>
                            <option value="Good">Good</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Financial Track Record</label>
                        <textarea name="financialTrack" rows="3" placeholder="Investment background"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Net Worth Range</label>
                        <select name="netWorth">
                            <option value="">Prefer not to disclose</option>
                            <option value="Under $100K">Under $100K</option>
                            <option value="$100K-$500K">$100K-$500K</option>
                            <option value="$500K-$1M">$500K-$1M</option>
                            <option value="Over $1M">Over $1M</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" name="terms" required style="width: auto; margin-right: 10px;">
                        I agree to the TAU Africa Terms of Service *
                    </label>
                </div>
                
                <button type="submit" class="btn btn-register">Proceed to M-PESA Payment (KSH 2,000)</button>
            </form>
        </div>
    `;
}

// ===== JOB CREATION MODAL =====
function createJobCreationModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üíº Job Creation Training</h2>
            <p>6-week entrepreneurship program</p>
            
            <div class="payment-info">
                <h3>Training Fee: KSH 1,500</h3>
            </div>
            
            <form onsubmit="processJobCreationTraining(event)">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" name="fullName" required>
                </div>
                
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label>Phone (M-PESA) *</label>
                    <input type="tel" name="phone" required placeholder="254XXXXXXXXX">
                </div>
                
                <div class="form-group">
                    <label>Location *</label>
                    <input type="text" name="location" required>
                </div>

                <div class="form-group">
                    <label>Age Range *</label>
                    <select name="ageRange" required>
                        <option value="">Select age</option>
                        <option value="18-25">18-25</option>
                        <option value="26-35">26-35</option>
                        <option value="36-45">36-45</option>
                        <option value="46+">46+</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Employment Status *</label>
                    <select name="employmentStatus" required>
                        <option value="">Select status</option>
                        <option value="Unemployed">Unemployed</option>
                        <option value="Student">Student</option>
                        <option value="Employed">Employed</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Business Idea *</label>
                    <textarea name="businessIdea" rows="3" required></textarea>
                </div>

                <div class="form-group">
                    <label>Target Market *</label>
                    <textarea name="targetMarket" rows="2" required></textarea>
                </div>

                <div class="form-group">
                    <label>Available Capital</label>
                    <select name="startupFunds">
                        <option value="">Select range</option>
                        <option value="No funds">No funds</option>
                        <option value="Under 10K">Under KSH 10K</option>
                        <option value="10K-50K">KSH 10K-50K</option>
                        <option value="Over 50K">Over KSH 50K</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Education *</label>
                    <select name="education" required>
                        <option value="">Select level</option>
                        <option value="Primary">Primary</option>
                        <option value="Secondary">Secondary</option>
                        <option value="College">College</option>
                        <option value="University">University</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" name="terms" required style="width: auto; margin-right: 10px;">
                        I agree to terms *
                    </label>
                </div>
                
                <button type="submit" class="btn btn-register">Proceed to Payment (KSH 1,500)</button>
            </form>
        </div>
    `;
}

// ===== SIMPLE MODALS FOR OTHER FEATURES =====
function createTrainingModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üìö Training Programs</h2>
            <form onsubmit="processTrainingRegistration(event)">
                <div class="form-group">
                    <label>Name *</label>
                    <input type="text" name="fullName" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Phone *</label>
                    <input type="tel" name="phone" required>
                </div>
                <div class="form-group">
                    <label>Training Interest *</label>
                    <select name="trainingCategory" required>
                        <option value="">Select area</option>
                        <option>Digital Skills</option>
                        <option>Business</option>
                        <option>Leadership</option>
                    </select>
                </div>
                <button type="submit" class="btn">Register</button>
            </form>
        </div>
    `;
}

function createWorkshopModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üéØ Host Workshop</h2>
            <form onsubmit="processWorkshopProposal(event)">
                <div class="form-group">
                    <label>Name *</label>
                    <input type="text" name="hostName" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Workshop Title *</label>
                    <input type="text" name="workshopTitle" required>
                </div>
                <div class="form-group">
                    <label>Description *</label>
                    <textarea name="description" rows="4" required></textarea>
                </div>
                <button type="submit" class="btn">Submit Proposal</button>
            </form>
        </div>
    `;
}

function createResearchModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üî¨ Research Services</h2>
            <form onsubmit="processResearchRequest(event)">
                <div class="form-group">
                    <label>Name *</label>
                    <input type="text" name="clientName" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Research Topic *</label>
                    <input type="text" name="topic" required>
                </div>
                <div class="form-group">
                    <label>Requirements *</label>
                    <textarea name="requirements" rows="4" required></textarea>
                </div>
                <button type="submit" class="btn">Submit Request</button>
            </form>
        </div>
    `;
}

function createCommunityModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>ü§ù Community Programs</h2>
            <form onsubmit="processCommunityRegistration(event)">
                <div class="form-group">
                    <label>Name *</label>
                    <input type="text" name="fullName" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Phone *</label>
                    <input type="tel" name="phone" required>
                </div>
                <div class="form-group">
                    <label>Location *</label>
                    <input type="text" name="location" required>
                </div>
                <div class="form-group">
                    <label>Program Interest *</label>
                    <select name="program" required>
                        <option value="">Select program</option>
                        <option>Agriculture</option>
                        <option>Climate</option>
                        <option>Education</option>
                        <option>Water & Sanitation</option>
                    </select>
                </div>
                <button type="submit" class="btn">Join Program</button>
            </form>
        </div>
    `;
}

function createCorporateModal() {
    return '<div class="modal-content"><span class="close" onclick="closeAllModals()">&times;</span><h2>üè¢ Corporate Services</h2><p>Contact us at grouptauafrica@gmail.com for corporate services.</p></div>';
}

function createParSiraiModal() {
    return '<div class="modal-content"><span class="close" onclick="closeAllModals()">&times;</span><h2>üèõÔ∏è Par Sirai Center</h2><p>Center for Knowledge and Spirituality. Contact: grouptauafrica@gmail.com</p></div>';
}

function createTrustGraphModal() {
    return '<div class="modal-content"><span class="close" onclick="closeAllModals()">&times;</span><h2>üîó Trust Graph</h2><p>Blockchain-based trust system. Coming soon!</p></div>';
}

function createFoundationModal() {
    return '<div class="modal-content"><span class="close" onclick="closeAllModals()">&times;</span><h2>üåç TAU Africa Foundation</h2><p>Foundation for Sustainable Development. Contact: grouptauafrica@gmail.com</p></div>';
}

function createHoldingsModal() {
    return '<div class="modal-content"><span class="close" onclick="closeAllModals()">&times;</span><h2>üè¢ Company Holdings</h2><p>Valenta Holdings Portfolio. Contact: grouptauafrica@gmail.com</p></div>';
}

function createForumModal() {
    return '<div class="modal-content"><span class="close" onclick="closeAllModals()">&times;</span><h2>üí¨ Member Forum</h2><p>Forum access requires active membership. Please login or register first.</p><button class="btn" onclick="showMemberLogin()">Member Login</button></div>';
}

console.log('‚úÖ Part 4 Loaded: Dashboard & Modals');
</script>
</head>
<body>
    
