<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="format-detection" content="telephone=no">
    <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4169e1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="TAU Africa">
<link rel="apple-touch-icon" href="icon-192.png">
    <title>TAU AFRICA INTERNATIONAL</title>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <style>
        /* Safari/iOS Compatibility Fixes */
* {
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
}

body {
    -webkit-overflow-scrolling: touch;
    overflow-scrolling: touch;
}

/* Fix buttons on iOS */
button, input[type="submit"], input[type="button"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    cursor: pointer;
}

/* Fix inputs on iOS */
input, select, textarea {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    border-radius: 10px;
}

/* Fix modal scrolling on iOS */
.modal {
    -webkit-overflow-scrolling: touch;
    overflow-scrolling: touch;
}

.modal-content {
    -webkit-overflow-scrolling: touch;
    overflow-scrolling: touch;
}

/* Fix for Safari date input */
input[type="date"] {
    -webkit-appearance: none;
    appearance: none;
    min-height: 44px;
}

/* Fix button clicks on iOS */
.btn, .level-btn, .house-btn, .corporate-btn {
    cursor: pointer;
    -webkit-user-select: none;
    user-select: none;
    touch-action: manipulation;
}
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298, #87ceeb);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #000080, #4169e1, #87ceeb);
            color: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .emancipation-scroll {
            position: absolute;
            bottom: 5px;
            left: 0;
            width: 100%;
            height: 20px;
            overflow: hidden;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 10px;
        }

        .emancipation-text {
            display: inline-block;
            white-space: nowrap;
            font-size: 12px;
            font-weight: bold;
            color: #ffd700;
            animation: scrollText 15s linear infinite;
            line-height: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        @keyframes scrollText {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .logo {
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, #87ceeb, #4169e1);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            border: 4px solid #ffd700;
        }

        .main-title {
            font-size: 2.8rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            letter-spacing: 2px;
        }

        .vision {
            font-size: 1.2rem;
            font-style: italic;
            opacity: 0.9;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .social-link {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .social-link:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .wings-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .wing {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .wing:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .auffi {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
        }

        .valenta {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .wing-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .wing-description {
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .houses-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .house-btn, .corporate-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: bold;
        }

        .house-btn:hover, .corporate-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .galaxy-banner {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            margin-top: 15px;
        }

        .main-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }

        .section:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2a5298;
            margin-bottom: 15px;
            text-align: center;
        }

        .btn {
            background: linear-gradient(45deg, #4169e1, #87ceeb);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-block;
            text-decoration: none;
        }

        .btn:hover {
            background: linear-gradient(45deg, #2a5298, #4169e1);
            transform: scale(1.05);
        }

        .btn-register {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            font-size: 1.1rem;
            padding: 15px 30px;
        }

        .btn-kabiru {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            font-weight: bold;
            width: 100%;
            padding: 15px;
            margin-top: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 95vh;
            overflow-y: auto;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 15px;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2a5298;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #4169e1;
            outline: none;
        }

        .payment-info {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .level-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .level-btn {
            padding: 10px;
            border: 2px solid #4169e1;
            background: rgba(65, 105, 225, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .level-btn.selected {
            background: #4169e1;
            color: white;
        }

        .kabiru-section {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            text-align: center;
            padding: 30px;
            border-radius: 20px;
            margin-top: 30px;
        }

        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .payment-widget {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .payment-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 16px;
            text-align: center;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4169e1;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1001;
            display: none;
            max-width: 350px;
        }

        .success { background: #2ecc71; }
        .error { background: #e74c3c; }

        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #4169e1, #87ceeb);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .ai-assistant {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 100;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        .ai-chat-window {
            position: fixed;
            bottom: 170px;
            right: 30px;
            width: 350px;
            height: 450px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
            flex-direction: column;
            z-index: 200;
        }

        .ai-chat-header {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 15px 20px;
            border-radius: 20px 20px 0 0;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 300px;
        }

        .ai-message {
            background: #f0f0f0;
            padding: 10px 15px;
            border-radius: 15px;
            margin: 10px 0;
            max-width: 80%;
        }

        .user-message {
            background: linear-gradient(45deg, #4169e1, #87ceeb);
            color: white;
            margin-left: auto;
        }

        .ai-chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid #eee;
        }

        .ai-chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }

        .ai-chat-input button {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            margin-left: 10px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .wings-container {
                grid-template-columns: 1fr;
            }
            
            .main-title {
                font-size: 2rem;
            }
            
            .houses-grid {
                grid-template-columns: 1fr;
            }
            
            .ai-chat-window {
                width: 90%;
                right: 5%;
                left: 5%;
            }
            
            .social-links {
                gap: 10px;
            }
            
            .social-link {
                font-size: 12px;
                padding: 6px 12px;
            }
        }
        
        .btn-small {
            padding: 10px 15px;
            font-size: 14px;
            min-width: 120px;
        }
    </style>
</head>
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
<script>eruda.init();</script>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">üåç TAU</div>
            <h1 class="main-title">TAU AFRICA INTERNATIONAL</h1>
            <p class="vision">Community ‚Ä¢ Value ‚Ä¢ Corporate ‚Ä¢ Sovereignty</p>
            
            <!-- Social Media Links -->
            <div class="social-links">
                <a href="https://x.com/grouptauafrica?t=pFlJ-gky_A7Dp3e0lbZ5Sg&s=09" target="_blank" class="social-link">
                    üê¶ Twitter/X
                </a>
                <a href="https://www.tiktok.com/@tau.africa.nairob?_t=ZM-8zwbvmFtmt2&_r=1" target="_blank" class="social-link">
                    üéµ TikTok
                </a>
                <a href="https://youtube.com/@tauafrica8922?si=wwgxc2AvYHYwsHTh" target="_blank" class="social-link">
                    üì∫ YouTube
                </a>
                <span class="social-link" style="opacity: 0.7;">
                    üìò Facebook (Coming Soon)
                </span>
            </div>
            
            <div class="emancipation-scroll">
                <div class="emancipation-text">EMANCIPATION PROCLAMATIONS ‚Ä¢ FREEDOM FOR ALL AFRICANS ‚Ä¢ UNITY IN DIVERSITY ‚Ä¢ ECONOMIC LIBERATION ‚Ä¢ SPIRITUAL AWAKENING ‚Ä¢ SOCIAL JUSTICE</div>
            </div>
        </div>

        <!-- Two Wings -->
        <div class="wings-container">
            <!-- AUFFI Wing -->
            <div class="wing auffi">
                <h2 class="wing-title">üåç AUFFI</h2>
                <p class="wing-description">Africa Unity Freedom Fund Initiative. The Pan African Digital value Currency for uniting and awakening Africa socially, economically and spiritually. A movement that return Oloo's Sovereignty back home to Africa, bringing together the children of Oloo and the Galaxy restoration to rebuild Africa</p>
                
                <div class="houses-grid">
                    <div class="house-btn" onclick="showNotification('Galaxy 0 house - join with G0 Card!', 'success')">Galaxy 0 [Secretariat Board G0]</div>
                    <div class="house-btn" onclick="showNotification('Galaxy 1 house - join with G1 Card!', 'success')">Galaxy 1 [Representative Board]</div>
                    <div class="house-btn" onclick="showNotification('Galaxy 2 house - join with G2 Card!', 'success')">Galaxy 2 [Coordination Board  ]</div>
                    <div class="house-btn" onclick="showNotification('Galaxy 3 house - join with G3 Card!', 'success')">Galaxy 3 [Implementation Board]</div>
                </div>
                
                <div class="galaxy-banner">
                    Auffi - Pan African Trust Graph & R4<br> [REPARTRIATION - RESURRECTION-RESTORATION - RECONNECTION] (sovereignty). Our digital Ecosystem uses human & environmental values to create the Africa's Sovereign Wealth, and subsequently bring back Sovereignty to black people and humanity. join the Kabiru Mining App to mine your values in building The African digital currency (Kabiru)
                </div>
                
                <button class="btn" onclick="openModal('parSirai')">Par Sirai Center</button>
            </div>

            <!-- Valenta Wing -->
            <div class="wing valenta">
                <h2 class="wing-title">üè¢ VALENTA</h2>
                <p class="wing-description">Value Enter Africa - Our Corporate Holding company, building Kabiru Digital currency for Africa value harnessing, erecting a sustainable Kabiru digital ecosystem, & Empowering African communities through Education - Economic and Social Literacy. Come let us build our sovereignty together, and make Africa great again</p>

                <div class="houses-grid">
                    <div class="corporate-btn" onclick="openModal('corporate')">Corporate company</div>
                    <div class="corporate-btn" onclick="openModal('trustGraph')">Generation Trust Graph</div>
                    <div class="corporate-btn" onclick="openModal('foundation')">Family Foundation</div>
                    <div class="corporate-btn" onclick="openModal('holdings')">Holding Company</div>
                </div>
            </div>
        </div>

        <!-- Main Sections -->
        <div class="main-sections">
            <!-- Membership Registration -->
            <div class="section">
                <h3 class="section-title">üë• MEMBERSHIP</h3>
                <p>Join our community through TASK & TALK teams</p>
                <button class="btn btn-register" onclick="openModal('taskRegistration')">Join TASK Team</button>
                <button class="btn btn-register" onclick="openModal('talkRegistration')">Join TALK Team</button>
                <p style="margin-top: 15px; font-weight: bold; color: #e74c3c;">TASK Fee: KSH 500 | TALK Fee: KSH 2,000</p>
            </div>
            <div class="section">
    <h3 class="section-title">‚ö° KABIRU MINING</h3>
    <p>Mine Kabiru coins and manage your wallet</p>
    <button class="btn-kabiru" onclick="window.open('https://magero1985.github.io/Kabiru-Mining-Portal-/', '_blank')">
        Access Kabiru Mining App
    </button>
            </div>
            <!-- Add this button to your main sections area -->
<div class="section">
    <h3 class="section-title">üíé SUBMIT VALUE</h3>
    <p>Submit products, services, skills, labour, or time</p>
    <button class="btn" onclick="openValueSubmissionModal()">Submit Your Value</button>
    <p style="margin-top: 15px; font-size: 0.9rem; color: #666;">
        Earn iKb when your value is validated!
    </p>
</div>
            
            <!-- PUBLIC OPPORTUNITIES SECTION - Add to Main App -->
<div class="main-sections" style="margin-top: 40px;">
    <div class="section" style="grid-column: 1 / -1;">
        <h3 class="section-title">üéØ AVAILABLE OPPORTUNITIES</h3>
        <p style="text-align: center; margin-bottom: 20px;">Complete these to earn iKbp and iKb!</p>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; max-width: 400px; margin-left: auto; margin-right: auto;">
    <button class="btn btn-small" onclick="filterOpportunities('all')" id="filter-all">All</button>
    <button class="btn btn-small" onclick="filterOpportunities('activities')" id="filter-activities">Activities</button>
    <button class="btn btn-small" onclick="filterOpportunities('tasks')" id="filter-tasks">Tasks</button>
    <button class="btn btn-small" onclick="filterOpportunities('values')" id="filter-values">Values</button>
</div>
        
        <div id="publicOpportunitiesContainer"></div>
    </div>
</div>
            <!-- Activity Area -->
            <div class="section">
                <h3 class="section-title">üìö ACTIVITIES</h3>
                <p>Training workshops, job creation & research services</p>
                <button class="btn" onclick="openModal('training')">Join member training</button>
                <button class="btn" onclick="openModal('workshop')">Host corporate Workshop</button>
                <button class="btn" onclick="openModal('research')">Research Services</button>
                <button class="btn" onclick="openModal('jobCreation')">Job Creation workshop</button>
            </div>

            <!-- Jobs Area -->
            <div class="section">
                <h3 class="section-title">üíº TASKS</h3>
                <p>Connect job seekers with verified opportunities</p>
                <button class="btn" onclick="openModal('insertJob')">Insert value</button>
                <button class="btn" onclick="openModal('retrieveJob')">Search value</button>
                <button class="btn" onclick="openModal('availableJobs')">Browse value</button>
                <button class="btn" onclick="openModal('applyJob')">seek value</button>
            </div>

            <!-- Community -->
            <div class="section">
                <h3 class="section-title">ü§ù COMMUNITY</h3>
                <p>Community support programs</p>
                <button class="btn" onclick="openModal('community')">Join Programs</button>
                <div style="margin-top: 10px; font-size: 0.9rem;">
                    Agriculture ‚Ä¢ Climate ‚Ä¢ Environment<br>
                    Water & Sanitation ‚Ä¢ Education ‚Ä¢ Child Care
                </div>
            </div>

            <!-- Interactive Forum -->
            <div class="section">
                <h3 class="section-title">üí¨ MEMBER FORUM</h3>
                <p>Connect, share ideas, and collaborate with fellow members</p>
                <button class="btn" onclick="openModal('forum')">Access Forum</button>
                <div style="margin-top: 10px; font-size: 0.9rem;">
                    Discussions ‚Ä¢ Job Sharing ‚Ä¢ Training Materials<br>
                    Voice Calls ‚Ä¢ Messaging ‚Ä¢ Networking
                </div>
            </div>
        </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>
<!-- Notification Bell Icon - Add to your header -->
<div id="tauNotificationBell" style="position: fixed; top: 20px; right: 80px; z-index: 1000;">
    <button onclick="openTauNotifications()" style="background: #667eea; color: white; border: none; padding: 12px; border-radius: 50%; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2); position: relative;">
        üîî
        <span id="tauNotifBadge" style="display: none; position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 10px; line-height: 20px; text-align: center;">0</span>
    </button>
</div>

<!-- Notification Panel -->
<div id="tauNotificationPanel" style="display: none; position: fixed; top: 70px; right: 20px; width: 350px; max-height: 500px; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000; overflow-y: auto;">
    <div style="padding: 20px; border-bottom: 2px solid #eee;">
        <h3 style="margin: 0;">üîî Notifications</h3>
    </div>
    <div id="tauNotificationList" style="padding: 10px;"></div>
</div>

    <!-- Floating Member Access Button -->
    <div class="floating-btn" onclick="showMemberLogin()" title="Member Access">üë§</div>

    <!-- AI Assistant -->
    <div class="ai-assistant" onclick="toggleAIChat()" title="AI Assistant - Get Help">ü§ñ</div>

    <!-- AI Chat Window -->
    <div class="ai-chat-window" id="aiChatWindow">
        <div class="ai-chat-header">
            <span>TAU AI Assistant</span>
            <span onclick="toggleAIChat()" style="cursor: pointer;">‚úñ</span>
        </div>
        <div class="ai-chat-messages" id="aiChatMessages">
            <div class="ai-message">
                Hello! I'm your TAU Africa AI assistant. I can help you with:
                <br>‚Ä¢ Navigating the app
                <br>‚Ä¢ Understanding registration process
                <br>‚Ä¢ Payment procedures
                <br>‚Ä¢ Technical support
                <br>‚Ä¢ General questions about TAU Africa
                <br><br>How can I assist you today?
            </div>
        </div>
        <div class="ai-chat-input">
            <input type="text" id="aiChatInput" placeholder="Ask me anything..." onkeypress="handleAIChatKeyPress(event)">
            <button onclick="sendAIMessage()">‚û§</button>
        </div>
        <button onclick="‚úÖ Validate()">‚û§</button>
    </div>
</div>

    <script>
// ============================================
// PUBLIC OPPORTUNITIES DISPLAY - Main App
// ============================================
(function() {
    'use strict';
    
    let currentFilter = 'all';
    
    window.filterOpportunities = function(filter) {
        currentFilter = filter;
        
        // Update button styles
        document.querySelectorAll('[id^="filter-"]').forEach(btn => {
            btn.style.background = 'linear-gradient(45deg, #95a5a6, #7f8c8d)';
        });
        document.getElementById('filter-' + filter).style.background = 'linear-gradient(45deg, #4169e1, #87ceeb)';
        
        refreshPublicOpportunities();
    };
    
    window.refreshPublicOpportunities = function() {
        refreshPublicTasks();
        refreshPublicActivities();
        refreshPublicValues();
    };
    
    window.refreshPublicTasks = function() {
        displayOpportunities();
    };
    
    window.refreshPublicActivities = function() {
        displayOpportunities();
    };
    
    window.refreshPublicValues = function() {
        displayOpportunities();
    };
    
    function displayOpportunities() {
        const container = document.getElementById('publicOpportunitiesContainer');
        if (!container) return;
        
        const tasks = JSON.parse(localStorage.getItem('tauTasks') || '[]').filter(t => t.validated);
        const activities = JSON.parse(localStorage.getItem('tauActivities') || '[]').filter(a => a.validated);
        const values = JSON.parse(localStorage.getItem('tauValues') || '[]').filter(v => v.validated && v.status === 'Approved');
        
        let items = [];
        
        if (currentFilter === 'all' || currentFilter === 'activities') {
            items = items.concat(activities.map(a => ({...a, type: 'activity'})));
        }
        if (currentFilter === 'all' || currentFilter === 'tasks') {
            items = items.concat(tasks.map(t => ({...t, type: 'task'})));
        }
        if (currentFilter === 'all' || currentFilter === 'values') {
            items = items.concat(values.map(v => ({...v, type: 'value'})));
        }
        
        if (items.length === 0) {
            container.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">No opportunities available yet</p>';
            return;
        }
        
        container.innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                ${items.map(item => `
                    <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-left: 4px solid ${getColorForType(item.type)};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0; color: #2a5298;">${item.title}</h4>
                            <span style="background: ${getColorForType(item.type)}; color: white; padding: 5px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                ${item.type.toUpperCase()}
                            </span>
                        </div>
                        
                        <p style="color: #666; margin-bottom: 15px;">${item.description}</p>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <span style="background: #ffd700; color: #333; padding: 8px 15px; border-radius: 20px; font-weight: bold;">
                                ${item.type === 'value' ? item.worthIkb + ' iKb' : item.reward + ' iKbp'}
                            </span>
                            ${item.category ? `<span style="font-size: 12px; color: #999;">${item.category}</span>` : ''}
                        </div>
                        
                        <button class="btn" onclick="claimOpportunity('${item.type}', '${item.id}')" style="width: 100%; padding: 12px;">
                            ${item.type === 'value' ? 'üíé Claim Value' : '‚úÖ Complete & Earn'}
                        </button>
                    </div>
                `).join('')}
            </div>
        `;
    }
    
    function getColorForType(type) {
        switch(type) {
            case 'activity': return '#ff6b6b';
            case 'task': return '#4169e1';
            case 'value': return '#ffd700';
            default: return '#95a5a6';
        }
    }
    
    window.claimOpportunity = function(type, id) {
        const currentMember = window.TauDB?.getCurrentMember();
        
        if (!currentMember) {
            showNotification('Please login to claim opportunities', 'error');
            showMemberLogin();
            return;
        }
        if (typeof showRealMemberLogin === 'function') {
    showRealMemberLogin();
} else if (typeof showMemberLogin === 'function') {
    showMemberLogin();
        }
        const storageKey = type === 'activity' ? 'tauActivities' : type === 'task' ? 'tauTasks' : 'tauValues';
        const items = JSON.parse(localStorage.getItem(storageKey) || '[]');
        const item = items.find(i => i.id === id);
        
        if (!item) {
            showNotification('Item not found', 'error');
            return;
        }
        
        if (type === 'value') {
            openValueClaimModal(item);
        } else {
            openCompletionModal(type, item);
        }
    };
    
    function openCompletionModal(type, item) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'block';
        modal.innerHTML = `
            <div class="modal-content">
                <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                <h2>${type === 'activity' ? 'üìö' : 'üìã'} Complete ${type.charAt(0).toUpperCase() + type.slice(1)}</h2>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h3>${item.title}</h3>
                    <p>${item.description}</p>
                    <p style="font-weight: bold; color: #ffd700;">Reward: ${item.reward} iKbp</p>
                </div>
                
                <form onsubmit="submitCompletion(event, '${type}', '${item.id}')">
                    <div class="form-group">
                        <label>Proof of Completion *</label>
                        <textarea name="proof" rows="4" placeholder="Describe what you did, attach links, etc." required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Validation Code (if you have one)</label>
                        <input type="text" name="validationCode" placeholder="Optional">
                    </div>
                    
                    <button type="submit" class="btn">Submit for Review</button>
                </form>
            </div>
        `;
        document.body.appendChild(modal);
    }
    
    function openValueClaimModal(item) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'block';
        modal.innerHTML = `
            <div class="modal-content">
                <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                <h2>üíé Claim Value</h2>
                
                <div style="background: linear-gradient(45deg, #ffd700, #ffed4e); padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h3 style="color: #333;">${item.title}</h3>
                    <p style="color: #666;">${item.description}</p>
                    <p style="font-weight: bold; color: #333;">Worth: ${item.worthIkb} iKb (${item.worthKsh} KSH)</p>
                </div>
                
                <form onsubmit="submitValueClaim(event, '${item.id}')">
                    <div class="form-group">
                        <label>How will you provide this value? *</label>
                        <textarea name="proposal" rows="4" required></textarea>
                    </div>
                    
                    <button type="submit" class="btn">Submit Claim</button>
                </form>
            </div>
        `;
        document.body.appendChild(modal);
    }
    
    window.submitCompletion = function(event, type, itemId) {
        event.preventDefault();
        const currentMember = window.TauDB?.getCurrentMember();
        if (!currentMember) return;
        
        const formData = new FormData(event.target);
        const proof = formData.get('proof');
        
        // Add to member's record
        if (type === 'activity') {
            window.TauDB.addActivity(currentMember.id, {
                type: 'Completed Activity',
                title: 'Activity Completion',
                description: proof,
                reward: 0 // Pending approval
            });
        } else {
            window.TauDB.addTask(currentMember.id, {
                title: 'Task Completion',
                description: proof,
                category: 'User Submitted',
                reward: 0 // Pending approval
            });
        }
        
        // Create notification for admins
        createAdminNotification('completion', {
            memberId: currentMember.id,
            memberName: currentMember.fullName,
            itemType: type,
            itemId: itemId,
            proof: proof
        });
        
        closeAllModals();
        showNotification('‚úÖ Submitted for review! You will be notified when approved.', 'success');
    };
    
    window.submitValueClaim = function(event, valueId) {
        event.preventDefault();
        const currentMember = window.TauDB?.getCurrentMember();
        if (!currentMember) return;
        
        const formData = new FormData(event.target);
        const proposal = formData.get('proposal');
        
        // Create admin notification
        createAdminNotification('value_claim', {
            memberId: currentMember.id,
            memberName: currentMember.fullName,
            valueId: valueId,
            proposal: proposal
        });
        
        closeAllModals();
        showNotification('‚úÖ Value claim submitted! Admins will review.', 'success');
    };
    
    function createAdminNotification(type, data) {
        const adminNotifs = JSON.parse(localStorage.getItem('tauAdminNotifications') || '[]');
        adminNotifs.unshift({
            id: 'ADMIN-' + Date.now(),
            type: type,
            data: data,
            timestamp: new Date().toISOString(),
            read: false
        });
        localStorage.setItem('tauAdminNotifications', JSON.stringify(adminNotifs));
    }
    
    // Auto-refresh every 10 seconds
    setInterval(refreshPublicOpportunities, 10000);
    
    // Initial load
    setTimeout(refreshPublicOpportunities, 1000);
})();
        </script>
<script>
// ============================================
// VALUE SUBMISSION SYSTEM - Main App
// ============================================
(function() {
    'use strict';
    
    window.openValueSubmissionModal = function() {
        const currentMember = window.TauDB?.getCurrentMember();
        
        if (!currentMember) {
            showNotification('Please login to submit values', 'error');
            showRealMemberLogin();
            return;
        }
        
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'block';
        modal.innerHTML = `
            <div class="modal-content" style="max-width: 700px;">
                <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                
                <div style="background: linear-gradient(45deg, #ffd700, #ffed4e); color: #333; padding: 25px; border-radius: 15px; margin-bottom: 25px; text-align: center;">
                    <h2 style="margin: 0;">üíé Submit Your Value</h2>
                    <p style="margin: 10px 0 0 0;">Turn your skills, products, and services into iKb</p>
                </div>
                
                <form onsubmit="submitValue(event)" id="valueSubmissionForm">
                    <div class="form-group">
                        <label>Value Type *</label>
                        <select name="valueType" required onchange="updateValueTypeInfo(this.value)">
                            <option value="">Select type</option>
                            <option value="Product">üì¶ Product</option>
                            <option value="Service">üõ†Ô∏è Service</option>
                            <option value="Skill">üéØ Skill</option>
                            <option value="Labour">üí™ Labour</option>
                            <option value="Time">‚è∞ Time</option>
                        </select>
                    </div>
                    
                    <div id="valueTypeInfo" style="display: none; background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <p id="valueTypeDescription" style="margin: 0; font-size: 14px; color: #1976d2;"></p>
                    </div>
                    
                    <div class="form-group">
                        <label>Value Title *</label>
                        <input type="text" name="valueTitle" placeholder="e.g., Professional Web Design Services" required maxlength="100">
                        <small>Clear, descriptive title (max 100 characters)</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Detailed Description *</label>
                        <textarea name="valueDescription" rows="6" placeholder="Describe what you're offering, what makes it valuable, delivery time, terms, etc." required maxlength="2000"></textarea>
                        <small><span id="charCount">0</span>/2000 characters</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Estimated Worth (KSH) *</label>
                        <input type="number" name="worthKsh" placeholder="Enter value in KSH" required min="0" step="0.01" onchange="calculateIkb(this.value)">
                        <small>This will be converted to iKb (1 iKb = 100,000 KSH)</small>
                        <div id="ikbEquivalent" style="display: none; margin-top: 10px; padding: 10px; background: #fff3e0; border-radius: 8px; text-align: center;">
                            <strong style="color: #e65100;">Equivalent: <span id="ikbValue">0</span> iKb</strong>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Category</label>
                        <select name="valueCategory">
                            <option value="">Select category (optional)</option>
                            <option value="Technology">Technology & IT</option>
                            <option value="Creative">Creative & Design</option>
                            <option value="Business">Business & Finance</option>
                            <option value="Education">Education & Training</option>
                            <option value="Health">Health & Wellness</option>
                            <option value="Agriculture">Agriculture & Food</option>
                            <option value="Construction">Construction & Trade</option>
                            <option value="Transport">Transport & Logistics</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Delivery/Availability *</label>
                        <select name="availability" required>
                            <option value="">When can you deliver?</option>
                            <option value="Immediate">Immediate (within 24 hours)</option>
                            <option value="1-3 days">1-3 days</option>
                            <option value="1 week">Within 1 week</option>
                            <option value="2 weeks">Within 2 weeks</option>
                            <option value="1 month">Within 1 month</option>
                            <option value="On demand">On demand/Flexible</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Location/Region *</label>
                        <input type="text" name="valueLocation" placeholder="Where can you provide this value?" required>
                        <small>e.g., "Nairobi, Kenya" or "Remote/Online"</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Contact Preference *</label>
                        <select name="contactMethod" required>
                            <option value="">How should buyers contact you?</option>
                            <option value="Email">Email</option>
                            <option value="Phone">Phone/WhatsApp</option>
                            <option value="TAU Platform">Through TAU Platform</option>
                            <option value="Any">Any method</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" name="termsAgree" required style="width: auto; margin-right: 10px;">
                            I certify that this value is genuine and I can deliver as described *
                        </label>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin: 20px 0;">
                        <strong>üìã Submission Process:</strong>
                        <ol style="margin: 10px 0 0 20px; padding: 0;">
                            <li>Submit your value</li>
                            <li>Receive validation code</li>
                            <li>Admin reviews (24-48 hours)</li>
                            <li>Once approved, earn iKb when value is claimed</li>
                        </ol>
                    </div>
                    
                    <button type="submit" class="btn" style="width: 100%; padding: 15px; font-size: 16px;">
                        üíé Submit Value for Validation
                    </button>
                </form>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Add character counter
        const textarea = modal.querySelector('textarea[name="valueDescription"]');
        textarea.addEventListener('input', function() {
            document.getElementById('charCount').textContent = this.value.length;
        });
    };
    
    window.updateValueTypeInfo = function(type) {
        const info = document.getElementById('valueTypeInfo');
        const desc = document.getElementById('valueTypeDescription');
        
        const descriptions = {
            'Product': 'üì¶ Physical or digital products you create or sell',
            'Service': 'üõ†Ô∏è Professional services you provide (consulting, repair, etc.)',
            'Skill': 'üéØ Expertise or abilities you can teach or apply',
            'Labour': 'üí™ Physical work or manual tasks you can perform',
            'Time': '‚è∞ Your time and availability for projects or tasks'
        };
        
        if (type && descriptions[type]) {
            desc.textContent = descriptions[type];
            info.style.display = 'block';
        } else {
            info.style.display = 'none';
        }
    };
    
    window.calculateIkb = function(kshValue) {
        if (!kshValue || kshValue <= 0) {
            document.getElementById('ikbEquivalent').style.display = 'none';
            return;
        }
        
        const ikb = (parseFloat(kshValue) / 100000).toFixed(6);
        document.getElementById('ikbValue').textContent = ikb;
        document.getElementById('ikbEquivalent').style.display = 'block';
    };
    
    window.submitValue = function(event) {
        event.preventDefault();
        const currentMember = window.TauDB?.getCurrentMember();
        if (!currentMember) return;
        
        const formData = new FormData(event.target);
        const worthKsh = parseFloat(formData.get('worthKsh'));
        const worthIkb = (worthKsh / 100000).toFixed(6);
        
        const value = {
            id: 'VAL-' + Date.now(),
            type: formData.get('valueType'),
            title: formData.get('valueTitle'),
            description: formData.get('valueDescription'),
            worthKsh: worthKsh,
            worthIkb: worthIkb,
            category: formData.get('valueCategory') || 'Uncategorized',
            availability: formData.get('availability'),
            location: formData.get('valueLocation'),
            contactMethod: formData.get('contactMethod'),
            submittedBy: currentMember.id,
            submittedByName: currentMember.fullName,
            submittedByEmail: currentMember.email,
            submittedByPhone: currentMember.phone,
            validationCode: generateValueCode(),
            status: 'Pending Review',
            created: new Date().toISOString(),
            validated: false
        };
        
        // Save to values database
        const values = JSON.parse(localStorage.getItem('tauValues') || '[]');
        values.push(value);
        localStorage.setItem('tauValues', JSON.stringify(values));
        
        // Add to validation queue
        const validations = JSON.parse(localStorage.getItem('tauPendingValidations') || '[]');
        validations.push({
            id: 'VALID-' + Date.now(),
            type: 'value',
            data: value,
            status: 'Pending',
            created: new Date().toISOString()
        });
        localStorage.setItem('tauPendingValidations', JSON.stringify(validations));
        
        // Notify member
        createNotification(currentMember.id, 'üíé Value Submitted!', 
            `Your value "${value.title}" has been submitted for review. Validation code: ${value.validationCode}`, 
            'success');
        
        // Notify admins
        const adminNotifs = JSON.parse(localStorage.getItem('tauAdminNotifications') || '[]');
        adminNotifs.unshift({
            id: 'ADMIN-' + Date.now(),
            type: 'new_value_submission',
            data: {
                valueName: value.title,
                submittedBy: currentMember.fullName,
                memberId: currentMember.id,
                worth: worthIkb + ' iKb',
                validationCode: value.validationCode
            },
            timestamp: new Date().toISOString(),
            read: false
        });
        localStorage.setItem('tauAdminNotifications', JSON.stringify(adminNotifs));
        
        // Show success modal
        closeAllModals();
        showValueSubmissionSuccess(value);
    };
    
    function generateValueCode() {
        const timestamp = Date.now().toString(36).toUpperCase();
        const random = Math.random().toString(36).substring(2, 6).toUpperCase();
        return 'VAL-' + timestamp + '-' + random;
    }
    
    window.showValueSubmissionSuccess = function(value) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'block';
        modal.innerHTML = `
            <div class="modal-content">
                <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                
                <div style="text-align: center;">
                    <div style="font-size: 80px; margin-bottom: 20px;">‚úÖ</div>
                    <h2 style="color: #2ecc71;">Value Submitted Successfully!</h2>
                </div>
                
                <div style="background: linear-gradient(45deg, #ffd700, #ffed4e); padding: 25px; border-radius: 15px; margin: 25px 0; text-align: center;">
                    <h3 style="color: #333; margin: 0 0 15px 0;">Your Validation Code</h3>
                    <div style="background: white; padding: 15px; border-radius: 10px; font-size: 24px; font-weight: bold; letter-spacing: 3px; color: #333;">
                        ${value.validationCode}
                    </div>
                    <button onclick="copyToClipboard('${value.validationCode}')" class="btn" style="margin-top: 15px; background: white; color: #333;">
                        üìã Copy Code
                    </button>
                </div>
                
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4 style="margin: 0 0 10px 0; color: #1976d2;">What Happens Next?</h4>
                    <ol style="margin: 0; padding-left: 20px; color: #666;">
                        <li>Admins will review your value (24-48 hours)</li>
                        <li>You'll receive a notification when approved</li>
                        <li>Your value will be visible to all TAU Africa members</li>
                        <li>When someone claims your value, you earn ${value.worthIkb} iKb!</li>
                    </ol>
                </div>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin: 20px 0;">
                    <strong>üí° Tip:</strong> Save your validation code! You can use it to check your value's status.
                </div>
                
                <button onclick="this.parentElement.parentElement.remove()" class="btn" style="width: 100%;">
                    Got it!
                </button>
            </div>
        `;
        document.body.appendChild(modal);
    };
    
    window.copyToClipboard = function(text) {
        if (navigator.clipboard) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('‚úÖ Code copied to clipboard!', 'success');
            }).catch(() => {
                fallbackCopy(text);
            });
        } else {
            fallbackCopy(text);
        }
    };
    
    function fallbackCopy(text) {
        const temp = document.createElement('textarea');
        temp.value = text;
        temp.style.position = 'fixed';
        temp.style.opacity = '0';
        document.body.appendChild(temp);
        temp.select();
        document.execCommand('copy');
        document.body.removeChild(temp);
        showNotification('‚úÖ Code copied!', 'success');
    }
})();
</script>
<script>
// ============================================
// TAU AFRICA - UNIFIED EMAIL SYSTEM (FIXED)
// ============================================
(function() {
    'use strict';
    
    console.log('üìß Loading Email System...');
    
    // ============================================
    // 1. SINGLE EMAIL CONFIGURATION
    // ============================================
    const EMAIL_CONFIG = {
        serviceId: 'service_xfira7g',
        templateId: 'template_bqxztig',  // Use this ONE template for all emails
        publicKey: 'GhjI14eQVGgOli0j1',
        adminEmail: 'grouptauafrica@gmail.com'
    };
    
    // ============================================
    // 2. INITIALIZE EMAILJS (ONCE)
    // ============================================
    let emailInitialized = false;
    
    function initEmailJS() {
        if (emailInitialized) return true;
        
        if (typeof emailjs === 'undefined') {
            console.error('‚ùå EmailJS library not loaded');
            return false;
        }
        
        try {
            emailjs.init({ publicKey: EMAIL_CONFIG.publicKey });
            emailInitialized = true;
            console.log('‚úÖ EmailJS initialized');
            return true;
        } catch (error) {
            console.error('‚ùå EmailJS init failed:', error);
            return false;
        }
    }
    
    // Initialize immediately
    setTimeout(initEmailJS, 500);
    
    // ============================================
    // 3. CORE EMAIL FUNCTION (Used by all)
    // ============================================
    async function sendEmail(toEmail, toName, subject, message, additionalParams = {}) {
        if (!initEmailJS()) {
            console.error('‚ùå Cannot send email - EmailJS not ready');
            return { success: false, error: 'EmailJS not initialized' };
        }
        
        const templateParams = {
            to_email: toEmail,
            to_name: toName,
            from_name: 'TAU Africa',
            from_email: EMAIL_CONFIG.adminEmail,
            subject: subject,
            message: message,
            ...additionalParams  // Allows passing phone, location, etc.
        };
        
        console.log('üìß Sending email...', { to: toEmail, subject });
        
        try {
            const response = await emailjs.send(
                EMAIL_CONFIG.serviceId,
                EMAIL_CONFIG.templateId,
                templateParams
            );
            
            console.log('‚úÖ Email sent:', response.status);
            return { success: true, status: response.status };
            
        } catch (error) {
            console.error('‚ùå Email failed:', error);
            return { success: false, error: error.text || error.message };
        }
    }
    
    // ============================================
    // 4. SEND WELCOME EMAIL TO MEMBER
    // ============================================
    window.sendWelcomeEmail = async function(member) {
        const message = `
Dear ${member.fullName},

üéâ WELCOME TO TAU AFRICA INTERNATIONAL! üéâ

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
YOUR MEMBERSHIP DETAILS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üë§ Member ID: ${member.id}
üìß Email: ${member.email}
üì± Phone: ${member.phone}
üìç Location: ${member.location}
üë• Team: ${member.team}
üí∞ Registration Fee: KSH ${member.fee} ‚úÖ PAID

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
YOUR BENEFITS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üéÅ Welcome Bonus: 500 iKbp (KSH 50) - CREDITED!
üîë Referral Code: ${member.referralCode}
   Share to earn 500 iKbp per referral!

üíé Start earning:
   ‚Ä¢ Complete activities: 100-500 iKbp each
   ‚Ä¢ Complete tasks: 200-5000 iKbp each
   ‚Ä¢ Submit values: Earn iKb
   ‚Ä¢ Refer friends: 500 iKbp each

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
NEXT STEPS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

1. Login with your Member ID or Email
2. Complete your first activity (earn 100 iKbp!)
3. Share your referral code
4. Explore the Kabiru Mining App

üåê Access your dashboard:
   ${window.https://magero1985.github.io/Tau-Africa/.origin}

üìß Need help? Contact:
   grouptauafrica@gmail.com

Welcome to the TAU Africa family!

Best regards,
TAU Africa Team
üåç Building Africa's Digital Future
        `.trim();
        
        return await sendEmail(
            member.email,
            member.fullName,
            'üéâ Welcome to TAU Africa International!',
            message,
            {
                phone: member.phone,
                location: member.location,
                member_id: member.id,
                referral_code: member.referralCode
            }
        );
    };
    
    // ============================================
    // 5. SEND NOTIFICATION TO ADMIN
    // ============================================
    window.sendEmailToAdmin = async function(formData, subject) {
        const memberName = formData.fullName || formData.name || 'New Member';
        const team = formData.team || 'TASK';
        const fee = formData.fee || (team === 'TASK' ? 500 : team === 'TALK' ? 2000 : 1500);
        
        const message = `
NEW REGISTRATION RECEIVED
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üë§ Name: ${memberName}
üìß Email: ${formData.email}
üì± Phone: ${formData.phone}
üìç Location: ${formData.location}
üë• Team: ${team}
üí∞ Fee: KSH ${fee} ‚úÖ PAID
üìÖ Date: ${new Date().toLocaleString()}

${formData.id ? 'üÜî Member ID: ' + formData.id : ''}
${formData.referralCode ? 'üîë Referral Code: ' + formData.referralCode : ''}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Additional Information:
${JSON.stringify(formData, null, 2)}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
TAU Africa Registration System
        `.trim();
        
        return await sendEmail(
            EMAIL_CONFIG.adminEmail,
            'TAU Africa Admin',
            subject,
            message,
            {
                phone: formData.phone,
                location: formData.location,
                team: team
            }
        );
    };
    
    // ============================================
    // 6. SEND REFERRAL NOTIFICATION
    // ============================================
    window.sendReferralNotification = async function(referrer, earnings) {
        const message = `
Congratulations ${referrer.fullName}!

üéâ REFERRAL BONUS EARNED! üéâ

You've earned ${earnings} iKbp (KSH ${earnings/10}) from your referral.

üí∞ Current Balance: ${referrer.iKbpBalance || 0} iKbp
üîë Your Referral Code: ${referrer.referralCode}

Keep sharing to earn more!

Best regards,
TAU Africa Team
        `.trim();
        
        return await sendEmail(
            referrer.email,
            referrer.fullName,
            'üéÅ Referral Bonus Earned!',
            message
        );
    };
    
    // ============================================
    // 7. OVERRIDE SUCCESS HANDLERS WITH PROPER EMAIL
    // ============================================
    
    // TASK Registration Success
    window.processTaskSuccess = async function(formData) {
        console.log('üéØ Processing TASK registration...');
        
        try {
            // 1. Save to database
            const referralCode = window.TauDB?.checkReferralCode();
            const syncResult = window.TauDB?.sync(formData, 'TASK', referralCode);
            
            if (!syncResult || !syncResult.success) {
                throw new Error('Database sync failed');
            }
            
            const member = syncResult.member;
            console.log('‚úÖ Member saved:', member.id);
            
            // 2. Award welcome bonus
            if (window.TauDB?.updateBalance) {
                window.TauDB.updateBalance(member.id, 500);
                console.log('üéÅ Welcome bonus: 500 iKbp');
            }
            
            // 3. Create notification
            if (typeof createNotification === 'function') {
                createNotification(
                    member.id,
                    'üéâ Welcome to TAU Africa!',
                    `Member ID: ${member.id}\nWelcome Bonus: 500 iKbp`,
                    'success'
                );
            }
            
            // 4. Send emails (parallel)
            showNotification('üìß Sending confirmation emails...', 'info');
            
            const [welcomeResult, adminResult] = await Promise.allSettled([
                sendWelcomeEmail(member),
                sendEmailToAdmin(member, 'NEW TASK REGISTRATION - PAYMENT CONFIRMED')
            ]);
            
            // 5. Check email results
            const welcomeSent = welcomeResult.status === 'fulfilled' && welcomeResult.value.success;
            const adminSent = adminResult.status === 'fulfilled' && adminResult.value.success;
            
            console.log('üìß Email results:', { welcomeSent, adminSent });
            
            // 6. Show appropriate notification
            let message = '‚úÖ Registration complete!';
            if (welcomeSent && adminSent) {
                message += ' Confirmation emails sent to you and admin.';
            } else if (welcomeSent) {
                message += ' Welcome email sent to you.';
            } else if (adminSent) {
                message += ' Admin notified.';
            } else {
                message += ' Emails may be delayed - check inbox in a few minutes.';
            }
            
            showNotification(message, 'success');
            
            // 7. Close modal and show success screen
            setTimeout(() => {
                closeAllModals();
                if (typeof showSuccessModal === 'function') {
                    showSuccessModal(member);
                }
            }, 2000);
            
        } catch (error) {
            console.error('‚ùå Registration error:', error);
            showNotification('‚ùå Registration failed: ' + error.message, 'error');
        }
    };
    
    // TALK Registration Success
    window.processTalkSuccess = async function(formData) {
        console.log('üéØ Processing TALK registration...');
        
        try {
            const referralCode = window.TauDB?.checkReferralCode();
            const syncResult = window.TauDB?.sync(formData, 'TALK', referralCode);
            
            if (!syncResult || !syncResult.success) {
                throw new Error('Database sync failed');
            }
            
            const member = syncResult.member;
            
            if (window.TauDB?.updateBalance) {
                window.TauDB.updateBalance(member.id, 500);
            }
            
            if (typeof createNotification === 'function') {
                createNotification(member.id, 'üéâ Welcome!', 'Welcome bonus: 500 iKbp', 'success');
            }
            
            showNotification('üìß Sending confirmation emails...', 'info');
            
            const [welcomeResult, adminResult] = await Promise.allSettled([
                sendWelcomeEmail(member),
                sendEmailToAdmin(member, 'NEW TALK REGISTRATION - PAYMENT CONFIRMED')
            ]);
            
            const welcomeSent = welcomeResult.status === 'fulfilled' && welcomeResult.value.success;
            const adminSent = adminResult.status === 'fulfilled' && adminResult.value.success;
            
            let message = '‚úÖ Registration complete!';
            if (welcomeSent && adminSent) {
                message += ' Emails sent successfully.';
            }
            
            showNotification(message, 'success');
            
            setTimeout(() => {
                closeAllModals();
                if (typeof showSuccessModal === 'function') showSuccessModal(member);
            }, 2000);
            
        } catch (error) {
            console.error('‚ùå Registration error:', error);
            showNotification('‚ùå Registration failed: ' + error.message, 'error');
        }
    };
    
    // JOB CREATION Success
    window.processJobCreationSuccess = async function(formData) {
        console.log('üéØ Processing Job Creation enrollment...');
        
        try {
            const referralCode = window.TauDB?.checkReferralCode();
            const syncResult = window.TauDB?.sync(formData, 'JOB_CREATION', referralCode);
            
            if (!syncResult || !syncResult.success) {
                throw new Error('Database sync failed');
            }
            
            const member = syncResult.member;
            
            if (window.TauDB?.updateBalance) {
                window.TauDB.updateBalance(member.id, 500);
            }
            
            showNotification('üìß Sending confirmation emails...', 'info');
            
            await Promise.allSettled([
                sendWelcomeEmail(member),
                sendEmailToAdmin(member, 'JOB CREATION ENROLLMENT - PAYMENT CONFIRMED')
            ]);
            
            showNotification('‚úÖ Enrollment complete! Emails sent.', 'success');
            
            setTimeout(() => {
                closeAllModals();
                if (typeof showSuccessModal === 'function') showSuccessModal(member);
            }, 2000);
            
        } catch (error) {
            console.error('‚ùå Enrollment error:', error);
            showNotification('‚ùå Enrollment failed: ' + error.message, 'error');
        }
    };
    
    // ============================================
    // 8. TEST FUNCTION
    // ============================================
    window.testTauEmails = async function() {
        console.log('üß™ Testing email system...');
        
        const testResult = await sendEmail(
            EMAIL_CONFIG.adminEmail,
            'Test User',
            'TAU Email System Test',
            'This is a test email from TAU Africa.\n\nIf you receive this, the email system is working correctly!\n\nTest Time: ' + new Date().toLocaleString()
        );
        
        if (testResult.success) {
            showNotification('‚úÖ Test email sent! Check ' + EMAIL_CONFIG.adminEmail, 'success');
            console.log('‚úÖ Test passed');
        } else {
            showNotification('‚ùå Test failed: ' + testResult.error, 'error');
            console.error('‚ùå Test failed:', testResult.error);
        }
        
        return testResult;
    };
    
    // ============================================
    // 9. STARTUP REPORT
    // ============================================
    setTimeout(() => {
        console.log('\n' + '='.repeat(60));
        console.log('üìß TAU AFRICA EMAIL SYSTEM STATUS');
        console.log('='.repeat(60));
        console.log('EmailJS:', emailInitialized ? '‚úÖ Ready' : '‚ùå Failed');
        console.log('Service ID:', EMAIL_CONFIG.serviceId);
        console.log('Template ID:', EMAIL_CONFIG.templateId);
        console.log('Admin Email:', EMAIL_CONFIG.adminEmail);
        console.log('='.repeat(60));
        console.log('Functions Available:');
        console.log('  ‚úÖ sendWelcomeEmail(member)');
        console.log('  ‚úÖ sendEmailToAdmin(formData, subject)');
        console.log('  ‚úÖ sendReferralNotification(referrer, earnings)');
        console.log('='.repeat(60));
        console.log('üí° Test: window.testTauEmails()');
        console.log('='.repeat(60) + '\n');
    }, 2000);
    
    console.log('‚úÖ Unified Email System loaded');
    
})();
</script>
    
    <script>
// ============================================
// 1. FIREBASE CONFIG & INIT
// ============================================
const FIREBASE_CONFIG = {
    apiKey: "AIzaSyAW0vk_gg03xXEm6I1TQnU8KRiv1RhcrQ4",
    authDomain: "tau-africa-ecosystem.firebaseapp.com",
    projectId: "tau-africa-ecosystem",
    storageBucket: "tau-africa-ecosystem.firebasestorage.app",
    messagingSenderId: "1047279398196",
    appId: "1:1047279398196:web:06d43661650c794268c961"
};

let db, isOnline = false;

function initializeFirebase() {
    try {
        // Check if Firebase library is loaded
        if (typeof firebase === 'undefined') {
            console.error('‚ùå Firebase library not loaded');
            return false;
        }
        
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(FIREBASE_CONFIG);
            console.log('‚úÖ Firebase app initialized');
        }
        
        // Get Firestore
        db = firebase.firestore();
        
        // Enable offline persistence
        db.enablePersistence({ synchronizeTabs: true })
            .then(() => {
                console.log('‚úÖ Offline cache enabled');
            })
            .catch(err => {
                if (err.code === 'failed-precondition') {
                    console.warn('‚ö†Ô∏è Multiple tabs open, persistence enabled in first tab only');
                } else if (err.code === 'unimplemented') {
                    console.warn('‚ö†Ô∏è Browser does not support persistence');
                }
            });
        
        isOnline = true;
        console.log('‚úÖ Firestore connected (PRIMARY STORAGE)');
        return true;
        
    } catch (error) {
        console.error('‚ùå Firebase init failed:', error);
        isOnline = false;
        return false;
    }
}

// Initialize Firebase when scripts are loaded
setTimeout(() => {
    initializeFirebase();
}, 1000);
    
    // ============================================
    // 2. CLOUD-FIRST TauDB.sync() 
    // ============================================
    if (window.TauDB && window.TauDB.sync) {
        const originalSync = window.TauDB.sync;
        
        window.TauDB.sync = async function(formData, team, referralCode) {
            console.log('‚òÅÔ∏è Cloud-first registration starting...');
            
            if (!db || !isOnline) {
                alert('‚ùå Cloud storage unavailable. Please connect to the internet to register.');
                return { success: false, error: 'No internet connection' };
            }
            
            // 1. Generate member ID
            const memberId = generateMemberID(team, referralCode);
            const memberReferralCode = generateReferralCode(memberId);
            
            // 2. Create member object
            const member = {
                id: memberId,
                referralCode: memberReferralCode,
                team: team,
                fullName: formData.fullName || formData.name,
                email: formData.email,
                phone: formData.phone,
                location: formData.location,
                paymentStatus: 'Paid',
                dateJoined: new Date().toISOString().split('T')[0],
                status: 'Active',
                fee: team === 'TASK' ? 500 : team === 'TALK' ? 2000 : 1500,
                accountCreated: new Date().toISOString(),
                lastLogin: null,
                activities: [],
                tasks: [],
                iKbpBalance: 500, // Welcome bonus
                iKbBalance: 0,
                referredBy: referralCode || null,
                ...formData // Include all form data
            };
            
            try {
                // 3. SAVE TO FIRESTORE FIRST (PRIMARY)
                await db.collection('members').doc(memberId).set({
                    ...member,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastModified: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log('‚úÖ Saved to Firestore (PRIMARY):', memberId);
                
                // Also save to tau_members for Bridge compatibility
                await db.collection('tau_members').doc(memberId).set(member);
                
                // 4. CACHE TO LOCALSTORAGE (SECONDARY - for offline access)
                const localMembers = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
                localMembers.push(member);
                localStorage.setItem('tauAfricaDB', JSON.stringify(localMembers));
                console.log('üíæ Cached to localStorage (secondary)');
                
                // 5. Store credentials
                const credentials = JSON.parse(localStorage.getItem('tauCredentials') || '{}');
                credentials[memberId] = {
                    email: member.email,
                    phone: member.phone.slice(-4),
                    fullName: member.fullName
                };
                localStorage.setItem('tauCredentials', JSON.stringify(credentials));
                
                // 6. Track referral
                if (referralCode) {
                    await trackReferralFirestore(referralCode, memberId);
                }
                
                // 7. Create activity log
                await db.collection('activity_log').add({
                    type: 'new_registration',
                    memberId: memberId,
                    memberName: member.fullName,
                    team: team,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                return { success: true, memberId, member };
                
            } catch (error) {
                console.error('‚ùå Firestore save failed:', error);
                alert('‚ùå Registration failed. Please check your internet connection and try again.');
                return { success: false, error: error.message };
            }
        };
        
        console.log('‚úÖ TauDB.sync enhanced (CLOUD-FIRST)');
    }
    
    // ============================================
    // 3. CLOUD-FIRST AUTHENTICATE
    // ============================================
    if (window.TauDB && window.TauDB.authenticate) {
        const originalAuth = window.TauDB.authenticate;
        
        window.TauDB.authenticate = async function(identifier, phoneLastFour) {
            console.log('‚òÅÔ∏è Cloud-first authentication...');
            
            if (!db || !isOnline) {
                // Fallback to localStorage if offline
                console.warn('‚ö†Ô∏è Offline mode - using cached data');
                return originalAuth.call(this, identifier, phoneLastFour);
            }
            
            try {
                // Try to find member in Firestore
                let memberDoc = await db.collection('members').doc(identifier).get();
                
                if (!memberDoc.exists) {
                    // Search by email
                    const querySnapshot = await db.collection('members')
                        .where('email', '==', identifier)
                        .limit(1)
                        .get();
                    
                    if (!querySnapshot.empty) {
                        memberDoc = querySnapshot.docs[0];
                    }
                }
                
                if (!memberDoc.exists) {
                    // Try localStorage as fallback
                    return originalAuth.call(this, identifier, phoneLastFour);
                }
                
                const member = memberDoc.data();
                
                // Verify phone
                if (member.phone.slice(-4) !== phoneLastFour) {
                    return { success: false, error: 'Invalid credentials' };
                }
                
                // Update last login
                await db.collection('members').doc(member.id).update({
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Cache to localStorage
                const localMembers = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
                const index = localMembers.findIndex(m => m.id === member.id);
                if (index >= 0) {
                    localMembers[index] = member;
                } else {
                    localMembers.push(member);
                }
                localStorage.setItem('tauAfricaDB', JSON.stringify(localMembers));
                
                // Save session
                sessionStorage.setItem('tauCurrentUser', JSON.stringify(member));
                
                console.log('‚úÖ Authenticated from Firestore:', member.id);
                return { success: true, member };
                
            } catch (error) {
                console.error('‚ùå Firestore auth failed:', error);
                // Fallback to localStorage
                return originalAuth.call(this, identifier, phoneLastFour);
            }
        };
    }
    
    // ============================================
    // 4. CLOUD-FIRST BALANCE UPDATES
    // ============================================
    if (window.TauDB && window.TauDB.updateBalance) {
        const originalUpdateBalance = window.TauDB.updateBalance;
        
        window.TauDB.updateBalance = async function(memberId, amount) {
            if (db && isOnline) {
                try {
                    await db.collection('members').doc(memberId).update({
                        iKbpBalance: firebase.firestore.FieldValue.increment(amount),
                        lastModified: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    console.log('‚úÖ Balance updated in Firestore');
                } catch (error) {
                    console.error('‚ö†Ô∏è Firestore balance update failed:', error);
                }
            }
            
            // Also update localStorage (cache)
            return originalUpdateBalance.call(this, memberId, amount);
        };
    }
    
    // ============================================
    // 5. REAL-TIME SYNC (Download changes from cloud)
    // ============================================
    function setupRealtimeSync() {
        if (!db || !isOnline) return;
        
        console.log('üëÇ Setting up real-time sync from cloud...');
        
        db.collection('members').onSnapshot(snapshot => {
            snapshot.docChanges().forEach(change => {
                const memberData = { id: change.doc.id, ...change.doc.data() };
                const localMembers = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
                
                if (change.type === 'added' || change.type === 'modified') {
                    const index = localMembers.findIndex(m => m.id === memberData.id);
                    if (index >= 0) {
                        localMembers[index] = memberData;
                    } else {
                        localMembers.push(memberData);
                    }
                    localStorage.setItem('tauAfricaDB', JSON.stringify(localMembers));
                    console.log('üîÑ Synced from cloud:', memberData.id);
                }
            });
            
            // Refresh UI
            if (typeof updateStats === 'function') updateStats();
            if (typeof renderMembers === 'function') renderMembers();
        });
        
        console.log('‚úÖ Real-time sync active');
    }
    
    setTimeout(setupRealtimeSync, 3000);
    
    // ============================================
    // 6. HELPER FUNCTIONS
    // ============================================
    function generateMemberID(team, referralCode) {
        const prefix = team === 'TASK' ? 'TSK' : team === 'TALK' ? 'TLK' : 'JOB';
        const timestamp = Date.now().toString().slice(-6);
        const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
        return `${prefix}-${timestamp}-${random}`;
    }
    
    function generateReferralCode(memberId) {
        return btoa(memberId).substring(0, 8).toUpperCase();
    }
    
    async function trackReferralFirestore(referralCode, newMemberId) {
        try {
            const querySnapshot = await db.collection('members')
                .where('referralCode', '==', referralCode)
                .limit(1)
                .get();
            
            if (!querySnapshot.empty) {
                const referrerDoc = querySnapshot.docs[0];
                const referrerId = referrerDoc.id;
                
                // Award referral bonus
                await db.collection('members').doc(referrerId).update({
                    iKbpBalance: firebase.firestore.FieldValue.increment(500),
                    lastModified: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log('‚úÖ Referral bonus awarded:', referrerId);
            }
        } catch (error) {
            console.error('‚ö†Ô∏è Referral tracking error:', error);
        }
    }
    
    // ============================================
    // 7. EXPOSE API
    // ============================================
    window.TauFirestore = {
        db: db,
        isOnline: () => isOnline,
        forceSync: async function(memberId) {
            if (!db || !isOnline) return null;
            const doc = await db.collection('members').doc(memberId).get();
            return doc.exists ? doc.data() : null;
        }
    };
    
    console.log('‚úÖ Cloud-First Storage Active');
    console.log('üìä Storage Priority: Firestore (primary) ‚Üí localStorage (cache)');
    
})();
</script>
    <script>
// ===== M-PESA PAYMENT INTEGRATION =====
function initiateMpesaPayment(amount, phoneNumber, formData, successCallback) {
    showPaymentModal(amount, phoneNumber, formData, successCallback);
}

function showPaymentModal(amount, phoneNumber, formData, successCallback) {
    const paymentModal = document.createElement('div');
    paymentModal.className = 'payment-modal';
    paymentModal.innerHTML = `
        <div class="payment-widget">
            <h3>üì± M-PESA Payment</h3>
            <div class="payment-step">
                <h4>Amount: KSH ${amount}</h4>
                <p>Phone: ${phoneNumber}</p>
                <p style="color: #666; font-size: 0.9em;">A payment prompt will be sent to your phone</p>
            </div>
            <div id="paymentSteps">
                <div style="margin: 20px 0; padding: 15px; background: #f0f8ff; border-radius: 10px;">
                    <p><strong>Payment Process:</strong></p>
                    <ol style="text-align: left; margin-top: 10px;">
                        <li>Check your phone for M-PESA prompt</li>
                        <li>Enter your M-PESA PIN</li>
                        <li>Confirm the payment</li>
                        <li>Wait for confirmation</li>
                    </ol>
                </div>
                <input type="text" class="payment-input" placeholder="Enter confirmation code (if received)" id="confirmationCode">
                <button class="btn" onclick="simulatePayment(${amount}, '${phoneNumber}')">Confirm Payment</button>
            </div>
            <button class="btn" style="background: #e74c3c; margin-top: 20px;" onclick="cancelPayment()">Cancel Payment</button>
        </div>
    `;
    paymentModal.formData = formData;
    paymentModal.successCallback = successCallback;
    document.body.appendChild(paymentModal);
}

function simulatePayment(amount, phoneNumber) {
    const paymentModal = document.querySelector('.payment-modal');
    const confirmationCode = document.getElementById('confirmationCode').value;
    
    if (confirmationCode.length < 4) {
        showNotification('Please enter a valid confirmation code', 'error');
        return;
    }

    paymentModal.innerHTML = `
        <div class="payment-widget">
            <h3>Processing Payment...</h3>
            <div class="spinner"></div>
            <p>Verifying M-PESA transaction</p>
            <p style="font-size: 0.9em; color: #666;">Transaction ID: MPX${Date.now()}</p>
        </div>
    `;

    setTimeout(() => {
        if (Math.random() > 0.05) {
            const storedFormData = paymentModal.formData;
            const callback = paymentModal.successCallback;
            
            paymentModal.remove();
            
            if (callback === 'processTaskSuccess') {
                processTaskSuccess(storedFormData);
            } else if (callback === 'processTalkSuccess') {
                processTalkSuccess(storedFormData);
            } else if (callback === 'processJobCreationSuccess') {
                processJobCreationSuccess(storedFormData);
            }
            
            showNotification(`M-PESA payment of KSH ${amount} successful! Transaction ID: MPX${Date.now()}`, 'success');
        } else {
            paymentModal.remove();
            showNotification('Payment failed. Please try again or contact support.', 'error');
        }
    }, 3000);
}

function cancelPayment() {
    document.querySelector('.payment-modal')?.remove();
    showNotification('Payment cancelled', 'error');
}

// ===== NOTIFICATION SYSTEM =====
function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.innerHTML = message;
    notification.className = `notification ${type}`;
    notification.style.display = 'block';
    
    setTimeout(() => {
        notification.style.display = 'none';
    }, 6000);
}

// ===== MODAL MANAGEMENT =====
function openModal(type) {
    closeAllModals();
    
    const modalContent = getModalContent(type);
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = modalContent;
    document.body.appendChild(modal);
    currentModal = modal;
}

function closeAllModals() {
    const modals = document.querySelectorAll('.modal, .payment-modal');
    modals.forEach(modal => modal.remove());
    currentModal = null;
}

// ===== SELECTION FUNCTIONS =====
function selectLevel(level, element) {
    const buttons = document.querySelectorAll('.level-btn');
    buttons.forEach(btn => btn.classList.remove('selected'));
    const target = element || (window.event && window.event.target);
    if (target) {
        target.classList.add('selected');
    }
    selectedLevel = level;
    const levelInput = document.getElementById('supportLevel');
    if (levelInput) levelInput.value = level;
    
    const enhanced = document.getElementById('enhancedRequirements');
    if (enhanced && (level === 'middle' || level === 'upper' || level === 'high' || level === 'top')) {
        enhanced.style.display = 'block';
    }
}

function selectCategory(category, element) {
    const buttons = document.querySelectorAll('.level-btn');
    buttons.forEach(btn => btn.classList.remove('selected'));
    const target = element || (window.event && window.event.target);
    if (target) {
        target.classList.add('selected');
    }
    selectedCategory = category;
    const categoryInput = document.getElementById('taskCategory');
    if (categoryInput) categoryInput.value = category;
}

// ===== FORM SUBMISSION HANDLERS =====
function processTaskRegistration(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    if (!data.phone || !data.fullName || !data.email || !selectedCategory) {
        showNotification('Please fill all required fields and select a category', 'error');
        return;
    }
    
    if (!data.phone.match(/^254[0-9]{9}$/)) {
        showNotification('Please use correct phone format: 254XXXXXXXXX', 'error');
        return;
    }
    
    data.category = selectedCategory;
    initiateMpesaPayment(500, data.phone, data, 'processTaskSuccess');
}

function processTalkRegistration(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    if (!data.phone || !data.fullName || !data.email || !selectedLevel) {
        showNotification('Please fill all required fields and select a support level', 'error');
        return;
    }
    
    if (!data.phone.match(/^254[0-9]{9}$/)) {
        showNotification('Please use correct phone format: 254XXXXXXXXX', 'error');
        return;
    }
    
    data.supportLevel = selectedLevel;
    initiateMpesaPayment(2000, data.phone, data, 'processTalkSuccess');
}

function processJobCreationTraining(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    if (!data.phone || !data.fullName || !data.email) {
        showNotification('Please fill all required fields', 'error');
        return;
    }
    
    if (!data.phone.match(/^254[0-9]{9}$/)) {
        showNotification('Please use correct phone format: 254XXXXXXXXX', 'error');
        return;
    }
    
    initiateMpesaPayment(1500, data.phone, data, 'processJobCreationSuccess');
}

// ===== DUAL EMAIL SUCCESS HANDLERS =====
function processTaskSuccess(formData) {
    formData.team = 'TASK';
    console.log('üìß Processing TASK registration - sending DUAL emails...');
    
    Promise.all([
        sendEmailToAdmin(formData, 'NEW TASK REGISTRATION - PAYMENT CONFIRMED'),
        sendWelcomeEmail(formData)
    ])
    .then(results => {
        const adminSent = results[0];
        const memberSent = results[1];
        
        if (adminSent && memberSent) {
            showNotification('‚úÖ Registration complete! Confirmation emails sent to you and admin.', 'success');
        } else if (adminSent || memberSent) {
            showNotification('‚úÖ Registration complete! One email sent successfully.', 'success');
        } else {
            showNotification('‚ö†Ô∏è Registration saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        }
        closeAllModals();
    })
    .catch(error => {
        console.error('Email error:', error);
        showNotification('‚ö†Ô∏è Registration saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        closeAllModals();
    });
}

function processTalkSuccess(formData) {
    formData.team = 'TALK';
    console.log('üìß Processing TALK registration - sending DUAL emails...');
    
    Promise.all([
        sendEmailToAdmin(formData, 'NEW TALK REGISTRATION - PAYMENT CONFIRMED'),
        sendWelcomeEmail(formData)
    ])
    .then(results => {
        const adminSent = results[0];
        const memberSent = results[1];
        
        if (adminSent && memberSent) {
            showNotification('‚úÖ Registration complete! Confirmation emails sent to you and admin.', 'success');
        } else if (adminSent || memberSent) {
            showNotification('‚úÖ Registration complete! One email sent successfully.', 'success');
        } else {
            showNotification('‚ö†Ô∏è Registration saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        }
        closeAllModals();
    })
    .catch(error => {
        console.error('Email error:', error);
        showNotification('‚ö†Ô∏è Registration saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        closeAllModals();
    });
}

function processJobCreationSuccess(formData) {
    formData.team = 'JOB CREATION';
    console.log('üìß Processing Job Creation - sending DUAL emails...');
    
    Promise.all([
        sendEmailToAdmin(formData, 'JOB CREATION ENROLLMENT - PAYMENT CONFIRMED'),
        sendWelcomeEmail(formData)
    ])
    .then(results => {
        const adminSent = results[0];
        const memberSent = results[1];
        
        if (adminSent && memberSent) {
            showNotification('‚úÖ Enrollment complete! Confirmation emails sent to you and admin.', 'success');
        } else if (adminSent || memberSent) {
            showNotification('‚úÖ Enrollment complete! One email sent successfully.', 'success');
        } else {
            showNotification('‚ö†Ô∏è Enrollment saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        }
        closeAllModals();
    })
    .catch(error => {
        console.error('Email error:', error);
        showNotification('‚ö†Ô∏è Enrollment saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        closeAllModals();
    });
}

// ===== OTHER FORM SUBMISSIONS WITH FIXED EMAIL =====
function processTrainingRegistration(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.team = 'TRAINING';
    
    console.log('üìß Submitting training registration...');
    Promise.all([
        sendEmailToAdmin(data, 'TRAINING PROGRAM REGISTRATION'),
        sendWelcomeEmail(data)
    ])
    .then(() => {
        showNotification('‚úÖ Training registration successful! Check your email.', 'success');
        closeAllModals();
    })
    .catch(() => {
        showNotification('‚ö†Ô∏è Registration saved. Contact: grouptauafrica@gmail.com', 'error');
        closeAllModals();
    });
}

function processWorkshopProposal(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.team = 'WORKSHOP';
    
    console.log('üìß Submitting workshop proposal - sending DUAL emails...');
    
    Promise.all([
        sendEmailToAdmin(data, 'WORKSHOP PROPOSAL SUBMISSION'),
        sendWelcomeEmail(data)
    ])
    .then(results => {
        const adminSent = results[0];
        const memberSent = results[1];
        
        if (adminSent || memberSent) {
            showNotification('‚úÖ Workshop proposal submitted! Confirmation emails sent.', 'success');
        } else {
            showNotification('‚ö†Ô∏è Proposal saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        }
        closeAllModals();
    })
    .catch(error => {
        console.error('Email error:', error);
        showNotification('‚ö†Ô∏è Proposal saved. Contact: grouptauafrica@gmail.com', 'error');
        closeAllModals();
    });
    }

function processResearchRequest(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.team = 'RESEARCH';
    
    console.log('üìß Submitting research request - sending DUAL emails...');
    
    Promise.all([
        sendEmailToAdmin(data, 'RESEARCH SERVICES REQUEST'),
        sendWelcomeEmail(data)
    ])
    .then(results => {
        const adminSent = results[0];
        const memberSent = results[1];
        
        if (adminSent || memberSent) {
            showNotification('‚úÖ Research request submitted! Confirmation emails sent.', 'success');
        } else {
            showNotification('‚ö†Ô∏è Request saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        }
        closeAllModals();
    })
    .catch(error => {
        console.error('Email error:', error);
        showNotification('‚ö†Ô∏è Request saved. Contact: grouptauafrica@gmail.com', 'error');
        closeAllModals();
    });
}
function processJobPosting(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.team = 'JOB POSTING';
    
    console.log('üìß Submitting job posting - sending DUAL emails...');
    
    Promise.all([
        sendEmailToAdmin(data, 'NEW JOB POSTING'),
        sendWelcomeEmail(data)
    ])
    .then(results => {
        const adminSent = results[0];
        const memberSent = results[1];
        
        if (adminSent || memberSent) {
            showNotification('‚úÖ Job posting submitted! Confirmation emails sent.', 'success');
        } else {
            showNotification('‚ö†Ô∏è Posting saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        }
        closeAllModals();
    })
    .catch(error => {
        console.error('Email error:', error);
        showNotification('‚ö†Ô∏è Posting saved. Contact: grouptauafrica@gmail.com', 'error');
        closeAllModals();
    });
}

function processJobSearch(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    console.log('Submitting job search...');
    sendEmailToOrganization(data, 'JOB SEARCH REQUEST')
        .then(success => {
            if (success) {
                showNotification('‚úÖ Job search submitted! Email sent.', 'success');
                closeAllModals();
            } else {
                showNotification('‚ùå Email failed. Please contact grouptauafrica@gmail.com', 'error');
            }
        });
}

function processJobApplication(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    console.log('Submitting job application...');
    sendEmailToOrganization(data, 'JOB APPLICATION')
        .then(success => {
            if (success) {
                showNotification('‚úÖ Application submitted! Email sent.', 'success');
                closeAllModals();
            } else {
                showNotification('‚ùå Email failed. Please contact grouptauafrica@gmail.com', 'error');
            }
        });
}

function processJobApplication(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.team = 'JOB APPLICATION';
    
    console.log('üìß Submitting job application - sending DUAL emails...');
    
    Promise.all([
        sendEmailToAdmin(data, 'NEW JOB APPLICATION'),
        sendWelcomeEmail(data)
    ])
    .then(results => {
        const adminSent = results[0];
        const memberSent = results[1];
        
        if (adminSent || memberSent) {
            showNotification('‚úÖ Application submitted! Confirmation emails sent.', 'success');
        } else {
            showNotification('‚ö†Ô∏è Application saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        }
        closeAllModals();
    })
    .catch(error => {
        console.error('Email error:', error);
        showNotification('‚ö†Ô∏è Application saved. Contact: grouptauafrica@gmail.com', 'error');
        closeAllModals();
    });
}
function processCommunityRegistration(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.team = 'COMMUNITY';
    
    console.log('üìß Submitting community registration - sending DUAL emails...');
    
    Promise.all([
        sendEmailToAdmin(data, 'COMMUNITY PROGRAM REGISTRATION'),
        sendWelcomeEmail(data)
    ])
    .then(results => {
        const adminSent = results[0];
        const memberSent = results[1];
        
        if (adminSent || memberSent) {
            showNotification('‚úÖ Community registration successful! Confirmation emails sent.', 'success');
        } else {
            showNotification('‚ö†Ô∏è Registration saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        }
        closeAllModals();
    })
    .catch(error => {
        console.error('Email error:', error);
        showNotification('‚ö†Ô∏è Registration saved. Contact: grouptauafrica@gmail.com', 'error');
        closeAllModals();
    });
}

function processCorporateRegistration(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.team = 'CORPORATE';
    
    console.log('üìß Submitting corporate registration - sending DUAL emails...');
    
    Promise.all([
        sendEmailToAdmin(data, 'CORPORATE REGISTRATION'),
        sendWelcomeEmail(data)
    ])
    .then(results => {
        const adminSent = results[0];
        const memberSent = results[1];
        
        if (adminSent || memberSent) {
            showNotification('‚úÖ Corporate registration submitted! Confirmation emails sent.', 'success');
        } else {
            showNotification('‚ö†Ô∏è Registration saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        }
        closeAllModals();
    })
    .catch(error => {
        console.error('Email error:', error);
        showNotification('‚ö†Ô∏è Registration saved. Contact: grouptauafrica@gmail.com', 'error');
        closeAllModals();
    });
}

function processParSiraiRegistration(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.team = 'PAR SIRAI';
    
    console.log('üìß Submitting Par Sirai registration - sending DUAL emails...');
    
    Promise.all([
        sendEmailToAdmin(data, 'PAR SIRAI CENTER REGISTRATION'),
        sendWelcomeEmail(data)
    ])
    .then(results => {
        if (results[0] || results[1]) {
            showNotification('‚úÖ Par Sirai registration successful! Confirmation emails sent.', 'success');
        } else {
            showNotification('‚ö†Ô∏è Registration saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        }
        closeAllModals();
    })
    .catch(error => {
        console.error('Email error:', error);
        showNotification('‚ö†Ô∏è Registration saved. Contact: grouptauafrica@gmail.com', 'error');
        closeAllModals();
    });
}

function processTrustGraphAccess(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.team = 'TRUST GRAPH';
    
    console.log('üìß Submitting Trust Graph access - sending DUAL emails...');
    
    Promise.all([
        sendEmailToAdmin(data, 'TRUST GRAPH ACCESS REQUEST'),
        sendWelcomeEmail(data)
    ])
    .then(results => {
        if (results[0] || results[1]) {
            showNotification('‚úÖ Trust Graph access requested! Confirmation emails sent.', 'success');
        } else {
            showNotification('‚ö†Ô∏è Request saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        }
        closeAllModals();
    })
    .catch(error => {
        console.error('Email error:', error);
        showNotification('‚ö†Ô∏è Request saved. Contact: grouptauafrica@gmail.com', 'error');
        closeAllModals();
    });
}
function processFoundationInquiry(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.team = 'FOUNDATION';
    
    console.log('üìß Submitting Foundation inquiry - sending DUAL emails...');
    
    Promise.all([
        sendEmailToAdmin(data, 'FOUNDATION INQUIRY'),
        sendWelcomeEmail(data)
    ])
    .then(results => {
        if (results[0] || results[1]) {
            showNotification('‚úÖ Foundation inquiry submitted! Confirmation emails sent.', 'success');
        } else {
            showNotification('‚ö†Ô∏è Inquiry saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        }
        closeAllModals();
    })
    .catch(error => {
        console.error('Email error:', error);
        showNotification('‚ö†Ô∏è Inquiry saved. Contact: grouptauafrica@gmail.com', 'error');
        closeAllModals();
    });
}

function processHoldingsInquiry(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.team = 'HOLDINGS';
    
    console.log('üìß Submitting Holdings inquiry - sending DUAL emails...');
    
    Promise.all([
        sendEmailToAdmin(data, 'COMPANY HOLDINGS INQUIRY'),
        sendWelcomeEmail(data)
    ])
    .then(results => {
        if (results[0] || results[1]) {
            showNotification('‚úÖ Holdings inquiry submitted! Confirmation emails sent.', 'success');
        } else {
            showNotification('‚ö†Ô∏è Inquiry saved but emails failed. Contact: grouptauafrica@gmail.com', 'error');
        }
        closeAllModals();
    })
    .catch(error => {
        console.error('Email error:', error);
        showNotification('‚ö†Ô∏è Inquiry saved. Contact: grouptauafrica@gmail.com', 'error');
        closeAllModals();
    });
}
// ===== AI ASSISTANT FUNCTIONS =====
function toggleAIChat() {
    const chatWindow = document.getElementById('aiChatWindow');
    if (chatWindow.style.display === 'none' || !chatWindow.style.display) {
        chatWindow.style.display = 'flex';
    } else {
        chatWindow.style.display = 'none';
    }
}

function handleAIChatKeyPress(event) {
    if (event.key === 'Enter') {
        sendAIMessage();
    }
}

function sendAIMessage() {
    const input = document.getElementById('aiChatInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    const messagesContainer = document.getElementById('aiChatMessages');
    
    const userMessage = document.createElement('div');
    userMessage.className = 'ai-message user-message';
    userMessage.textContent = message;
    messagesContainer.appendChild(userMessage);
    
    input.value = '';
    
    setTimeout(() => {
        const aiResponse = generateAIResponse(message);
        const aiMessage = document.createElement('div');
        aiMessage.className = 'ai-message';
        aiMessage.innerHTML = aiResponse;
        messagesContainer.appendChild(aiMessage);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }, 1000);
    
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function generateAIResponse(userMessage) {
    const message = userMessage.toLowerCase();
    
    if (message.includes('register') || message.includes('join')) {
        return `To register with TAU Africa, you can choose between:<br>
        ‚Ä¢ <strong>TASK Team (KSH 500)</strong> - For service providers and skilled professionals<br>
        ‚Ä¢ <strong>TALK Team (KSH 2,000)</strong> - For investors and financial supporters<br>
        ‚Ä¢ <strong>Job Creation Training (KSH 1,500)</strong> - For aspiring entrepreneurs<br>
        <br>Click the relevant buttons in the Membership section to get started!`;
    }
    
    if (message.includes('payment') || message.includes('mpesa')) {
        return `Our payment process uses M-PESA:<br>
        1. Enter your M-PESA number (254XXXXXXXXX format)<br>
        2. You'll receive a payment prompt on your phone<br>
        3. Enter your M-PESA PIN to confirm<br>
        4. Wait for confirmation<br>
        <br>All payments are secure and processed instantly!`;
    }
    
    if (message.includes('kabiru') || message.includes('mining')) {
        return `Kabiru is our digital currency! You can:<br>
        ‚Ä¢ Mine Kabiru by validating real values in the community<br>
        ‚Ä¢ Use the mining portal<br>
        ‚Ä¢ Earn through community contributions<br>
        ‚Ä¢ Convert to other currencies through our ecosystem`;
    }
    
    if (message.includes('help') || message.includes('support')) {
        return `I'm here to help! You can ask me about:<br>
        ‚Ä¢ Registration processes and payments<br>
        ‚Ä¢ Kabiru mining and digital currency<br>
        ‚Ä¢ Community programs and training<br>
        ‚Ä¢ Technical issues with the app<br>
        ‚Ä¢ Business registration services<br>
        <br>What specific area would you like help with?`;
    }
    
    return `Thank you for your question! Here are some ways I can help:<br>
    ‚Ä¢ Registration and membership information<br>
    ‚Ä¢ Payment and M-PESA guidance<br>
    ‚Ä¢ Kabiru mining and digital currency<br>
    ‚Ä¢ Community programs and forum access<br>
    ‚Ä¢ Technical support<br>
    <br>Please ask a specific question, or contact <strong>grouptauafrica@gmail.com</strong> for detailed support.`;
}

// ===== MEMBER LOGIN FUNCTIONS =====
function showMemberLogin() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content">
            <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
            <h2>Member Login</h2>
            <p>Access your TAU Africa member dashboard</p>
            
            <form onsubmit="simulateLogin(event)">
                <div class="form-group">
                    <label>Email or Member ID</label>
                    <input type="text" name="loginId" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required>
                </div>
                <button type="submit" class="btn">Login to Dashboard</button>
                
                <div style="text-align: center; margin-top: 20px;">
                    <p>New member? Complete registration through TASK or TALK teams first!</p>
                </div>
            </form>
            
            <div style="background: #f0f8ff; padding: 15px; border-radius: 10px; margin-top: 20px;">
                <h4>Demo Access:</h4>
                <p>Use any email/password to see dashboard preview</p>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function simulateLogin(event) {
    event.preventDefault();
    showNotification('Login successful! Loading dashboard...', 'success');
    setTimeout(() => {
        closeAllModals();
        showMemberDashboard();
    }, 1500);
}

function showMemberDashboard() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
            <h2>TAU Africa Member Dashboard</h2>
            <p>Welcome, <strong>Demo User</strong></p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
                <div style="background: linear-gradient(45deg, #4169e1, #87ceeb); color: white; padding: 20px; border-radius: 15px; text-align: center; cursor: pointer;" onclick="showNotification('Profile management launching soon!', 'success')">
                    <h4>My Profile</h4>
                    <p>Manage account</p>
                </div>
                <div style="background: linear-gradient(45deg, #ff6b6b, #ee5a24); color: white; padding: 20px; border-radius: 15px; text-align: center; cursor: pointer;" onclick="showNotification('Programs dashboard launching soon!', 'success')">
                    <h4>My Programs</h4>
                    <p>Active memberships</p>
                </div>
                <div style="background: linear-gradient(45deg, #2ecc71, #27ae60); color: white; padding: 20px; border-radius: 15px; text-align: center; cursor: pointer;" onclick="window.open('https://magero1985.github.io/Kabiru-Mining-Portal-/', '_blank')">
                    <h4>Kabiru Wallet</h4>
                    <p>0.00 KABIRU<br><small>Click to mine</small></p>
                </div>
                <div style="background: linear-gradient(45deg, #9b59b6, #8e44ad); color: white; padding: 20px; border-radius: 15px; text-align: center; cursor: pointer;" onclick="openModal('forum')">
                    <h4>Community</h4>
                    <p>Forum & networking</p>
                </div>
            </div>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin: 20px 0;">
                <h3>Recent Activity</h3>
                <ul style="list-style: none; padding: 0;">
                    <li style="padding: 10px 0; border-bottom: 1px solid #eee;">Registration completed - Welcome to TAU Africa!</li>
                    <li style="padding: 10px 0; border-bottom: 1px solid #eee;">Welcome email sent</li>
                    <li style="padding: 10px 0;">Ready to start your journey!</li>
                </ul>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <p><strong>Note:</strong> This is a dashboard preview. Full functionality available after registration.</p>
            </div>
            üë®‚Äçüíº Admin & Validator Access

    

        Authenticate activities, tasks, and manage member data
    


    
        üîê Open Admin Dashboard
        </div>
    `;
    document.body.appendChild(modal);
}

// ===== EVENT LISTENERS =====
document.addEventListener('click', function(event) {
    if (event.target.classList.contains('modal')) {
        closeAllModals();
    }
});

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeAllModals();
        document.getElementById('aiChatWindow').style.display = 'none';
    }
});

// ===== INITIALIZE APP =====
document.addEventListener('DOMContentLoaded', function() {
    console.log('========================================');
    console.log('TAU AFRICA INTERNATIONAL - INITIALIZED');
    console.log('========================================');
    console.log('‚úÖ EmailJS Status: ACTIVE & CONFIGURED');
    console.log('‚úÖ Service ID: service_xfira7g');
    console.log('‚úÖ Template ID: template_bqxztig');
    console.log('‚úÖ Recipient: grouptauafrica@gmail.com');
    console.log('‚úÖ M-PESA Payment: READY');
    console.log('‚úÖ All Forms: FUNCTIONAL WITH EMAIL');
    console.log('‚úÖ AI Assistant: ACTIVE');
    console.log('========================================');
    
    showNotification('‚úÖ Welcome to TAU Africa International! Email system is now ACTIVE - all forms will send to grouptauafrica@gmail.com', 'success');
});
        
// ===== GET MODAL CONTENT BASED ON TYPE =====
function getModalContent(type) {
    switch(type) {
        case 'taskRegistration':
            return createTaskRegistrationModal();
        case 'talkRegistration':
            return createTalkRegistrationModal();
        case 'corporate':
            return createCorporateModal();
        case 'training':
            return createTrainingModal();
        case 'workshop':
            return createWorkshopModal();
        case 'research':
            return createResearchModal();
        case 'jobCreation':
            return createJobCreationModal();
        case 'insertJob':
            return createInsertJobModal();
        case 'retrieveJob':
            return createRetrieveJobModal();
        case 'availableJobs':
            return createAvailableJobsModal();
        case 'applyJob':
            return createApplyJobModal();
        case 'community':
            return createCommunityModal();
        case 'parSirai':
            return createParSiraiModal();
        case 'trustGraph':
            return createTrustGraphModal();
        case 'foundation':
            return createFoundationModal();
        case 'holdings':
            return createHoldingsModal();
        case 'forum':
            return createForumModal();
        default:
            return '<div class="modal-content"><span class="close" onclick="closeAllModals()">&times;</span><h2>Feature Coming Soon</h2><p>This feature is under development.</p></div>';
    }
}

// ===== COMPREHENSIVE TASK REGISTRATION MODAL =====
function createTaskRegistrationModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>Join TASK Team</h2>
            <p>Declare the values or services you're offering to the TAU Africa community</p>
            
            <div class="payment-info">
                <h3>Registration Fee: KSH 500</h3>
                <p>Secure M-PESA payment required ‚Ä¢ One-time membership fee</p>
            </div>
            
            <form onsubmit="processTaskRegistration(event)" id="taskForm">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" name="fullName" required placeholder="Enter your full legal name">
                </div>
                
                <div class="form-group">
                    <label>Email Address *</label>
                    <input type="email" name="email" required placeholder="your.email@example.com">
                </div>
                
                <div class="form-group">
                    <label>Phone Number (M-PESA) *</label>
                    <input type="tel" name="phone" required placeholder="254XXXXXXXXX" pattern="254[0-9]{9}">
                    <small>Format: 254XXXXXXXXX (include country code)</small>
                </div>
                
                <div class="form-group">
                    <label>Country/Location *</label>
                    <input type="text" name="location" required placeholder="City, Country">
                </div>

                <div class="form-group">
                    <label>Date of Birth *</label>
                    <input type="date" name="dateOfBirth" required>
                </div>

                <div class="form-group">
                    <label>Gender *</label>
                    <select name="gender" required>
                        <option value="">Select gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                        <option value="Prefer not to say">Prefer not to say</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Nationality *</label>
                    <input type="text" name="nationality" required placeholder="Your nationality">
                </div>
                
                <div class="form-group">
                    <label>Value Category *</label>
                    <div class="level-selection">
                        <div class="level-btn" onclick="selectCategory('skills', this)">Skills & Crafts</div>
                        <div class="level-btn" onclick="selectCategory('knowledge', this)">Knowledge & Expertise</div>
                        <div class="level-btn" onclick="selectCategory('service', this)">Professional Service</div>
                        <div class="level-btn" onclick="selectCategory('profession', this)">Licensed Profession</div>
                        <div class="level-btn" onclick="selectCategory('creativity', this)">Creative Arts</div>
                        <div class="level-btn" onclick="selectCategory('leadership', this)">Leadership & Management</div>
                        <div class="level-btn" onclick="selectCategory('business', this)">Business & Entrepreneurship</div>
                    </div>
                    <input type="hidden" name="category" id="taskCategory" required>
                </div>
                
                <div class="form-group">
                    <label>Describe Your Value/Service *</label>
                    <textarea name="valueDescription" rows="4" placeholder="Provide a detailed description of what you offer, your expertise, and how it benefits the community" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Experience Level *</label>
                    <select name="experience" required>
                        <option value="">Select level</option>
                        <option value="Beginner">Beginner (0-2 years)</option>
                        <option value="Intermediate">Intermediate (2-5 years)</option>
                        <option value="Advanced">Advanced (5-10 years)</option>
                        <option value="Expert">Expert (10+ years)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Professional Certifications/Licenses</label>
                    <textarea name="certifications" rows="2" placeholder="List any professional certifications, licenses, or credentials you hold"></textarea>
                </div>

                <div class="form-group">
                    <label>Languages Spoken *</label>
                    <input type="text" name="languages" required placeholder="e.g., English, Swahili, French">
                </div>
                
                <h3 style="color: #2a5298; margin: 25px 0 15px 0;">Proof of Innocence & Capabilities</h3>
                
                <div class="form-group">
                    <label>Certificate of Good Conduct Status *</label>
                    <select name="goodConduct" required>
                        <option value="">Select status</option>
                        <option value="Available">Available - Can provide immediately</option>
                        <option value="Will obtain">Will obtain upon request</option>
                        <option value="In process">Currently in process of obtaining</option>
                        <option value="Not applicable">Not applicable in my country</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Health Records Status *</label>
                    <select name="healthStatus" required>
                        <option value="">Select status</option>
                        <option value="Excellent">Excellent health - Can provide medical certificate</option>
                        <option value="Good">Good health - Regular checkups</option>
                        <option value="Will provide">Will provide upon request</option>
                        <option value="Private">Prefer to keep private</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Track Record/References</label>
                    <textarea name="trackRecord" rows="3" placeholder="Previous work experience, achievements, client testimonials, or references (include contact information if possible)"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Family/Support System</label>
                    <textarea name="familySupport" rows="2" placeholder="Brief description of your family situation and support system"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Educational Qualifications</label>
                    <textarea name="education" rows="2" placeholder="Degrees, certificates, training completed, institutions attended"></textarea>
                </div>

                <div class="form-group">
                    <label>Emergency Contact *</label>
                    <input type="text" name="emergencyContact" required placeholder="Name and phone number">
                </div>

                <div class="form-group">
                    <label>How did you hear about TAU Africa? *</label>
                    <select name="referralSource" required>
                        <option value="">Select source</option>
                        <option value="Social Media">Social Media (Twitter/X, TikTok, YouTube)</option>
                        <option value="Friend/Family">Friend or Family Member</option>
                        <option value="Community Event">Community Event</option>
                        <option value="Online Search">Online Search</option>
                        <option value="Business Network">Business Network</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" name="terms" required style="width: auto; margin-right: 10px;">
                        I agree to the TAU Africa Terms of Service and Privacy Policy *
                    </label>
                </div>
                
                <button type="submit" class="btn btn-register">Proceed to M-PESA Payment (KSH 500)</button>
            </form>
        </div>
    `;
}

// ===== COMPREHENSIVE TALK REGISTRATION MODAL =====
function createTalkRegistrationModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>Join TALK Team</h2>
            <p>Declare financial support, grants, or investments you're offering to the African development ecosystem</p>
            
            <div class="payment-info">
                <h3>Registration Fee: KSH 2,000</h3>
                <p>Secure M-PESA payment ‚Ä¢ Deposit goes to Valenta Liquid Pool Reserve for Kabiru value conversion</p>
            </div>
            
            <form onsubmit="processTalkRegistration(event)" id="talkForm">
                <div class="form-group">
                    <label>Full Name/Organization Name *</label>
                    <input type="text" name="fullName" required placeholder="Individual name or organization">
                </div>
                
                <div class="form-group">
                    <label>Email Address *</label>
                    <input type="email" name="email" required placeholder="your.email@example.com">
                </div>
                
                <div class="form-group">
                    <label>Phone Number (M-PESA) *</label>
                    <input type="tel" name="phone" required placeholder="254XXXXXXXXX" pattern="254[0-9]{9}">
                </div>
                
                <div class="form-group">
                    <label>Country/Location *</label>
                    <input type="text" name="location" required>
                </div>

                <div class="form-group">
                    <label>Organization Type *</label>
                    <select name="organizationType" required>
                        <option value="">Select type</option>
                        <option value="Individual Investor">Individual Investor</option>
                        <option value="Corporation">Corporation</option>
                        <option value="Foundation">Foundation/NGO</option>
                        <option value="Government Agency">Government Agency</option>
                        <option value="Investment Fund">Investment Fund</option>
                        <option value="Development Bank">Development Bank</option>
                        <option value="Family Office">Family Office</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Website/LinkedIn Profile</label>
                    <input type="url" name="website" placeholder="https://example.com">
                </div>
                
                <div class="form-group">
                    <label>Financial Support Level *</label>
                    <div class="level-selection">
                        <div class="level-btn" onclick="selectLevel('ground', this)">Ground Level (&lt; $1,000)</div>
                        <div class="level-btn" onclick="selectLevel('middle', this)">Middle Level ($1,000-$5,000)</div>
                        <div class="level-btn" onclick="selectLevel('upper', this)">Upper Level ($5,000-$10,000)</div>
                        <div class="level-btn" onclick="selectLevel('high', this)">High Level ($10,000-$50,000)</div>
                        <div class="level-btn" onclick="selectLevel('top', this)">Top Level ($50,000+)</div>
                    </div>
                    <input type="hidden" name="supportLevel" id="supportLevel" required>
                </div>
                
                <div class="form-group">
                    <label>Type of Financial Support *</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <label><input type="checkbox" name="supportTypes" value="Grants"> Grants</label>
                        <label><input type="checkbox" name="supportTypes" value="Equity Investment"> Equity Investment</label>
                        <label><input type="checkbox" name="supportTypes" value="Debt Financing"> Debt Financing</label>
                        <label><input type="checkbox" name="supportTypes" value="Venture Capital"> Venture Capital</label>
                        <label><input type="checkbox" name="supportTypes" value="Angel Investment"> Angel Investment</label>
                        <label><input type="checkbox" name="supportTypes" value="Crowdfunding"> Crowdfunding</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Focus Areas/Industries *</label>
                    <textarea name="focusAreas" rows="3" placeholder="What sectors, industries, or types of projects do you want to support? (e.g., Agriculture, Technology, Education, Healthcare)" required></textarea>
                </div>

                <div class="form-group">
                    <label>Geographic Focus</label>
                    <input type="text" name="geographicFocus" placeholder="Specific countries or regions of interest">
                </div>

                <div class="form-group">
                    <label>Investment Criteria</label>
                    <textarea name="investmentCriteria" rows="3" placeholder="What criteria do you use when evaluating investment opportunities?"></textarea>
                </div>

                <div class="form-group">
                    <label>Previous African Investments</label>
                    <textarea name="previousInvestments" rows="2" placeholder="Brief description of previous investments or support in Africa"></textarea>
                </div>
                
                <div id="enhancedRequirements" style="display: none;">
                    <h3 style="color: #2a5298; margin: 25px 0 15px 0;">Enhanced Requirements (Middle Level & Above)</h3>
                    
                    <div class="form-group">
                        <label>Certificate of Good Conduct *</label>
                        <select name="goodConduct">
                            <option value="">Select status</option>
                            <option value="Available">Available - Can provide</option>
                            <option value="Will obtain">Will obtain upon request</option>
                            <option value="Not applicable">Not applicable in my country</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Health Records Status *</label>
                        <select name="healthStatus">
                            <option value="">Select status</option>
                            <option value="Excellent">Excellent health - Can provide certificate</option>
                            <option value="Good">Good health - Regular checkups</option>
                            <option value="Will provide">Will provide upon request</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Financial Track Record *</label>
                        <textarea name="financialTrack" rows="3" placeholder="Previous investments, business ventures, financial background, investment performance"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Net Worth Range (Optional)</label>
                        <select name="netWorth">
                            <option value="">Prefer not to disclose</option>
                            <option value="Under $100K">Under $100,000</option>
                            <option value="$100K-$500K">$100,000 - $500,000</option>
                            <option value="$500K-$1M">$500,000 - $1,000,000</option>
                            <option value="$1M-$5M">$1,000,000 - $5,000,000</option>
                            <option value="$5M-$10M">$5,000,000 - $10,000,000</option>
                            <option value="Over $10M">Over $10,000,000</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Family/Organizational Financial Support</label>
                        <textarea name="familyFinancial" rows="2" placeholder="Family financial situation or organizational financial backing"></textarea>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" name="terms" required style="width: auto; margin-right: 10px;">
                        I agree to the TAU Africa Terms of Service and Privacy Policy *
                    </label>
                </div>
                
                <button type="submit" class="btn btn-register">Proceed to M-PESA Payment (KSH 2,000)</button>
            </form>
        </div>
    `;
}

// ===== JOB CREATION TRAINING MODAL - COMPREHENSIVE =====
function createJobCreationModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üíº Job Creation Training Program</h2>
            <p>Comprehensive entrepreneurship and job creation program designed for African innovators</p>
            
            <div class="payment-info">
                <h3>Training Fee: KSH 1,500</h3>
                <p>6-week intensive program ‚Ä¢ Digital materials ‚Ä¢ Certification ‚Ä¢ Mentorship support</p>
            </div>
            
            <form onsubmit="processJobCreationTraining(event)" id="jobCreationForm">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" name="fullName" required>
                </div>
                
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label>Phone Number (M-PESA) *</label>
                    <input type="tel" name="phone" required placeholder="254XXXXXXXXX">
                </div>
                
                <div class="form-group">
                    <label>Location *</label>
                    <input type="text" name="location" required>
                </div>

                <div class="form-group">
                    <label>Age Range *</label>
                    <select name="ageRange" required>
                        <option value="">Select age range</option>
                        <option value="18-25">18-25 years</option>
                        <option value="26-35">26-35 years</option>
                        <option value="36-45">36-45 years</option>
                        <option value="46-55">46-55 years</option>
                        <option value="56+">56+ years</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Current Employment Status *</label>
                    <select name="employmentStatus" required>
                        <option value="">Select status</option>
                        <option value="Unemployed">Unemployed</option>
                        <option value="Underemployed">Underemployed</option>
                        <option value="Student">Student</option>
                        <option value="Self-employed">Self-employed</option>
                        <option value="Employed">Employed (seeking additional income)</option>
                        <option value="Recent Graduate">Recent Graduate</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Business Idea/Interest Area *</label>
                    <textarea name="businessIdea" rows="3" placeholder="What type of business or job creation are you interested in? Be specific about your vision." required></textarea>
                </div>

                <div class="form-group">
                    <label>Target Market/Customers *</label>
                    <textarea name="targetMarket" rows="2" placeholder="Who will be your customers or beneficiaries?" required></textarea>
                </div>

                <div class="form-group">
                    <label>Available Capital/Startup Funds</label>
                    <select name="startupFunds">
                        <option value="">Select range</option>
                        <option value="No funds">No funds available</option>
                        <option value="Under KSH 10K">Under KSH 10,000</option>
                        <option value="KSH 10K-50K">KSH 10,000 - 50,000</option>
                        <option value="KSH 50K-100K">KSH 50,000 - 100,000</option>
                        <option value="KSH 100K-500K">KSH 100,000 - 500,000</option>
                        <option value="Over KSH 500K">Over KSH 500,000</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Educational Background *</label>
                    <select name="education" required>
                        <option value="">Select level</option>
                        <option value="Primary School">Primary School</option>
                        <option value="Secondary School">Secondary School</option>
                        <option value="College Diploma">College Diploma</option>
                        <option value="University Degree">University Degree</option>
                        <option value="Postgraduate">Postgraduate</option>
                        <option value="Vocational Training">Vocational Training</option>
                        <option value="Self-taught">Self-taught</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Relevant Skills/Experience</label>
                    <textarea name="relevantSkills" rows="2" placeholder="List any skills or experience relevant to your business idea"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Training Focus Areas (Select all that apply) *</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                        <label><input type="checkbox" name="focus" value="Business Planning"> Business Planning</label>
                        <label><input type="checkbox" name="focus" value="Financial Management"> Financial Management</label>
                        <label><input type="checkbox" name="focus" value="Marketing & Sales"> Marketing & Sales</label>
                        <label><input type="checkbox" name="focus" value="Digital Skills"> Digital Skills</label>
                        <label><input type="checkbox" name="focus" value="Leadership"> Leadership</label>
                        <label><input type="checkbox" name="focus" value="Networking"> Networking</label>
                        <label><input type="checkbox" name="focus" value="Legal Compliance"> Legal Compliance</label>
                        <label><input type="checkbox" name="focus" value="Product Development"> Product Development</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Preferred Learning Format *</label>
                    <select name="learningFormat" required>
                        <option value="">Select format</option>
                        <option value="Online only">Online only</option>
                        <option value="In-person only">In-person only</option>
                        <option value="Hybrid">Hybrid (Online + In-person)</option>
                        <option value="Self-paced">Self-paced online</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Timeline to Start Business *</label>
                    <select name="businessTimeline" required>
                        <option value="">Select timeline</option>
                        <option value="Within 3 months">Within 3 months</option>
                        <option value="3-6 months">3-6 months</option>
                        <option value="6-12 months">6-12 months</option>
                        <option value="Over 1 year">Over 1 year</option>
                        <option value="Just exploring">Just exploring options</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" name="terms" required style="width: auto; margin-right: 10px;">
                        I agree to the TAU Africa Terms of Service and Privacy Policy *
                    </label>
                </div>
                
                <button type="submit" class="btn btn-register">Proceed to M-PESA Payment (KSH 1,500)</button>
            </form>
        </div>
    `;
}
        // TAU AFRICA INTERNATIONAL - PART 4: REMAINING MODALS 

// ===== TRAINING MODAL =====
function createTrainingModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üìö Join Training Programs</h2>
            
            <form onsubmit="processTrainingRegistration(event)">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" name="fullName" required>
                </div>
                
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label>Phone Number *</label>
                    <input type="tel" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label>Training Category *</label>
                    <select name="trainingCategory" required>
                        <option value="">Select training area</option>
                        <option>Digital Skills & Technology</option>
                        <option>Business & Entrepreneurship</option>
                        <option>Financial Literacy</option>
                        <option>Leadership Development</option>
                        <option>Agricultural Innovation</option>
                        <option>Pan-African Studies</option>
                        <option>Health & Wellness</option>
                        <option>Creative Arts</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Experience Level *</label>
                    <select name="level" required>
                        <option value="">Select level</option>
                        <option>Beginner</option>
                        <option>Intermediate</option>
                        <option>Advanced</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Learning Goals *</label>
                    <textarea name="goals" rows="3" placeholder="What do you hope to achieve through this training?" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Preferred Training Format</label>
                    <select name="format">
                        <option>Online</option>
                        <option>In-person</option>
                        <option>Hybrid</option>
                    </select>
                </div>
                
                <button type="submit" class="btn">Register for Training</button>
            </form>
        </div>
    `;
}

// ===== WORKSHOP MODAL =====
function createWorkshopModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üéØ Host a Workshop</h2>
            
            <form onsubmit="processWorkshopProposal(event)">
                <div class="form-group">
                    <label>Your Name *</label>
                    <input type="text" name="hostName" required>
                </div>
                
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label>Phone Number *</label>
                    <input type="tel" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label>Workshop Title *</label>
                    <input type="text" name="workshopTitle" required>
                </div>
                
                <div class="form-group">
                    <label>Workshop Category *</label>
                    <select name="category" required>
                        <option value="">Select category</option>
                        <option>Business & Entrepreneurship</option>
                        <option>Technology & Innovation</option>
                        <option>Arts & Culture</option>
                        <option>Health & Wellness</option>
                        <option>Education & Skills</option>
                        <option>Pan-African Studies</option>
                        <option>Financial Literacy</option>
                        <option>Agriculture & Food Security</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Workshop Description *</label>
                    <textarea name="description" rows="4" placeholder="Detailed description of workshop content and objectives" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Target Audience *</label>
                    <textarea name="audience" rows="2" placeholder="Who should attend this workshop?" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Duration *</label>
                    <select name="duration" required>
                        <option value="">Select duration</option>
                        <option>2 hours</option>
                        <option>Half day (4 hours)</option>
                        <option>Full day (8 hours)</option>
                        <option>2 days</option>
                        <option>3-5 days</option>
                        <option>1 week</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Your Expertise/Qualifications *</label>
                    <textarea name="expertise" rows="3" placeholder="Your background and qualifications for hosting this workshop" required></textarea>
                </div>
                
                <button type="submit" class="btn">Submit Workshop Proposal</button>
            </form>
        </div>
    `;
}

// ===== RESEARCH SERVICES MODAL =====
function createResearchModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üî¨ Research Services</h2>
            
            <form onsubmit="processResearchRequest(event)">
                <div class="form-group">
                    <label>Organization/Individual Name *</label>
                    <input type="text" name="clientName" required>
                </div>
                
                <div class="form-group">
                    <label>Contact Email *</label>
                    <input type="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label>Phone Number *</label>
                    <input type="tel" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label>Research Type *</label>
                    <select name="researchType" required>
                        <option value="">Select research type</option>
                        <option>Market Research</option>
                        <option>Academic Research</option>
                        <option>Policy Research</option>
                        <option>Social Impact Assessment</option>
                        <option>Business Intelligence</option>
                        <option>Pan-African Studies</option>
                        <option>Economic Analysis</option>
                        <option>Cultural Research</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Research Topic/Subject *</label>
                    <input type="text" name="topic" placeholder="Brief description of research topic" required>
                </div>
                
                <div class="form-group">
                    <label>Detailed Research Requirements *</label>
                    <textarea name="requirements" rows="4" placeholder="Specific research questions, methodology preferences, deliverables expected" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Timeline *</label>
                    <select name="timeline" required>
                        <option value="">Select timeline</option>
                        <option>1-2 weeks</option>
                        <option>1 month</option>
                        <option>2-3 months</option>
                        <option>3-6 months</option>
                        <option>6+ months</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Budget Range (USD)</label>
                    <select name="budget">
                        <option value="">Select budget range</option>
                        <option>Under $1,000</option>
                        <option>$1,000 - $5,000</option>
                        <option>$5,000 - $10,000</option>
                        <option>$10,000 - $25,000</option>
                        <option>$25,000+</option>
                        <option>To be discussed</option>
                    </select>
                </div>
                
                <button type="submit" class="btn">Submit Research Request</button>
            </form>
        </div>
    `;
}

// ===== INSERT JOB MODAL =====
function createInsertJobModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üìù Post a Job Opening</h2>
            
            <form onsubmit="processJobPosting(event)">
                <div class="form-group">
                    <label>Company/Organization Name *</label>
                    <input type="text" name="companyName" required>
                </div>
                
                <div class="form-group">
                    <label>Contact Email *</label>
                    <input type="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label>Contact Phone *</label>
                    <input type="tel" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label>Job Title *</label>
                    <input type="text" name="jobTitle" required>
                </div>
                
                <div class="form-group">
                    <label>Job Category *</label>
                    <select name="jobCategory" required>
                        <option value="">Select category</option>
                        <option>IT & Digital Economy</option>
                        <option>Marketing & Advertisements</option>
                        <option>Front Desk & Data Handlers</option>
                        <option>Management</option>
                        <option>Healthcare</option>
                        <option>Sales & Customer Service</option>
                        <option>Education & Training</option>
                        <option>Engineering</option>
                        <option>Finance & Accounting</option>
                        <option>Agriculture & Food</option>
                        <option>Manufacturing</option>
                        <option>Transportation & Logistics</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Job Type *</label>
                    <select name="jobType" required>
                        <option value="">Select type</option>
                        <option>Full-time</option>
                        <option>Part-time</option>
                        <option>Contract</option>
                        <option>Freelance</option>
                        <option>Internship</option>
                        <option>Temporary</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Location *</label>
                    <input type="text" name="location" required>
                </div>
                
                <div class="form-group">
                    <label>Job Description *</label>
                    <textarea name="jobDescription" rows="4" placeholder="Detailed job description, responsibilities, requirements" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Required Qualifications *</label>
                    <textarea name="qualifications" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Experience Level *</label>
                    <select name="experienceLevel" required>
                        <option value="">Select level</option>
                        <option>Entry Level (0-2 years)</option>
                        <option>Mid Level (2-5 years)</option>
                        <option>Senior Level (5-10 years)</option>
                        <option>Executive Level (10+ years)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Salary Range (Optional)</label>
                    <input type="text" name="salary" placeholder="e.g., KSH 50,000 - 80,000">
                </div>
                
                <button type="submit" class="btn">Post Job Opening</button>
            </form>
        </div>
    `;
}

// ===== JOB SEARCH MODAL =====
function createRetrieveJobModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üîç Job Search Portal</h2>
            
            <form onsubmit="processJobSearch(event)">
                <div class="form-group">
                    <label>Your Name *</label>
                    <input type="text" name="searcherName" required>
                </div>
                
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label>Job Category</label>
                    <select name="category">
                        <option value="">All categories</option>
                        <option>IT & Digital Economy</option>
                        <option>Marketing & Advertisements</option>
                        <option>Front Desk & Data Handlers</option>
                        <option>Management</option>
                        <option>Healthcare</option>
                        <option>Sales & Customer Service</option>
                        <option>Education & Training</option>
                        <option>Engineering</option>
                        <option>Finance & Accounting</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Preferred Location</label>
                    <input type="text" name="location" placeholder="City, Country or Remote">
                </div>
                
                <div class="form-group">
                    <label>Experience Level</label>
                    <select name="experience">
                        <option value="">Any level</option>
                        <option>Entry Level</option>
                        <option>Mid Level</option>
                        <option>Senior Level</option>
                        <option>Executive Level</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Job Type</label>
                    <select name="jobType">
                        <option value="">Any type</option>
                        <option>Full-time</option>
                        <option>Part-time</option>
                        <option>Contract</option>
                        <option>Freelance</option>
                        <option>Internship</option>
                    </select>
                </div>
                
                <button type="submit" class="btn">Search Jobs</button>
            </form>
        </div>
    `;
}

// ===== AVAILABLE JOBS MODAL =====
function createAvailableJobsModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üìã Available Jobs</h2>
            <p>Browse current job opportunities</p>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h3>Sample Job Listings:</h3>
                <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px;">
                    <h4>Software Developer - Tech Startup</h4>
                    <p><strong>Location:</strong> Nairobi, Kenya</p>
                    <p><strong>Requirements:</strong> 2+ years experience, JavaScript, React</p>
                    <button class="btn" onclick="openModal('applyJob')">Apply Now</button>
                </div>
                <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px;">
                    <h4>Marketing Manager - NGO</h4>
                    <p><strong>Location:</strong> Lagos, Nigeria</p>
                    <p><strong>Requirements:</strong> Marketing degree, 3+ years experience</p>
                    <button class="btn" onclick="openModal('applyJob')">Apply Now</button>
                </div>
            </div>
            
            <div style="text-align: center;">
                <p>More jobs available to registered members</p>
                <button class="btn" onclick="openModal('taskRegistration')">Join TASK Team to Access All Jobs</button>
            </div>
        </div>
    `;
}

// ===== APPLY FOR JOB MODAL =====
function createApplyJobModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üìã Job Application</h2>
            
            <form onsubmit="processJobApplication(event)">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" name="fullName" required>
                </div>
                
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label>Phone *</label>
                    <input type="tel" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label>Location/Address *</label>
                    <input type="text" name="location" required>
                </div>
                
                <div class="form-group">
                    <label>Position Applying For *</label>
                    <input type="text" name="position" required>
                </div>
                
                <div class="form-group">
                    <label>Job Category *</label>
                    <select name="jobCategory" required>
                        <option value="">Select category</option>
                        <option>IT & Digital Economy</option>
                        <option>Marketing & Advertisements</option>
                        <option>Front Desk & Data Handlers</option>
                        <option>Management</option>
                        <option>Healthcare</option>
                        <option>Sales</option>
                        <option>Education</option>
                        <option>Engineering</option>
                        <option>Finance</option>
                        <option>Agriculture</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Experience Level *</label>
                    <select name="experience" required>
                        <option value="">Select level</option>
                        <option>Entry Level (0-2 years)</option>
                        <option>Mid Level (2-5 years)</option>
                        <option>Senior Level (5-10 years)</option>
                        <option>Executive Level (10+ years)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Key Skills *</label>
                    <textarea name="skills" rows="3" placeholder="List your relevant skills" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Work Experience *</label>
                    <textarea name="workExperience" rows="4" placeholder="Describe your relevant work experience" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Education *</label>
                    <textarea name="education" rows="3" placeholder="Your educational background" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Why are you interested in this position? *</label>
                    <textarea name="interest" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Availability *</label>
                    <select name="availability" required>
                        <option value="">Select availability</option>
                        <option>Immediately</option>
                        <option>Within 2 weeks</option>
                        <option>Within 1 month</option>
                        <option>To be discussed</option>
                    </select>
                </div>
                
                <button type="submit" class="btn">Submit Application</button>
            </form>
        </div>
    `;
}

// ===== COMMUNITY PROGRAMS MODAL =====
function createCommunityModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>ü§ù Join Community Programs</h2>
            
            <form onsubmit="processCommunityRegistration(event)">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" name="fullName" required>
                </div>
                
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label>Phone *</label>
                    <input type="tel" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label>Location/Community *</label>
                    <input type="text" name="location" required>
                </div>
                
                <div class="form-group">
                    <label>Program Interest (Select all that apply) *</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                        <label><input type="checkbox" name="programs" value="Agriculture"> Agriculture</label>
                        <label><input type="checkbox" name="programs" value="Climate"> Climate Action</label>
                        <label><input type="checkbox" name="programs" value="Environment"> Environment</label>
                        <label><input type="checkbox" name="programs" value="Water"> Water & Sanitation</label>
                        <label><input type="checkbox" name="programs" value="Education"> Education</label>
                        <label><input type="checkbox" name="programs" value="ChildCare"> Child Care</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Role Preference *</label>
                    <select name="role" required>
                        <option value="">How would you like to contribute?</option>
                        <option>Volunteer Worker</option>
                        <option>Community Organizer</option>
                        <option>Technical Advisor</option>
                        <option>Funding/Donor</option>
                        <option>Program Coordinator</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Available Time Commitment</label>
                    <select name="timeCommitment">
                        <option>2-4 hours per week</option>
                        <option>5-10 hours per week</option>
                        <option>10-20 hours per week</option>
                        <option>Full-time volunteer</option>
                        <option>Project-based</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Your Skills/Experience</label>
                    <textarea name="skills" rows="3" placeholder="What skills or experience can you contribute?"></textarea>
                </div>
                
                <button type="submit" class="btn">Join Community Programs</button>
            </form>
        </div>
    `;
}

// ===== CORPORATE REGISTRATION MODAL =====
function createCorporateModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üè¢ Corporate Registration - Valenta Holdings</h2>
            
            <div class="payment-info">
                <h3>Corporate Registration Package</h3>
                <p>Comprehensive business registration and setup services</p>
            </div>
            
            <form onsubmit="processCorporateRegistration(event)">
                <div class="form-group">
                    <label>Company Name *</label>
                    <input type="text" name="companyName" required>
                </div>
                
                <div class="form-group">
                    <label>Business Type *</label>
                    <select name="businessType" required>
                        <option value="">Select business type</option>
                        <option>Limited Company</option>
                        <option>Partnership</option>
                        <option>Sole Proprietorship</option>
                        <option>NGO/Foundation</option>
                        <option>Cooperative</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Industry Sector *</label>
                    <select name="sector" required>
                        <option value="">Select sector</option>
                        <option>Technology & Innovation</option>
                        <option>Agriculture & Food</option>
                        <option>Healthcare & Pharmaceuticals</option>
                        <option>Education & Training</option>
                        <option>Finance & Banking</option>
                        <option>Manufacturing</option>
                        <option>Retail & Commerce</option>
                        <option>Energy & Environment</option>
                        <option>Tourism & Hospitality</option>
                        <option>Media & Entertainment</option>
                        <option>Construction & Real Estate</option>
                        <option>Transportation & Logistics</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Training for Trade Program</label>
                    <select name="trainingTrade">
                        <option value="">Not applicable</option>
                        <option>Yes - Include training for employees</option>
                        <option>Yes - Include skills development</option>
                        <option>Yes - Include professional certification</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Contact Person *</label>
                    <input type="text" name="contactName" required>
                </div>
                
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label>Phone Number *</label>
                    <input type="tel" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label>Country *</label>
                    <input type="text" name="country" required>
                </div>
                
                <div class="form-group">
                    <label>Business Address *</label>
                    <textarea name="address" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Business Description *</label>
                    <textarea name="businessDescription" rows="4" placeholder="Describe your business activities, products, services" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Expected Initial Investment (USD)</label>
                    <select name="investment">
                        <option value="">Select range</option>
                        <option>Under $10,000</option>
                        <option>$10,000 - $50,000</option>
                        <option>$50,000 - $100,000</option>
                        <option>$100,000 - $500,000</option>
                        <option>$500,000 - $1,000,000</option>
                        <option>Over $1,000,000</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Expected Number of Employees</label>
                    <select name="employees">
                        <option value="">Select range</option>
                        <option>1-5 employees</option>
                        <option>6-20 employees</option>
                        <option>21-50 employees</option>
                        <option>51-100 employees</option>
                        <option>100+ employees</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Pan-African Vision Alignment</label>
                    <textarea name="alignment" rows="3" placeholder="How does your business align with Pan-African development goals?"></textarea>
                </div>
                
                <button type="submit" class="btn">Submit Corporate Registration</button>
            </form>
        </div>
    `;
}

// ===== PAR SIRAI MODAL =====
function createParSiraiModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üèõÔ∏è Par Sirai Center</h2>
            <p>Center for Knowledge and Spirituality within AUFFI</p>
            
            <div style="padding: 20px;">
                <div style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4); color: white; padding: 30px; border-radius: 15px; margin: 20px 0; text-align: center;">
                    <h3>Welcome to Par Sirai Center</h3>
                    <p>The spiritual and intellectual heart of Pan-African awakening</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px;">
                        <h4>üìö Knowledge Repository</h4>
                        <p>Access to Pan-African history, philosophy, and wisdom traditions</p>
                    </div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px;">
                        <h4>üßò Spiritual Practices</h4>
                        <p>Meditation, prayer, and consciousness development programs</p>
                    </div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px;">
                        <h4>üë• Community Circles</h4>
                        <p>Discussion groups and learning circles for spiritual growth</p>
                    </div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px;">
                        <h4>üåü Awakening Programs</h4>
                        <p>Structured programs for social and spiritual consciousness</p>
                    </div>
                </div>
                
                <form onsubmit="processParSiraiRegistration(event)" style="margin-top: 30px;">
                    <div class="form-group">
                        <label>Name *</label>
                        <input type="text" name="name" required>
                    </div>
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label>Interest Area *</label>
                        <select name="interest" required>
                            <option value="">Select area</option>
                            <option>Pan-African Book of Oloo</option>
                            <option>Spiritual Life of Oloo</option>
                            <option>Philosophy & Wisdom of Oloo</option>
                            <option>African Community Leadership</option>
                            <option>African Cultural Heritage</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Join Par Sirai Center</button>
                </form>
            </div>
        </div>
    `;
}

// ===== TRUST GRAPH MODAL =====
function createTrustGraphModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üîó Trust Graph Ledger</h2>
            <div style="padding: 20px; text-align: center;">
                <div style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 30px; border-radius: 15px; margin: 20px 0;">
                    <h3>Blockchain-Based Trust System</h3>
                    <p>Building transparent and verifiable trust networks across Africa</p>
                </div>
                <p style="margin: 20px 0;">The Trust Graph Ledger is currently in development. This system will enable:</p>
                <ul style="text-align: left; max-width: 500px; margin: 0 auto;">
                    <li>Verified identity and reputation tracking</li>
                    <li>Transparent transaction histories</li>
                    <li>Community-validated trust scores</li>
                    <li>Decentralized governance mechanisms</li>
                </ul>
            </div>
            
            <form onsubmit="processTrustGraphAccess(event)" id="trustGraphForm">
                <div class="form-group">
                    <label>Organization Name *</label>
                    <input type="text" name="organization" required>
                </div>
                <div class="form-group">
                    <label>Contact Email *</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Access Level *</label>
                    <select name="accessLevel" required>
                        <option value="">Select level</option>
                        <option value="Basic">Basic Access</option>
                        <option value="Business">Corporate Access</option>
                        <option value="Enterprise">Sovereign Access</option>
                    </select>
                </div>
                <button type="submit" class="btn">Request Access</button>
            </form>
        </div>
    `;
}

// ===== FOUNDATION MODAL =====
function createFoundationModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üåç TAU Africa Foundation</h2>
            <div style="padding: 20px;">
                <div style="background: linear-gradient(45deg, #2ecc71, #27ae60); color: white; padding: 30px; border-radius: 15px; margin: 20px 0; text-align: center;">
                    <h3>Foundation for Sustainable Development</h3>
                    <p>Empowering African communities through strategic partnerships</p>
                </div>
                
                <form onsubmit="processFoundationInquiry(event)">
                    <div class="form-group">
                        <label>Organization/Individual Name *</label>
                        <input type="text" name="name" required>
                    </div>
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label>Inquiry Type *</label>
                        <select name="inquiryType" required>
                            <option value="">Select inquiry type</option>
                            <option>Grant Application</option>
                            <option>Partnership Opportunity</option>
                            <option>Donation/Contribution</option>
                            <option>Program Collaboration</option>
                            <option>General Information</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Message *</label>
                        <textarea name="message" rows="4" required></textarea>
                    </div>
                    <button type="submit" class="btn">Submit Foundation Inquiry</button>
                </form>
            </div>
        </div>
    `;
}

// ===== HOLDINGS MODAL =====
function createHoldingsModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üè¢ Company Holdings</h2>
            <div style="padding: 20px;">
                <div style="background: linear-gradient(45deg, #9b59b6, #8e44ad); color: white; padding: 30px; border-radius: 15px; margin: 20px 0; text-align: center;">
                    <h3>Valenta Holdings Portfolio</h3>
                    <p>Strategic investments in African development</p>
                </div>
                
                <div style="display: grid; gap: 15px; margin: 20px 0;">
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 10px;">
                        <h4>Kabiru Digital Currency</h4>
                        <p>Revolutionary blockchain-based currency for African trade</p>
                    </div>
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 10px;">
                        <h4>AUFFI Community Network</h4>
                        <p>Pan-African social and spiritual unity platform</p>
                    </div>
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 10px;">
                        <h4>Agricultural Innovation Centers</h4>
                        <p>Modern farming techniques and food security</p>
                    </div>
                </div>
                
                <form onsubmit="processHoldingsInquiry(event)">
                    <div class="form-group">
                        <label>Name/Organization *</label>
                        <input type="text" name="name" required>
                    </div>
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label>Interest *</label>
                        <select name="interest" required>
                            <option value="">Select interest</option>
                            <option>Investment Opportunities</option>
                            <option>Partnership Proposals</option>
                            <option>Acquisition Inquiries</option>
                            <option>Joint Ventures</option>
                            <option>General Information</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Message *</label>
                        <textarea name="message" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="btn">Submit Holdings Inquiry</button>
                </form>
            </div>
        </div>
    `;
}

// ===== FORUM MODAL =====
function createForumModal() {
    return `
        <div class="modal-content">
            <span class="close" onclick="closeAllModals()">&times;</span>
            <h2>üí¨ Member Forum</h2>
            <p>Connect with fellow TAU Africa members</p>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h3>Forum Features:</h3>
                <ul style="text-align: left;">
                    <li>Discussion boards by topic</li>
                    <li>Job sharing and networking</li>
                    <li>Training materials access</li>
                    <li>Voice calls and messaging</li>
                    <li>Business collaboration</li>
                </ul>
                
                <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px;">
                    <strong>Notice:</strong> Forum access requires active TASK or TALK membership
                </div>
            </div>
            
            <div style="text-align: center;">
                <button class="btn" onclick="openModal('taskRegistration')">Join TASK Team</button>
                <button class="btn" onclick="openModal('talkRegistration')">Join TALK Team</button>
                <button class="btn" onclick="showMemberLogin()">Member Login</button>
            </div>
        </div>
    `;
}
</script>
    <script>
   // =====================================================
// TAU AFRICA DATABASE CONNECTION LAYER - COMPLETE
// =====================================================

(function() {
    'use strict';

    // Database Configuration
    const DB_CONFIG = {
        dbKey: 'tauAfricaDB',
        credentialsKey: 'tauCredentials',
        referralsKey: 'tauReferrals',
        jobsPortalKey: 'tauJobsPortal',
        sessionKey: 'tauCurrentUser',
        activitiesKey: 'tauActivities',
        tasksKey: 'tauTasks',
        forumsKey: 'tauForums'
    };

    // Member ID & Referral Code Generation
    function generateMemberID(team, referralCode = null) {
        const prefix = team === 'TASK' ? 'TSK' : team === 'TALK' ? 'TLK' : 'JOB';
        const timestamp = Date.now().toString().slice(-6);
        const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
        const id = `${prefix}-${timestamp}-${random}`;
        
        if (referralCode) {
            trackReferral(referralCode, id);
        }
        
        return id;
    }

    function generateReferralCode(memberId) {
        return btoa(memberId).substring(0, 8).toUpperCase();
    }

    // Referral Tracking with iKbp Rewards
    function trackReferral(referralCode, newMemberId) {
        try {
            const referrals = JSON.parse(localStorage.getItem(DB_CONFIG.referralsKey) || '{}');
            const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
            const referrer = members.find(m => m.referralCode === referralCode);
            
            if (referrer) {
                if (!referrals[referrer.id]) {
                    referrals[referrer.id] = {
                        memberId: referrer.id,
                        referredMembers: [],
                        totalEarnings: 0
                    };
                }
                
                const earnings = 500;
                referrals[referrer.id].referredMembers.push({
                    memberId: newMemberId,
                    date: new Date().toISOString(),
                    earnings: earnings
                });
                referrals[referrer.id].totalEarnings += earnings;
                
                localStorage.setItem(DB_CONFIG.referralsKey, JSON.stringify(referrals));
                updateMemberBalance(referrer.id, earnings);
                sendReferralNotification(referrer, earnings);
                
                console.log(`‚úÖ Referral tracked: ${referrer.id} earned ${earnings} iKbp`);
            }
        } catch (error) {
            console.error('Referral tracking error:', error);
        }
    }

    function updateMemberBalance(memberId, amount) {
        try {
            const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
            const memberIndex = members.findIndex(m => m.id === memberId);
            
            if (memberIndex !== -1) {
                members[memberIndex].iKbpBalance = (members[memberIndex].iKbpBalance || 0) + amount;
                localStorage.setItem(DB_CONFIG.dbKey, JSON.stringify(members));
                return true;
            }
            return false;
        } catch (error) {
            console.error('Balance update error:', error);
            return false;
        }
    }

    function sendReferralNotification(referrer, earnings) {
        const templateParams = {
            to_email: referrer.email,
            to_name: referrer.fullName,
            subject: 'üéâ Referral Bonus Earned - TAU Africa',
            message: `Congratulations ${referrer.fullName}!\n\nYou've earned ${earnings} iKbp (${earnings/10} KSH) from your referral.\n\nTotal Referral Earnings: ${getReferralEarnings(referrer.id)} iKbp\nCurrent Balance: ${referrer.iKbpBalance || 0} iKbp\n\nKeep sharing your referral code: ${referrer.referralCode}\n\nThank you for building TAU Africa!`,
            from_name: 'TAU Africa',
            from_email: 'grouptauafrica@gmail.com',
            phone: referrer.phone || 'Not provided',
            location: referrer.location || 'Not provided'
        };
        
        if (typeof emailjs !== 'undefined') {
            emailjs.send('service_xfira7g', 'template_bqxztig', templateParams)
                .then(() => console.log('‚úÖ Referral notification sent'))
                .catch(err => console.error('Referral email error:', err));
        }
    }

    function getReferralEarnings(memberId) {
        const referrals = JSON.parse(localStorage.getItem(DB_CONFIG.referralsKey) || '{}');
        return referrals[memberId]?.totalEarnings || 0;
    }

    function checkReferralCode() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('ref');
    }

    // Enhanced syncToDatabase Function
    function syncToDatabase(formData, team, referralCode = null) {
        try {
            const existingMembers = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
            
            const memberId = generateMemberID(team, referralCode);
            const memberReferralCode = generateReferralCode(memberId);
            
            const member = {
                id: memberId,
                referralCode: memberReferralCode,
                team: team,
                fullName: formData.fullName || formData.name,
                email: formData.email,
                phone: formData.phone,
                location: formData.location,
                paymentStatus: 'Paid',
                dateJoined: new Date().toISOString().split('T')[0],
                status: 'Active',
                fee: team === 'TASK' ? 500 : team === 'TALK' ? 2000 : 1500,
                accountCreated: new Date().toISOString(),
                lastLogin: null,
                activities: [],
                tasks: [],
                jobs: [],
                forumPosts: [],
                iKbpBalance: 0,
                referredBy: referralCode || null
            };
            
            Object.keys(formData).forEach(key => {
                if (!member[key]) {
                    member[key] = formData[key];
                }
            });
            
            existingMembers.push(member);
            localStorage.setItem(DB_CONFIG.dbKey, JSON.stringify(existingMembers));
            storeMemberCredentials(member);
            window.dispatchEvent(new CustomEvent('tauMemberAdded', { detail: member }));
            
            console.log('‚úÖ Member synced to database:', memberId);
            return { success: true, memberId, member };
            
        } catch (error) {
            console.error('‚ùå Database sync error:', error);
            return { success: false, error: error.message };
        }
    }

    function storeMemberCredentials(member) {
        const credentials = JSON.parse(localStorage.getItem(DB_CONFIG.credentialsKey) || '{}');
        credentials[member.id] = {
            email: member.email,
            phone: member.phone.slice(-4),
            fullName: member.fullName
        };
        localStorage.setItem(DB_CONFIG.credentialsKey, JSON.stringify(credentials));
    }

    // Authentication
    function authenticateMember(identifier, phoneLastFour) {
        try {
            const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
            const member = members.find(m => 
                (m.id === identifier || m.email === identifier) && 
                m.phone.slice(-4) === phoneLastFour
            );
            
            if (member) {
                member.lastLogin = new Date().toISOString();
                const memberIndex = members.findIndex(m => m.id === member.id);
                members[memberIndex] = member;
                localStorage.setItem(DB_CONFIG.dbKey, JSON.stringify(members));
                sessionStorage.setItem(DB_CONFIG.sessionKey, JSON.stringify(member));
                return { success: true, member };
            }
            
            return { success: false, error: 'Invalid credentials' };
        } catch (error) {
            return { success: false, error: error.message };
        }
    }

    function getCurrentMember() {
        const sessionData = sessionStorage.getItem(DB_CONFIG.sessionKey);
        if (sessionData) {
            const member = JSON.parse(sessionData);
            const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
            const freshMember = members.find(m => m.id === member.id);
            if (freshMember) {
                sessionStorage.setItem(DB_CONFIG.sessionKey, JSON.stringify(freshMember));
                return freshMember;
            }
        }
        return null;
    }

    function logoutMember() {
        sessionStorage.removeItem(DB_CONFIG.sessionKey);
        return true;
    }

    // Activity Management
    function addMemberActivity(memberId, activity) {
        try {
            const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
            const memberIndex = members.findIndex(m => m.id === memberId);
            
            if (memberIndex !== -1) {
                const activityRecord = {
                    id: `ACT-${Date.now()}`,
                    type: activity.type,
                    title: activity.title,
                    description: activity.description,
                    dateAdded: new Date().toISOString(),
                    status: 'Active',
                    iKbpReward: activity.reward || 100
                };
                
                members[memberIndex].activities.push(activityRecord);
                members[memberIndex].iKbpBalance += activityRecord.iKbpReward;
                localStorage.setItem(DB_CONFIG.dbKey, JSON.stringify(members));
                
                return { 
                    success: true, 
                    activity: activityRecord,
                    newBalance: members[memberIndex].iKbpBalance,
                    earned: activityRecord.iKbpReward
                };
            }
            
            return { success: false, error: 'Member not found' };
        } catch (error) {
            return { success: false, error: error.message };
        }
    }

    // Task Management
    function addMemberTask(memberId, task) {
        try {
            const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
            const memberIndex = members.findIndex(m => m.id === memberId);
            
            if (memberIndex !== -1) {
                const taskRecord = {
                    id: `TSK-${Date.now()}`,
                    title: task.title,
                    description: task.description,
                    category: task.category,
                    dateAssigned: new Date().toISOString(),
                    dueDate: task.dueDate || null,
                    status: 'Assigned',
                    iKbpReward: task.reward || 200,
                    completedDate: null
                };
                
                members[memberIndex].tasks.push(taskRecord);
                localStorage.setItem(DB_CONFIG.dbKey, JSON.stringify(members));
                return { success: true, task: taskRecord };
            }
            
            return { success: false, error: 'Member not found' };
        } catch (error) {
            return { success: false, error: error.message };
        }
    }

    function completeTask(memberId, taskId) {
        try {
            const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
            const memberIndex = members.findIndex(m => m.id === memberId);
            
            if (memberIndex !== -1) {
                const task = members[memberIndex].tasks.find(t => t.id === taskId);
                
                if (task && task.status !== 'Completed') {
                    task.status = 'Completed';
                    task.completedDate = new Date().toISOString();
                    members[memberIndex].iKbpBalance += task.iKbpReward;
                    localStorage.setItem(DB_CONFIG.dbKey, JSON.stringify(members));
                    
                    return { 
                        success: true, 
                        task, 
                        newBalance: members[memberIndex].iKbpBalance,
                        earned: task.iKbpReward
                    };
                }
            }
            
            return { success: false, error: 'Task not found or already completed' };
        } catch (error) {
            return { success: false, error: error.message };
        }
    }

    // Forum Management
    function createForumPost(memberId, post) {
        try {
            const forums = JSON.parse(localStorage.getItem(DB_CONFIG.forumsKey) || '[]');
            const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
            const member = members.find(m => m.id === memberId);
            
            if (member) {
                const forumPost = {
                    id: `POST-${Date.now()}`,
                    authorId: memberId,
                    authorName: member.fullName,
                    authorTeam: member.team,
                    title: post.title,
                    content: post.content,
                    category: post.category,
                    datePosted: new Date().toISOString(),
                    likes: 0,
                    comments: [],
                    iKbpEarned: 50
                };
                
                forums.push(forumPost);
                localStorage.setItem(DB_CONFIG.forumsKey, JSON.stringify(forums));
                updateMemberBalance(memberId, 50);
                
                return { success: true, post: forumPost, earned: 50 };
            }
            
            return { success: false, error: 'Member not found' };
        } catch (error) {
            return { success: false, error: error.message };
        }
    }

    function getForumPosts(filters = {}) {
        try {
            let posts = JSON.parse(localStorage.getItem(DB_CONFIG.forumsKey) || '[]');
            
            if (filters.category) {
                posts = posts.filter(p => p.category === filters.category);
            }
            if (filters.authorId) {
                posts = posts.filter(p => p.authorId === filters.authorId);
            }
            
            posts.sort((a, b) => new Date(b.datePosted) - new Date(a.datePosted));
            return { success: true, posts };
        } catch (error) {
            return { success: false, error: error.message };
        }
    }

    function addForumComment(postId, memberId, comment) {
        try {
            const forums = JSON.parse(localStorage.getItem(DB_CONFIG.forumsKey) || '[]');
            const members = JSON.parse(localStorage.getItem(DB_CONFIG.dbKey) || '[]');
            const member = members.find(m => m.id === memberId);
            const post = forums.find(p => p.id === postId);
            
            if (post && member) {
                const commentObj = {
                    id: `CMT-${Date.now()}`,
                    authorId: memberId,
                    authorName: member.fullName,
                    content: comment,
                    datePosted: new Date().toISOString()
                };
                
                post.comments.push(commentObj);
                localStorage.setItem(DB_CONFIG.forumsKey, JSON.stringify(forums));
                updateMemberBalance(memberId, 10);
                
                return { success: true, comment: commentObj, earned: 10 };
            }
            
            return { success: false, error: 'Post or member not found' };
        } catch (error) {
            return { success: false, error: error.message };
        }
    }

        // Welcome Email
    function sendWelcomeEmail(member) {
        const templateParams = {
            to_email:formData.email,
            to_name: formData.fullName,
            subject: 'üéâ Welcome to TAU Africa',
            message: `Welcome ${member.fullName}!\n\nMember ID: ${member.id}\nReferral Code: ${member.referralCode}\n\nLogin: ${window.location.origin}\n\nEarn iKbp by:\n- Referring members: 500 iKbp\n- Completing tasks: 100-500 iKbp\n- Forum posts: 50 iKbp\n\nBalance: ${member.iKbpBalance} iKbp`,
            from_name: 'TAU Africa',
            from_email: 'grouptauafrica@gmail.com',
            phone: formData.phone,
            location: formData.location
        };
        
        return emailjs.send('service_xfira7g', 'template_bqxztig', templateParams);
    }

    // Override Success Handlers
    window.processTaskSuccess = function(formData) {
        const referralCode = checkReferralCode();
        const syncResult = syncToDatabase(formData, 'TASK', referralCode);
        
        if (syncResult.success) {
            const member = syncResult.member;
            sendWelcomeEmail(member);
            if (typeof sendEmailToOrganization === 'function') {
                sendEmailToOrganization(formData, 'NEW TASK REGISTRATION');
            }
            if (typeof showNotification === 'function') {
                showNotification(`‚úÖ Registration Complete!\nMember ID: ${member.id}\nReferral Code: ${member.referralCode}`, 'success');
            }
            setTimeout(() => {
                if (typeof showSuccessModal === 'function') showSuccessModal(member);
                if (typeof closeAllModals === 'function') closeAllModals();
            }, 2000);
        }
    };

    window.processTalkSuccess = function(formData) {
        const referralCode = checkReferralCode();
        const syncResult = syncToDatabase(formData, 'TALK', referralCode);
        
        if (syncResult.success) {
            const member = syncResult.member;
            sendWelcomeEmail(member);
            if (typeof sendEmailToOrganization === 'function') {
                sendEmailToOrganization(formData, 'NEW TALK REGISTRATION');
            }
            if (typeof showNotification === 'function') {
                showNotification(`‚úÖ Registration Complete!\nMember ID: ${member.id}\nReferral Code: ${member.referralCode}`, 'success');
            }
            setTimeout(() => {
                if (typeof showSuccessModal === 'function') showSuccessModal(member);
                if (typeof closeAllModals === 'function') closeAllModals();
            }, 2000);
        }
    };

    window.processJobCreationSuccess = function(formData) {
        const referralCode = checkReferralCode();
        const syncResult = syncToDatabase(formData, 'JOB_CREATION', referralCode);
        
        if (syncResult.success) {
            const member = syncResult.member;
            sendWelcomeEmail(member);
            if (typeof sendEmailToOrganization === 'function') {
                sendEmailToOrganization(formData, 'JOB CREATION ENROLLMENT');
            }
            if (typeof showNotification === 'function') {
                showNotification(`‚úÖ Enrollment Complete!\nMember ID: ${member.id}`, 'success');
            }
            setTimeout(() => {
                if (typeof showSuccessModal === 'function') showSuccessModal(member);
                if (typeof closeAllModals === 'function') closeAllModals();
            }, 2000);
        }
    };

    // Export API
    window.TauDB = {
        sync: syncToDatabase,
        authenticate: authenticateMember,
        getCurrentMember: getCurrentMember,
        logout: logoutMember,
        addActivity: addMemberActivity,
        addTask: addMemberTask,
        completeTask: completeTask,
        createForumPost: createForumPost,
        getForumPosts: getForumPosts,
        addForumComment: addForumComment,
        getReferralEarnings: getReferralEarnings,
        checkReferralCode: checkReferralCode,
        sendWelcomeEmail: sendWelcomeEmail,
        updateBalance: updateMemberBalance
    };

    console.log('‚úÖ TAU DATABASE CONNECTOR LOADED');
    
    const ref = checkReferralCode();
    if (ref && typeof showNotification === 'function') {
        showNotification(`üéÅ Referral code: ${ref} - Referrer earns 500 iKbp when you register!`, 'info', 8000);
    }
})(); 
    </script>

    <script>
    // =====================================================
// TAU AFRICA UI COMPONENTS - COMPLETE
// =====================================================

(function() {
    'use strict';

    // FORUM MODAL - COMPLETE
    window.createForumModal = function() {
        const currentMember = window.TauDB.getCurrentMember();
        
        if (!currentMember) {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2 style="color: #2a5298;">üí¨ Member Forum</h2>
                    <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <p><strong>‚ö†Ô∏è Login Required</strong></p>
                        <p>Please login to access forum.</p>
                    </div>
                    <button class="btn" onclick="closeAllModals(); showRealMemberLogin()">Login</button>
                </div>
            `;
        }

        const forumResult = window.TauDB.getForumPosts();
        const posts = forumResult.success ? forumResult.posts : [];

        return `
            <div class="modal-content" style="max-width: 900px;">
                <span class="close" onclick="closeAllModals()">&times;</span>
                
                <div style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                    <h2 style="margin: 0;">üí¨ TAU Africa Forum</h2>
                    <p style="margin: 10px 0 0 0;">Welcome, ${currentMember.fullName}!</p>
                </div>

                <button class="btn" onclick="showCreatePostModal()" style="width: 100%; margin-bottom: 20px;">
                    ‚úçÔ∏è Create Post (Earn 50 iKbp)
                </button>

                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <button class="btn btn-small" onclick="filterForumPosts('all')">All Posts</button>
                    <button class="btn btn-small" onclick="filterForumPosts('General')">General</button>
                    <button class="btn btn-small" onclick="filterForumPosts('Job Sharing')">Jobs</button>
                    <button class="btn btn-small" onclick="filterForumPosts('Training')">Training</button>
                </div>

                <div id="forumPostsList" style="max-height: 500px; overflow-y: auto;">
                    ${posts.length > 0 ? posts.map(post => `
                        <div style="background: white; border: 2px solid #eee; border-radius: 10px; padding: 20px; margin-bottom: 15px;">
                            <h3 style="margin: 0 0 10px 0; color: #2a5298;">${post.title}</h3>
                            <p style="margin: 0 0 10px 0; font-size: 0.9rem; color: #666;">
                                By <strong>${post.authorName}</strong> (${post.authorTeam}) ‚Ä¢ 
                                ${new Date(post.datePosted).toLocaleDateString()}
                            </p>
                            <span style="background: #667eea; color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem;">${post.category}</span>
                            <p style="margin: 15px 0;">${post.content}</p>
                            <div style="display: flex; gap: 15px; margin-top: 10px;">
                                <button class="btn btn-small" onclick="showComments('${post.id}')">üí¨ Comments (${post.comments ? post.comments.length : 0})</button>
                                <button class="btn btn-small" onclick="addCommentToPost('${post.id}')">Add Comment (+10 iKbp)</button>
                            </div>
                            <div id="comments-${post.id}" style="display: none; margin-top: 15px;">
                                ${post.comments && post.comments.length > 0 ? post.comments.map(c => `
                                    <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin: 10px 0;">
                                        <p style="margin: 0; font-size: 0.85rem; color: #666;"><strong>${c.authorName}</strong></p>
                                        <p style="margin: 5px 0 0 0;">${c.content}</p>
                                    </div>
                                `).join('') : '<p>No comments yet.</p>'}
                            </div>
                        </div>
                    `).join('') : '<p style="text-align: center; padding: 40px;">No posts yet. Be the first!</p>'}
                </div>
            </div>
        `;
    };

    window.showCreatePostModal = function() {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'block';
        modal.innerHTML = `
            <div class="modal-content">
                <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                <h2>Create Forum Post</h2>
                
                <form onsubmit="submitForumPost(event)">
                    <div class="form-group">
                        <label>Title *</label>
                        <input type="text" name="title" required maxlength="100">
                    </div>
                    
                    <div class="form-group">
                        <label>Category *</label>
                        <select name="category" required>
                            <option value="">Select category</option>
                            <option value="General">General Discussion</option>
                            <option value="Job Sharing">Job Sharing</option>
                            <option value="Training">Training</option>
                            <option value="Business">Business</option>
                            <option value="Questions">Questions</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Content *</label>
                        <textarea name="content" rows="6" required maxlength="2000"></textarea>
                    </div>
                    
                    <button type="submit" class="btn" style="width: 100%;">Post & Earn 50 iKbp</button>
                </form>
            </div>
        `;
        document.body.appendChild(modal);
    };

    window.submitForumPost = function(event) {
        event.preventDefault();
        const currentMember = window.TauDB.getCurrentMember();
        if (!currentMember) return;
        
        const formData = new FormData(event.target);
        const result = window.TauDB.createForumPost(currentMember.id, {
            title: formData.get('title'),
            category: formData.get('category'),
            content: formData.get('content')
        });
        
        if (result.success) {
            showNotification(`‚úÖ Post created! You earned ${result.earned} iKbp!`, 'success');
            closeAllModals();
            openModal('forum');
        }
    };

    window.filterForumPosts = function(category) {
        const filters = category === 'all' ? {} : { category: category };
        const result = window.TauDB.getForumPosts(filters);
        
        if (result.success) {
            const listContainer = document.getElementById('forumPostsList');
            if (listContainer) {
                listContainer.innerHTML = result.posts.length > 0 ? result.posts.map(post => `
                    <div style="background: white; border: 2px solid #eee; border-radius: 10px; padding: 20px; margin-bottom: 15px;">
                        <h3 style="margin: 0 0 10px 0;">${post.title}</h3>
                        <p style="margin: 0 0 10px 0; font-size: 0.9rem; color: #666;">
                            By <strong>${post.authorName}</strong> ‚Ä¢ ${new Date(post.datePosted).toLocaleDateString()}
                        </p>
                        <span style="background: #667eea; color: white; padding: 5px 10px; border-radius: 5px;">${post.category}</span>
                        <p style="margin: 15px 0;">${post.content}</p>
                    </div>
                `).join('') : '<p>No posts in this category.</p>';
            }
        }
    };

    window.showComments = function(postId) {
        const div = document.getElementById(`comments-${postId}`);
        if (div) div.style.display = div.style.display === 'none' ? 'block' : 'none';
    };

    window.addCommentToPost = function(postId) {
        const currentMember = window.TauDB.getCurrentMember();
        if (!currentMember) return;
        
        const comment = prompt('Enter your comment:');
        if (comment && comment.trim()) {
            const result = window.TauDB.addForumComment(postId, currentMember.id, comment.trim());
            if (result.success) {
                showNotification(`‚úÖ Comment added! Earned ${result.earned} iKbp!`, 'success');
                openModal('forum');
            }
        }
    };

    // ACTIVITIES MODAL - COMPLETE
    window.createActivitiesModal = function() {
        const currentMember = window.TauDB.getCurrentMember();
        
        if (!currentMember) {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>üìö Activities</h2>
                    <p>Login required</p>
                    <button class="btn" onclick="closeAllModals(); showRealMemberLogin()">Login</button>
                </div>
            `;
        }

        return `
            <div class="modal-content" style="max-width: 800px;">
                <span class="close" onclick="closeAllModals()">&times;</span>
                
                <div style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4); color: white; padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                    <h2 style="margin: 0;">üìö Your Activities</h2>
                    <p style="margin: 10px 0 0 0;">Track contributions & earn iKbp!</p>
                </div>

                <button class="btn" onclick="showAddActivityModal()" style="width: 100%; margin-bottom: 20px;">
                    ‚ûï Add Activity (Earn 100 iKbp)
                </button>

                <div style="max-height: 400px; overflow-y: auto;">
                    ${currentMember.activities && currentMember.activities.length > 0 ? 
                        currentMember.activities.map(activity => `
                            <div style="background: white; border: 2px solid #eee; border-radius: 10px; padding: 20px; margin-bottom: 15px;">
                                <h3 style="margin: 0 0 10px 0;">${activity.title || activity.type}</h3>
                                <p style="margin: 0 0 10px 0;">${activity.description}</p>
                                <p style="margin: 0; font-size: 0.9rem; color: #666;">
                                    Added: ${new Date(activity.dateAdded).toLocaleDateString()} ‚Ä¢ 
                                    <strong style="color: #ffd700;">+${activity.iKbpReward} iKbp</strong>
                                </p>
                            </div>
                        `).join('')
                        : '<p style="text-align: center; padding: 40px;">No activities yet.</p>'
                    }
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 20px;">
                    <p><strong>Balance:</strong> ${currentMember.iKbpBalance} iKbp</p>
                </div>
            </div>
        `;
    };

    window.showAddActivityModal = function() {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'block';
        modal.innerHTML = `
            <div class="modal-content">
                <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                <h2>Add Activity</h2>
                
                <form onsubmit="submitActivity(event)">
                    <div class="form-group">
                        <label>Activity Type *</label>
                        <select name="type" required>
                            <option value="">Select type</option>
                            <option value="Training">Training/Workshop</option>
                            <option value="Community Service">Community Service</option>
                            <option value="Mentoring">Mentoring</option>
                            <option value="Skill Development">Skill Development</option>
                            <option value="Business">Business Activity</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Title *</label>
                        <input type="text" name="title" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Description *</label>
                        <textarea name="description" rows="4" required></textarea>
                    </div>
                    
                    <button type="submit" class="btn" style="width: 100%;">Add & Earn 100 iKbp</button>
                </form>
            </div>
        `;
        document.body.appendChild(modal);
    };

    window.submitActivity = function(event) {
        event.preventDefault();
        const currentMember = window.TauDB.getCurrentMember();
        if (!currentMember) return;
        
        const formData = new FormData(event.target);
        const result = window.TauDB.addActivity(currentMember.id, {
            type: formData.get('type'),
            title: formData.get('title'),
            description: formData.get('description'),
            reward: 100
        });
        
        if (result.success) {
            showNotification(`‚úÖ Activity added! Earned ${result.earned} iKbp! Balance: ${result.newBalance} iKbp`, 'success');
            closeAllModals();
            setTimeout(() => openModal('activities'), 500);
        }
    };

    // TASKS MODAL - COMPLETE
    window.createTasksModal = function() {
        const currentMember = window.TauDB.getCurrentMember();
        
        if (!currentMember) {
            return `
                <div class="modal-content">
                    <span class="close" onclick="closeAllModals()">&times;</span>
                    <h2>‚úÖ Tasks</h2>
                    <p>Login required</p>
                    <button class="btn" onclick="closeAllModals(); showRealMemberLogin()">Login</button>
                </div>
            `;
        }

        const activeTasks = currentMember.tasks ? currentMember.tasks.filter(t => t.status !== 'Completed') : [];
        const completedTasks = currentMember.tasks ? currentMember.tasks.filter(t => t.status === 'Completed') : [];

        return `
            <div class="modal-content" style="max-width: 900px;">
                <span class="close" onclick="closeAllModals()">&times;</span>
                
                <div style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                    <h2 style="margin: 0;">‚úÖ Your Tasks</h2>
                </div>

                <h3 style="margin-bottom: 15px;">Active Tasks (${activeTasks.length})</h3>
                <div style="max-height: 300px; overflow-y: auto; margin-bottom: 30px;">
                    ${activeTasks.length > 0 ? 
                        activeTasks.map(task => `
                            <div style="background: white; border: 2px solid #4169e1; border-radius: 10px; padding: 20px; margin-bottom: 15px;">
                                <h3 style="margin: 0 0 10px 0;">${task.title}</h3>
                                <p style="margin: 0 0 10px 0;">${task.description}</p>
                                <p style="margin: 0 0 10px 0; font-size: 0.9rem; color: #666;">
                                    Category: ${task.category} ‚Ä¢ Reward: <strong style="color: #ffd700;">${task.iKbpReward} iKbp</strong>
                                </p>
                                <button class="btn btn-success" onclick="markTaskComplete('${task.id}')">‚úì Complete Task</button>
                            </div>
                        `).join('')
                        : '<p style="text-align: center; padding: 40px;">No active tasks.</p>'
                    }
                </div>

                <h3 style="margin-bottom: 15px;">Completed Tasks (${completedTasks.length})</h3>
                <div style="max-height: 200px; overflow-y: auto;">
                    ${completedTasks.length > 0 ? 
                        completedTasks.map(task => `
                            <div style="background: #f8f9fa; border: 2px solid #2ecc71; border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                                <h4 style="margin: 0;">${task.title}</h4>
                                <p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #666;">
                                    Completed: ${new Date(task.completedDate).toLocaleDateString()} ‚Ä¢ 
                                    <strong style="color: #2ecc71;">+${task.iKbpReward} iKbp</strong>
                                </p>
                            </div>
                        `).join('')
                        : '<p>No completed tasks yet.</p>'
                    }
                </div>
            </div>
        `;
    };

    window.markTaskComplete = function(taskId) {
        const currentMember = window.TauDB.getCurrentMember();
        if (!currentMember) return;
        
        const confirmed = confirm('Mark this task as complete?');
        if (!confirmed) return;
        
        const result = window.TauDB.completeTask(currentMember.id, taskId);
        
        if (result.success) {
            showNotification(`üéâ Task completed! Earned ${result.earned} iKbp! Balance: ${result.newBalance} iKbp`, 'success');
            closeAllModals();
            setTimeout(() => openModal('tasks'), 500);
        }
    };

    // MEMBER LOGIN - COMPLETE
    window.showRealMemberLogin = function() {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'block';
        modal.innerHTML = `
            <div class="modal-content">
                <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                <h2 style="text-align: center;">üîê Member Login</h2>
                
                <form onsubmit="processRealLogin(event)" style="margin-top: 30px;">
                    <div class="form-group">
                        <label>Member ID or Email *</label>
                        <input type="text" id="loginIdentifier" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Phone (Last 4 digits) *</label>
                        <input type="text" id="loginPhone" required maxlength="4" pattern="[0-9]{4}">
                    </div>
                    
                    <button type="submit" class="btn" style="width: 100%;">Login</button>
                </form>
                
                <div style="text-align: center; margin-top: 20px;">
                    <p>No account?</p>
                    <button class="btn btn-small" onclick="closeAllModals(); openModal('taskRegistration')">Join TASK</button>
                    <button class="btn btn-small" onclick="closeAllModals(); openModal('talkRegistration')">Join TALK</button>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
    };

    window.processRealLogin = function(event) {
        event.preventDefault();
        
        const identifier = document.getElementById('loginIdentifier').value.trim();
        const phoneLastFour = document.getElementById('loginPhone').value.trim();
        
        const result = window.TauDB.authenticate(identifier, phoneLastFour);
        
        if (result.success) {
            showNotification('‚úÖ Login successful!', 'success');
            setTimeout(() => {
                closeAllModals();
                showRealMemberDashboard(result.member);
            }, 1000);
        } else {
            showNotification('‚ùå Invalid credentials', 'error');
        }
    };

    // MEMBER DASHBOARD - COMPLETE
    window.showRealMemberDashboard = function(member) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'block';
        
        const currentMember = window.TauDB.getCurrentMember() || member;
        const referralEarnings = window.TauDB.getReferralEarnings(currentMember.id);
        
        modal.innerHTML = `
            <div class="modal-content" style="max-width: 1200px;">
                <span class="close" onclick="window.TauDB.logout(); this.parentElement.parentElement.remove()">&times;</span>
                
                <div style="background: linear-gradient(45deg, #4169e1, #87ceeb); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                    <h1 style="margin: 0;">Welcome, ${currentMember.fullName}! üëã</h1>
                    <p style="margin: 10px 0 0 0;">Member ID: ${currentMember.id} ‚Ä¢ Team: ${currentMember.team}</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #ffd700; padding: 25px; border-radius: 15px; text-align: center;">
                        <h3>üí∞ Balance</h3>
                        <h1 style="font-size: 2.5rem;">${currentMember.iKbpBalance || 0}</h1>
                        <p>iKbp (${((currentMember.iKbpBalance || 0) / 10).toFixed(2)} KSH)</p>
                    </div>
                    
                    <div style="background: #667eea; color: white; padding: 25px; border-radius: 15px; text-align: center;">
                        <h3>‚úÖ Tasks</h3>
                        <h1 style="font-size: 2.5rem;">${currentMember.tasks ? currentMember.tasks.filter(t => t.status !== 'Completed').length : 0}</h1>
                        <button class="btn" onclick="closeAllModals(); openModal('tasks')" style="margin-top: 10px; width: 100%;">View</button>
                    </div>
                    
                    <div style="background: #ff6b6b; color: white; padding: 25px; border-radius: 15px; text-align: center;">
                        <h3>üìö Activities</h3>
                        <h1 style="font-size: 2.5rem;">${currentMember.activities ? currentMember.activities.length : 0}</h1>
                        <button class="btn" onclick="closeAllModals(); openModal('activities')" style="margin-top: 10px; width: 100%;">View</button>
                    </div>
                    
                    <div style="background: #2ecc71; color: white; padding: 25px; border-radius: 15px; text-align: center;">
                        <h3>üéÅ Referrals</h3>
                        <h1 style="font-size: 2.5rem;">${referralEarnings}</h1>
                        <p>iKbp Earned</p>
                    </div>
                </div>
                
                <div style="background: #667eea; color: white; padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                    <h4>üéÅ Your Referral Code</h4>
                    <h1 style="letter-spacing: 3px;">${currentMember.referralCode}</h1>
                    <button class="btn" onclick="copyReferralLink('${currentMember.referralCode}')" style="background: white; color: #667eea; width: 100%;">Copy Link</button>
                </div>
                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
    <h3>Quick Actions</h3>
    <button class="btn" onclick="openModal('forum')">üí¨ Forum</button>
    <button class="btn" onclick="openModal('activities')">üìö Activities</button>
    <button class="btn" onclick="openModal('tasks')">‚úÖ Tasks</button>
    
    // In showRealMemberDashboard() function, add this button:

<div style="margin-top: 30px; padding: 20px; background: linear-gradient(45deg, #FFD700, #FFA500); border-radius: 15px; text-align: center;">
    <h3 style="color: #333; margin-bottom: 15px;">üíé Kabiru Mining Transfer</h3>
    <div style="background: rgba(0,0,0,0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
        <div style="font-size: 24px; font-weight: bold; color: #333;">
            ${currentMember.iKbpBalance?.toLocaleString() || 0} iKbp
        </div>
        <div style="font-size: 18px; color: #333; margin-top: 5px;">
            ${(currentMember.iKbBalance || 0).toFixed(4)} iKb
        </div>
    </div>
    <button onclick="initiateKabiruWithdrawal()" class="btn" style="width: 100%; background: #333; color: #FFD700;">
        üí∏ Withdraw to Kabiru Mining
    </button>
    <p style="color: #333; font-size: 12px; margin-top: 10px;">
        Minimum: 10,000 iKbp or 0.0001 iKb
    </p>
</div>
    
    <button class="btn btn-success" onclick="window.open('https://magero1985.github.io/Kabiru-Mining-Portal-/', '_blank')">
        ‚ö° Mining
    </button>
</div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <button class="btn" onclick="closeAllModals(); openModal('forum')">üí¨ Forum</button>
                    <button class="btn" onclick="closeAllModals(); openModal('activities')">üìö Activities</button>
                    <button class="btn" onclick="closeAllModals(); openModal('tasks')">‚úÖ Tasks</button>
                    <button class="btn" onclick="window.open('https://magero1985.github.io/Kabiru-Mining-Portal-/', '_blank')">‚ö° Mining</button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
    };

    // SUCCESS MODAL - COMPLETE
    window.showSuccessModal = function(member) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'block';
        modal.innerHTML = `
            <div class="modal-content">
                <h2 style="color: #2ecc71; text-align: center;">üéâ Registration Successful!</h2>
                
                <div style="background: #4169e1; color: white; padding: 30px; border-radius: 15px; margin: 20px 0; text-align: center;">
                    <h3>Your Member ID</h3>
                    <h1 style="font-size: 2.5rem; letter-spacing: 2px;">${member.id}</h1>
                </div>
                
                <div style="background: #ffd700; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4 style="color: #333;">üí∞ Referral Code</h4>
                    <h2 style="color: #333; letter-spacing: 3px;">${member.referralCode}</h2>
                    <button class="btn" onclick="copyReferralLink('${member.referralCode}')" style="width: 100%;">Copy Link</button>
                    <p style="color: #333; margin-top: 10px;">Earn 500 iKbp per referral!</p>
                </div>
                
                <button class="btn" onclick="proceedToLogin()" style="width: 100%;">Access Account</button>
                <button class="btn" onclick="closeAllModals()" style="width: 100%; margin-top: 10px; background: #95a5a6;">Close</button>
            </div>
        `;
        document.body.appendChild(modal);
    };

    window.proceedToLogin = function() {
        closeAllModals();
        showRealMemberLogin();
    };

    // COPY REFERRAL LINK - COMPLETE
    window.copyReferralLink = function(referralCode) {
        const link = `${window.location.origin}${window.location.pathname}?ref=${referralCode}`;
        
        if (navigator.clipboard) {
            navigator.clipboard.writeText(link).then(() => {
                showNotification('‚úÖ Referral link copied! Share to earn 500 iKbp!', 'success');
            }).catch(() => {
                prompt('Copy your referral link:', link);
            });
        } else {
            prompt('Copy your referral link:', link);
        }
    };

    // OVERRIDE EXISTING FUNCTIONS
    window.showMemberLogin = function() {
        showRealMemberLogin();
    };

    const originalGetModalContent = window.getModalContent;
    window.getModalContent = function(type) {
        switch(type) {
            case 'forum':
                return createForumModal();
            case 'activities':
                return createActivitiesModal();
            case 'tasks':
                return createTasksModal();
            default:
                return originalGetModalContent ? originalGetModalContent(type) : 
                    '<div class="modal-content"><span class="close" onclick="closeAllModals()">&times;</span><h2>Coming Soon</h2></div>';
        }
    };

    console.log('‚úÖ TAU UI COMPONENTS LOADED - COMPLETE');
})();
</script>
    <script>
// ============================================
// TAU AFRICA - WELCOME BONUS SOCKET
// ============================================
(function() {
    'use strict';
    
    function initWelcomeBonusSystem() {
        const DB_KEY = 'tauAfricaDB';
        const BONUS_KEY = 'tauWelcomeBonuses';
        const BONUS_AMOUNT = 500;
        
        function checkAndAwardBonuses() {
            try {
                const members = JSON.parse(localStorage.getItem(DB_KEY) || '[]');
                const bonusTracking = JSON.parse(localStorage.getItem(BONUS_KEY) || '{}');
                let newBonuses = 0;
                
                members.forEach(member => {
                    if (!bonusTracking[member.id]) {
                        // Award welcome bonus
                        member.iKbpBalance = (member.iKbpBalance || 0) + BONUS_AMOUNT;
                        
                        // Track bonus
                        bonusTracking[member.id] = {
                            awarded: true,
                            amount: BONUS_AMOUNT,
                            date: new Date().toISOString(),
                            memberId: member.id,
                            memberName: member.fullName
                        };
                        
                        newBonuses++;
                        console.log(`‚úÖ Welcome bonus awarded: ${member.fullName} (+${BONUS_AMOUNT} iKbp)`);
                    }
                });
                
                if (newBonuses > 0) {
                    localStorage.setItem(DB_KEY, JSON.stringify(members));
                    localStorage.setItem(BONUS_KEY, JSON.stringify(bonusTracking));
                    console.log(`üéÅ Total new bonuses awarded: ${newBonuses}`);
                }
            } catch (error) {
                console.error('Welcome bonus error:', error);
            }
        }
        
        // Check every 5 seconds for new registrations
        setInterval(checkAndAwardBonuses, 5000);
        checkAndAwardBonuses(); // Initial check
        
        console.log('‚úÖ Welcome Bonus System initialized');
    }
    
    // Auto-initialize when DOM loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initWelcomeBonusSystem);
    } else {
        initWelcomeBonusSystem();
    }
})();
</script>
<script>
// ============================================
// TAU AFRICA - NOTIFICATION SOCKET
// ============================================
(function() {
    'use strict';
    
    function initNotificationSystem() {
        const NOTIF_KEY = 'tauNotifications';
        
        window.openTauNotifications = function() {
            const panel = document.getElementById('tauNotificationPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            loadNotifications();
        };
        
        function loadNotifications() {
            const currentMember = window.TauDB?.getCurrentMember();
            if (!currentMember) {
                document.getElementById('tauNotificationList').innerHTML = 
                    '<p style="text-align: center; color: #666;">Please login to view notifications</p>';
                return;
            }
            
            const allNotifications = JSON.parse(localStorage.getItem(NOTIF_KEY) || '{}');
            const memberNotifs = allNotifications[currentMember.id] || [];
            const unreadCount = memberNotifs.filter(n => !n.read).length;
            
            // Update badge
            const badge = document.getElementById('tauNotifBadge');
            if (unreadCount > 0) {
                badge.style.display = 'block';
                badge.textContent = unreadCount;
            } else {
                badge.style.display = 'none';
            }
            
            // Render notifications
            const list = document.getElementById('tauNotificationList');
            if (memberNotifs.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No notifications yet</p>';
                return;
            }
            
            list.innerHTML = memberNotifs.map(notif => `
                <div style="padding: 15px; border-bottom: 1px solid #eee; background: ${notif.read ? '#fff' : '#f0f4ff'}; border-left: 4px solid ${notif.read ? '#ddd' : '#667eea'};">
                    <strong>${notif.title}</strong>
                    <p style="margin: 5px 0; font-size: 14px; color: #666;">${notif.message}</p>
                    <small style="color: #999;">${new Date(notif.timestamp).toLocaleString()}</small>
                    ${!notif.read ? `<button onclick="markNotificationRead('${notif.id}')" style="margin-top: 8px; background: #667eea; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px;">Mark as read</button>` : ''}
                </div>
            `).join('');
        }
        
        window.markNotificationRead = function(notifId) {
            const currentMember = window.TauDB?.getCurrentMember();
            if (!currentMember) return;
            
            const allNotifications = JSON.parse(localStorage.getItem(NOTIF_KEY) || '{}');
            if (allNotifications[currentMember.id]) {
                const notif = allNotifications[currentMember.id].find(n => n.id === notifId);
                if (notif) notif.read = true;
                localStorage.setItem(NOTIF_KEY, JSON.stringify(allNotifications));
                loadNotifications();
            }
        };
        
        // Check for new notifications every 10 seconds
        setInterval(() => {
            const currentMember = window.TauDB?.getCurrentMember();
            if (currentMember) {
                const allNotifications = JSON.parse(localStorage.getItem(NOTIF_KEY) || '{}');
                const memberNotifs = allNotifications[currentMember.id] || [];
                const unreadCount = memberNotifs.filter(n => !n.read).length;
                
                const badge = document.getElementById('tauNotifBadge');
                if (unreadCount > 0) {
                    badge.style.display = 'block';
                    badge.textContent = unreadCount;
                } else {
                    badge.style.display = 'none';
                }
            }
        }, 10000);
        
        console.log('‚úÖ Notification System initialized');
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initNotificationSystem);
    } else {
        initNotificationSystem();
    }
})();
</script>
    <script>
// ============================================
// TAU AFRICA - LIMITS ENFORCEMENT SOCKET
// ============================================
(function() {
    'use strict';
    
    const EARNING_LIMITS = {
        1: 2000,
        2: 5000,
        3: 11000,
        4: 23000
    };
    
    const WITHDRAWAL_LIMITS = {
        1: 10000,  // KSH 1,000
        2: 25000,  // KSH 2,500
        3: 35000,  // KSH 3,500
        4: 50000   // KSH 5,000
    };
    
    window.TauLimits = {
        checkEarningLimit: function(memberId, amount) {
            const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
            const member = members.find(m => m.id === memberId);
            if (!member) return { allowed: false, reason: 'Member not found' };
            
            const level = member.level || 1;
            const today = new Date().toISOString().split('T')[0];
            const dailyEarnings = JSON.parse(localStorage.getItem('tauDailyEarnings') || '{}');
            
            if (!dailyEarnings[today]) dailyEarnings[today] = {};
            const todayEarned = dailyEarnings[today][memberId] || 0;
            
            const limit = EARNING_LIMITS[level];
            const remaining = limit - todayEarned;
            
            if (todayEarned + amount > limit) {
                return {
                    allowed: false,
                    reason: `Daily earning limit reached. Level ${level} max: ${limit} iKbp`,
                    earned: todayEarned,
                    limit: limit,
                    remaining: remaining
                };
            }
            
            // Update daily earnings
            dailyEarnings[today][memberId] = todayEarned + amount;
            localStorage.setItem('tauDailyEarnings', JSON.stringify(dailyEarnings));
            
            return {
                allowed: true,
                earned: todayEarned + amount,
                limit: limit,
                remaining: limit - (todayEarned + amount)
            };
        },
        
        checkWithdrawalLimit: function(memberId, amount) {
            const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
            const member = members.find(m => m.id === memberId);
            if (!member) return { allowed: false, reason: 'Member not found' };
            
            const level = member.level || 1;
            const limit = WITHDRAWAL_LIMITS[level];
            
            if (amount > limit) {
                return {
                    allowed: false,
                    reason: `Exceeds daily withdrawal limit. Level ${level} max: ${limit} iKbp (KSH ${limit/10})`,
                    limit: limit,
                    limitKsh: limit / 10
                };
            }
            
            if (amount > (member.iKbpBalance || 0)) {
                return {
                    allowed: false,
                    reason: 'Insufficient balance',
                    balance: member.iKbpBalance || 0
                };
            }
            
            return { allowed: true, limit: limit, limitKsh: limit / 10 };
        },
        
        getLimits: function(level) {
            return {
                earningLimit: EARNING_LIMITS[level] || EARNING_LIMITS[1],
                withdrawalLimit: WITHDRAWAL_LIMITS[level] || WITHDRAWAL_LIMITS[1],
                withdrawalLimitKsh: (WITHDRAWAL_LIMITS[level] || WITHDRAWAL_LIMITS[1]) / 10
            };
        }
    };
    
    console.log('‚úÖ Limits Enforcement System initialized');
})();
    </script>
    
    <script>
        // ===== ADMIN DATABASE ACCESS WITH ROLE CHECKING =====
function openAdminDatabase() {
    const currentMember = window.TauDB?.getCurrentMember();
    
    // Define admin/validator roles
    const ADMIN_ROLES = ['admin', 'validator', 'moderator'];
    const ADMIN_IDS = ['TSK-000000-001', 'TLK-000000-001']; // Add your admin Member IDs
    const ADMIN_EMAILS = [
        'admin@tauafrica.org',
        'validator@tauafrica.org',
        'grouptauafrica@gmail.com'
    ];
    
    // Check if user has admin access
    const hasAccess = currentMember && (
        ADMIN_IDS.includes(currentMember.id) ||
        ADMIN_EMAILS.includes(currentMember.email) ||
        ADMIN_ROLES.includes(currentMember.role)
    );
    
    if (hasAccess) {
        // User has admin access - open database
        const dbWindow = window.open('databse.html', '_blank', 'width=1400,height=900');
        
        if (!dbWindow) {
            showNotification('‚ö†Ô∏è Please allow popups for this site', 'error');
            // Fallback: Open in same tab
            window.location.href = 'databse.html';
        } else {
            showNotification('‚úÖ Opening Admin Dashboard...', 'success');
        }
    } else {
        // User doesn't have access - show access request
        showAdminAccessRequest();
    }
}

function showAdminAccessRequest() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        

            √ó
            
üîê Admin Access Request

            
This area is restricted to admins and validators only.


            
            

                

                    Admin Access Code
                    
Enter admin code

                

                Verify & Access
            

            
            

                Need admin access?
                
Contact: grouptauafrica@gmail.com


            

        

    `;
    document.body.appendChild(modal);
}

function requestAdminAccess(event) {
    event.preventDefault();
    const code = document.getElementById('adminAccessCode').value;
    const correctCode = 'TAU2025ADMIN'; // Change this to your secret code
    
    if (code === correctCode) {
        closeAllModals();
        const dbWindow = window.open('databse.html', '_blank', 'width=1400,height=900');
        if (!dbWindow) {
            showNotification('‚ö†Ô∏è Please allow popups', 'error');
            window.location.href = 'databse.html';
        }
        showNotification('‚úÖ Access granted!', 'success');
    } else {
        showNotification('‚ùå Invalid access code', 'error');
    }
}
    // ===== ADMIN ACCESS WITH VERIFICATION =====
function openAdminDatabase() {
    // Check if user has admin privileges
    const currentMember = window.TauDB?.getCurrentMember();
    
    // Option 1: Check by specific Member IDs
    const adminIds = ['TSK-000000-001', 'TLK-000000-001']; // Add your admin IDs
    
    // Option 2: Check by email domain
    const adminEmails = ['admin@tauafrica.org', 'validator@tauafrica.org'];
    
    if (currentMember && 
        (adminIds.includes(currentMember.id) || 
         adminEmails.includes(currentMember.email) ||
         currentMember.role === 'admin' || 
         currentMember.role === 'validator')) {
        
        const dbWindow = window.open('databse.html', '_blank', 'width=1400,height=900');
        
        if (!dbWindow) {
            showNotification('‚ö†Ô∏è Please allow popups', 'error');
            window.location.href = 'databse.html';
        } else {
            showNotification('‚úÖ Opening Admin Dashboard...', 'success');
        }
    } else {
        // Show access request form
        showAdminAccessRequest();
    }
}
window.openAdminBridge = function() {
    const currentMember = window.TauDB?.getCurrentMember();
    
    // Check admin access
    const ADMIN_IDS = ['TSK-000000-001', 'TLK-000000-001'];
    const ADMIN_EMAILS = ['admin@tauafrica.org', 'grouptauafrica@gmail.com'];
    
    const hasAccess = currentMember && (
        ADMIN_IDS.includes(currentMember.id) ||
        ADMIN_EMAILS.includes(currentMember.email) ||
        currentMember.role === 'admin'
    );
    
    if (!hasAccess) {
        const code = prompt('Enter Admin Access Code:');
        if (code !== 'TAU2025ADMIN') {
            showNotification('‚ùå Invalid access code', 'error');
            return;
        }
    }
    
    // Open bridge in new window
    const bridgeWindow = window.open(
        'https://magero1985.github.io/Tau-Africa/bridge.html',
        'tauBridge',
        'width=1200,height=800'
    );
    
    if (!bridgeWindow) {
        showNotification('‚ö†Ô∏è Please allow popups', 'error');
        // Fallback: open in same tab
        window.location.href = 'https://magero1985.github.io/Tau-Africa/bridge.html';
    } else {
        showNotification('‚úÖ Opening Admin Bridge...', 'success');
    }
};
function showAdminAccessRequest() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content">
            <span class="close" onclick="this.parentElement.parentElement.remove()">√ó</span>
            <h2>üîê Admin Access Request</h2>
            <p>This area is restricted to admins and validators only.</p>
            
            <form onsubmit="requestAdminAccess(event)">
                <div class="form-group">
                    <label>Admin Access Code</label>
                    <input type="password" id="adminAccessCode" placeholder="Enter admin code" required>
                </div>
                <button type="submit" class="btn">Verify & Access</button>
            </form>
            
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                <small>Don't have access? Contact: grouptauafrica@gmail.com</small>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function requestAdminAccess(event) {
    event.preventDefault();
    const code = document.getElementById('adminAccessCode').value;
    const correctCode = 'TAU2025ADMIN'; // Change this to your secret code
    
    if (code === correctCode) {
        closeAllModals();
        const dbWindow = window.open('databse.html', '_blank', 'width=1400,height=900');
        if (!dbWindow) window.location.href = 'databse.html';
        showNotification('‚úÖ Access granted!', 'success');
    } else {
        showNotification('‚ùå Invalid access code', 'error');
    }
}
    </script>
    <script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/Tau-Africa/service-worker.js')
      .then(reg => console.log('‚úÖ PWA registered'))
      .catch(err => console.log('‚ùå PWA error:', err));
  });
}
</script>
    <script>
// ============================================
// UNIVERSAL REAL-TIME SYNC SOCKET
// Add to: Main App, Database, and Bridge
// ============================================
(function() {
    'use strict';
    
    const SYNC_INTERVAL = 2000; // Check every 2 seconds
    const STORAGE_KEYS = {
        members: 'tauAfricaDB',
        tasks: 'tauTasks',
        activities: 'tauActivities',
        values: 'tauValues',
        validations: 'tauPendingValidations',
        notifications: 'tauNotifications',
        codes: 'tauValidatorCodes'
    };
    
    // Track last known state
    let lastState = {};
    
    function initSync() {
        // Initialize last state
        Object.keys(STORAGE_KEYS).forEach(key => {
            const data = localStorage.getItem(STORAGE_KEYS[key]) || '[]';
            lastState[key] = data;
        });
        
        console.log('‚úÖ Universal Sync Socket initialized');
    }
    
    function checkForChanges() {
        let hasChanges = false;
        
        Object.keys(STORAGE_KEYS).forEach(key => {
            const currentData = localStorage.getItem(STORAGE_KEYS[key]) || '[]';
            
            if (currentData !== lastState[key]) {
                hasChanges = true;
                lastState[key] = currentData;
                handleDataChange(key, JSON.parse(currentData));
            }
        });
        
        if (hasChanges) {
            triggerUIRefresh();
        }
    }
    
    function handleDataChange(key, data) {
        console.log(`üîÑ Data changed: ${key}`, data.length);
        
        // Trigger appropriate refresh based on key
        switch(key) {
            case 'members':
                if (typeof updateStats === 'function') updateStats();
                if (typeof renderMembers === 'function') renderMembers();
                break;
            case 'tasks':
                if (typeof loadTasks === 'function') loadTasks();
                if (typeof refreshPublicTasks === 'function') refreshPublicTasks();
                break;
            case 'activities':
                if (typeof loadActivities === 'function') loadActivities();
                if (typeof refreshPublicActivities === 'function') refreshPublicActivities();
                break;
            case 'values':
                if (typeof loadValues === 'function') loadValues();
                if (typeof refreshPublicValues === 'function') refreshPublicValues();
                break;
            case 'validations':
                if (typeof loadValidations === 'function') loadValidations();
                break;
            case 'notifications':
                if (typeof loadNotifications === 'function') loadNotifications();
                createNotificationPopup(data);
                break;
        }
    }
    
    function triggerUIRefresh() {
        // Update badge counts
        const currentMember = window.TauDB?.getCurrentMember();
        if (currentMember) {
            updateNotificationBadge();
            updateTaskBadge();
        }
        
        // Dispatch custom event for any listeners
        window.dispatchEvent(new CustomEvent('tauDataSync', {
            detail: { timestamp: Date.now() }
        }));
    }
    
    function updateNotificationBadge() {
        const currentMember = window.TauDB?.getCurrentMember();
        if (!currentMember) return;
        
        const notifs = JSON.parse(localStorage.getItem(STORAGE_KEYS.notifications) || '{}');
        const memberNotifs = notifs[currentMember.id] || [];
        const unread = memberNotifs.filter(n => !n.read).length;
        
        const badge = document.getElementById('tauNotifBadge');
        if (badge) {
            if (unread > 0) {
                badge.style.display = 'block';
                badge.textContent = unread;
            } else {
                badge.style.display = 'none';
            }
        }
    }
    
    function updateTaskBadge() {
        const tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.tasks) || '[]');
        const activities = JSON.parse(localStorage.getItem(STORAGE_KEYS.activities) || '[]');
        const values = JSON.parse(localStorage.getItem(STORAGE_KEYS.values) || '[]');
        
        const activeTasks = tasks.filter(t => t.validated).length;
        const activeActivities = activities.filter(a => a.validated).length;
        const activeValues = values.filter(v => v.validated && v.status === 'Approved').length;
        
        console.log(`üìä Active items - Tasks: ${activeTasks}, Activities: ${activeActivities}, Values: ${activeValues}`);
    }
    
    function createNotificationPopup(notifications) {
        const currentMember = window.TauDB?.getCurrentMember();
        if (!currentMember) return;
        
        const memberNotifs = notifications[currentMember.id] || [];
        const latest = memberNotifs.filter(n => !n.read).slice(0, 1)[0];
        
        if (latest && typeof showNotification === 'function') {
            showNotification(latest.title + ': ' + latest.message, 'info');
        }
    }
    
    // Start sync loop
    initSync();
    setInterval(checkForChanges, SYNC_INTERVAL);
    
    // Listen for storage events from other tabs/windows
    window.addEventListener('storage', function(e) {
        if (Object.values(STORAGE_KEYS).includes(e.key)) {
            console.log('üîÑ Storage event detected:', e.key);
            checkForChanges();
        }
    });
    
    console.log('üöÄ Real-time sync active');
})();
        </script>
    <script>
// ============================================
// NOTIFICATION GENERATOR
// ============================================
(function() {
    'use strict';
    
    window.createNotification = function(memberId, title, message, type = 'info') {
        const NOTIF_KEY = 'tauNotifications';
        const allNotifications = JSON.parse(localStorage.getItem(NOTIF_KEY) || '{}');
        
        if (!allNotifications[memberId]) {
            allNotifications[memberId] = [];
        }
        
        const notification = {
            id: `NOTIF-${Date.now()}`,
            title: title,
            message: message,
            timestamp: new Date().toISOString(),
            read: false,
            type: type
        };
        
        allNotifications[memberId].unshift(notification);
        
        // Keep only last 50 notifications
        if (allNotifications[memberId].length > 50) {
            allNotifications[memberId] = allNotifications[memberId].slice(0, 50);
        }
        
        localStorage.setItem(NOTIF_KEY, JSON.stringify(allNotifications));
        console.log(`üì¨ Notification created for ${memberId}:`, title);
    };
    
    window.notifyAllMembers = function(title, message) {
        const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
        members.forEach(member => {
            createNotification(member.id, title, message, 'info');
        });
        console.log(`üì¢ Broadcast notification sent to ${members.length} members`);
    };
})()
// ============================================
// INTEGRATION TEST SUITE
// ============================================
window.runIntegrationTest = function() {
    console.log('üß™ Starting Integration Test...');
    
    const tests = {
        storage: false,
        sync: false,
        notifications: false,
        opportunities: false
    };
    
    // Test 1: Storage
    try {
        localStorage.setItem('test', 'ok');
        tests.storage = localStorage.getItem('test') === 'ok';
        localStorage.removeItem('test');
    } catch(e) {
        console.error('‚ùå Storage test failed:', e);
    }
    
    // Test 2: Sync Socket
    tests.sync = typeof checkForChanges === 'function';
    
    // Test 3: Notifications
    tests.notifications = typeof createNotification === 'function';
    
    // Test 4: Opportunities
    tests.opportunities = typeof refreshPublicOpportunities === 'function';
    
    // Display results
    console.log('üìä Test Results:');
    console.log('Storage:', tests.storage ? '‚úÖ' : '‚ùå');
    console.log('Sync:', tests.sync ? '‚úÖ' : '‚ùå');
    console.log('Notifications:', tests.notifications ? '‚úÖ' : '‚ùå');
    console.log('Opportunities:', tests.opportunities ? '‚úÖ' : '‚ùå');
    
    const allPassed = Object.values(tests).every(t => t);
    
    if (allPassed) {
        showNotification('‚úÖ All integration tests passed!', 'success');
    } else {
        showNotification('‚ö†Ô∏è Some tests failed - check console', 'error');
    }
    
    return tests;
};

// Add test button to header (for debugging)
console.log('üí° Run window.runIntegrationTest() to check integration');
    </script>   
   
    <script>
// ============================================
// 1. KABIRU WITHDRAWAL FUNCTION
// ============================================
window.initiateKabiruWithdrawal = function() {
    const currentMember = window.TauDB?.getCurrentMember();
    
    if (!currentMember) {
        showNotification('‚ùå Please login first', 'error');
        return;
    }
    
    // Check balances
    const iKbpBalance = currentMember.iKbpBalance || 0;
    const iKbBalance = currentMember.iKbBalance || 0;
    
    // Minimum withdrawal: 10,000 iKbp OR 0.0001 iKb
    if (iKbpBalance < 10000 && iKbBalance < 0.0001) {
        showNotification('‚ùå Insufficient balance. Minimum: 10,000 iKbp or 0.0001 iKb', 'error');
        return;
    }
    
    // Create withdrawal modal
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = 
        '<div class="modal-content">' +
            '<span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>' +
            '<h2 style="text-align: center;">üí∏ Withdraw to Kabiru Mining</h2>' +
            '<div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">' +
                '<h3>Your Balances:</h3>' +
                '<p><strong>iKbp:</strong> ' + iKbpBalance.toLocaleString() + '</p>' +
                '<p><strong>iKb:</strong> ' + iKbBalance.toFixed(6) + '</p>' +
            '</div>' +
            '<form onsubmit="processKabiruWithdrawal(event)">' +
                '<div class="form-group">' +
                    '<label>Withdrawal Type *</label>' +
                    '<select name="withdrawalType" required>' +
                        '<option value="">Select type</option>' +
                        '<option value="iKbp">iKbp (Points)</option>' +
                        '<option value="iKb">iKb (Currency)</option>' +
                    '</select>' +
                '</div>' +
                '<div class="form-group">' +
                    '<label>Amount *</label>' +
                    '<input type="number" name="amount" step="0.0001" required>' +
                '</div>' +
                '<button type="submit" class="btn" style="width: 100%;">Confirm Withdrawal</button>' +
            '</form>' +
        '</div>';
    
    document.body.appendChild(modal);
};

window.processKabiruWithdrawal = function(event) {
    event.preventDefault();
    
    const formData = new FormData(event.target);
    const type = formData.get('withdrawalType');
    const amount = parseFloat(formData.get('amount'));
    
    const currentMember = window.TauDB?.getCurrentMember();
    if (!currentMember) return;
    
    // Validate amount
    if (type === 'iKbp' && amount > (currentMember.iKbpBalance || 0)) {
        showNotification('‚ùå Insufficient iKbp balance', 'error');
        return;
    }
    
    if (type === 'iKb' && amount > (currentMember.iKbBalance || 0)) {
        showNotification('‚ùå Insufficient iKb balance', 'error');
        return;
    }
    
    // Create transfer record in Firebase
    if (firebase && firebase.firestore) {
        const db = firebase.firestore();
        
        db.collection('kabiru_transfers').add({
            memberId: currentMember.id,
            memberName: currentMember.fullName,
            type: type,
            amount: amount,
            status: 'pending',
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            fromApp: 'TAU_AFRICA'
        })
        .then(() => {
            showNotification('‚úÖ Withdrawal request sent! Open Kabiru Mining to complete.', 'success');
            closeAllModals();
        })
        .catch(error => {
            console.error('Transfer error:', error);
            showNotification('‚ùå Transfer failed: ' + error.message, 'error');
        });
    } else {
        showNotification('‚ö†Ô∏è Firebase not available. Please try again.', 'error');
    }
};
    // ============================================
    // 2. ADD TRANSFER BUTTON TO DASHBOARD (Missing UI)
    // ============================================
    
    // Override showRealMemberDashboard to include transfer button
    const originalShowDashboard = window.showRealMemberDashboard;
    
    window.showRealMemberDashboard = function(member) {
        // Call original function first
        if (originalShowDashboard) {
            originalShowDashboard(member);
        }
        
        // Then add transfer section
        setTimeout(() => {
            const modal = document.querySelector('.modal.active, .modal[style*="display: block"]');
            if (!modal) return;
            
            const modalContent = modal.querySelector('.modal-content');
            if (!modalContent) return;
            
            // Check if transfer section already exists
            if (modalContent.querySelector('#kabiruTransferSection')) return;
            
            const currentMember = window.TauDB?.getCurrentMember() || member;
            
            // Create transfer section
            const transferSection = document.createElement('div');
            transferSection.id = 'kabiruTransferSection';
            transferSection.innerHTML = 
    '<div style="margin-top: 30px; padding: 20px; background: linear-gradient(45deg, #FFD700, #FFA500); border-radius: 15px; text-align: center;">' +
        '<h3 style="color: #333; margin-bottom: 15px;">üíé Kabiru Mining Transfer</h3>' +
        '<div style="background: rgba(0,0,0,0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">' +
            '<div style="font-size: 24px; font-weight: bold; color: #333;">' +
                ((currentMember.iKbpBalance || 0).toLocaleString()) + ' iKbp' +
            '</div>' +
            '<div style="font-size: 18px; color: #333; margin-top: 5px;">' +
                ((currentMember.iKbBalance || 0).toFixed(4)) + ' iKb' +
            '</div>' +
        '</div>' +
        '<button onclick="initiateKabiruWithdrawal()" class="btn" style="width: 100%; background: #333; color: #FFD700; font-size: 16px; padding: 15px;">' +
            'üí∏ Withdraw to Kabiru Mining' +
        '</button>' +
        '<p style="color: #333; font-size: 12px; margin-top: 10px;">' +
            'Minimum: 10,000 iKbp or 0.0001 iKb' +
        '</p>' +
    '</div>';
            
            
            // Insert before logout/close buttons
            const lastDiv = modalContent.querySelector('div[style*="grid-template-columns"]');
            if (lastDiv) {
                lastDiv.parentNode.insertBefore(transferSection, lastDiv);
            } else {
                modalContent.appendChild(transferSection);
            }
            
            console.log('‚úÖ Transfer button added to dashboard');
            
        }, 500);
    };
    
    // ============================================
    // 3. AUTO-SYNC COMPLETED TRANSFERS (Listener)
    // ============================================
    function setupTransferCompletionListener() {
        const db = firebase.firestore();
        if (!db) return;
        
        const currentMember = window.TauDB?.getCurrentMember();
        if (!currentMember) return;
        
        console.log('üëÇ Listening for transfer completions...');
        
        // Listen for when Kabiru Mining marks transfer as completed
        db.collection('members').doc(currentMember.id)
            .onSnapshot(doc => {
                if (!doc.exists) return;
                
                const data = doc.data();
                
                if (data.pendingKabiruTransfer && 
                    data.pendingKabiruTransfer.status === 'completed') {
                    
                    console.log('‚úÖ Transfer completed by Kabiru Mining!');
                    
                    // Update localStorage to remove pending transfer
                    const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
                    const memberIndex = members.findIndex(m => m.id === currentMember.id);
                    
                    if (memberIndex !== -1) {
                        members[memberIndex].pendingKabiruTransfer = null;
                        localStorage.setItem('tauAfricaDB', JSON.stringify(members));
                    }
                    
                    // Notify user
                    if (typeof createNotification === 'function') {
                        createNotification(
                            currentMember.id,
                            '‚úÖ Transfer Complete!',
                            'Your tokens have been received in Kabiru Mining App',
                            'success'
                        );
                    }
                    
                    showNotification('‚úÖ Transfer received in Kabiru Mining!', 'success');
                }
            }, error => {
                console.error('Transfer listener error:', error);
            });
    }
    
    // ============================================
    // 4. AUTO-START LISTENER ON LOGIN
    // ============================================
    
    // Hook into authentication
    const originalAuth = window.TauDB?.authenticate;
    if (originalAuth) {
        window.TauDB.authenticate = function(identifier, phoneLastFour) {
            const result = originalAuth.call(this, identifier, phoneLastFour);
            
            if (result.success) {
                // Start transfer completion listener
                setTimeout(() => {
                    setupTransferCompletionListener();
                }, 1000);
            }
            
            return result;
        };
    }
    
    // ============================================
    // 5. CHECK FOR PENDING TRANSFERS ON PAGE LOAD
    // ============================================
    function checkPendingTransfers() {
        const currentMember = window.TauDB?.getCurrentMember();
        if (!currentMember) return;
        
        if (currentMember.pendingKabiruTransfer && 
            currentMember.pendingKabiruTransfer.status === 'pending') {
            
            console.log('‚è≥ Pending transfer detected:', currentMember.pendingKabiruTransfer);
            
            showNotification(
                '‚è≥ Transfer pending: Open Kabiru Mining App to complete',
                'info'
            );
        }
    }
    
    // Check on load
    setTimeout(checkPendingTransfers, 2000);
    
    console.log('‚úÖ Kabiru Transfer System LOADED');
    console.log('üí° Users can now transfer TAU ‚Üí Kabiru Mining');
    
})();
</script>

<!-- ============================================ -->
<!-- VISUAL INDICATOR FOR PENDING TRANSFERS -->
<!-- ============================================ -->

<style>
/* Add pulsing indicator for pending transfers */
@keyframes transferPulse {
    0%, 100% { 
        box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
    }
    50% { 
        box-shadow: 0 0 0 10px rgba(255, 215, 0, 0);
    }
}

.pending-transfer-indicator {
    animation: transferPulse 2s infinite;
}
</style>

    <script>
     (function() {
    'use strict';
    
    console.log('üîç TAU Integration Health Check - Starting...');
    
    // ============================================
    // 1. CHECK STORAGE INTEGRITY
    // ============================================
    function checkStorage() {
        const requiredKeys = [
            'tauAfricaDB',
            'tauTasks',
            'tauActivities',
            'tauValues',
            'tauPendingValidations',
            'tauNotifications',
            'tauValidatorCodes'
        ];
        
        const issues = [];
        
        requiredKeys.forEach(key => {
            try {
                const data = localStorage.getItem(key);
                if (!data) {
                    localStorage.setItem(key, '[]');
                    console.log(`‚úÖ Created missing storage: ${key}`);
                }
                
                // Validate JSON
                JSON.parse(data || '[]');
                
            } catch (error) {
                issues.push(`‚ùå Storage error (${key}): ${error.message}`);
                localStorage.setItem(key, '[]'); // Reset if corrupted
            }
        });
        
        return {
            passed: issues.length === 0,
            issues: issues
        };
    }
    
    // ============================================
    // 2. CHECK CROSS-APP DATA FLOW
    // ============================================
    function checkDataFlow() {
        const tasks = JSON.parse(localStorage.getItem('tauTasks') || '[]');
        const activities = JSON.parse(localStorage.getItem('tauActivities') || '[]');
        const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
        
        const report = {
            members: members.length,
            tasks: tasks.length,
            activities: activities.length,
            validatedTasks: tasks.filter(t => t.validated).length,
            validatedActivities: activities.filter(a => a.validated).length
        };
        
        console.log('üìä Data Flow Status:', report);
        return report;
    }
    
    // ============================================
    // 3. CHECK FUNCTION AVAILABILITY
    // ============================================
    function checkFunctions() {
        const requiredFunctions = [
            'TauDB.sync',
            'TauDB.authenticate',
            'TauDB.addActivity',
            'TauDB.addTask',
            'createNotification',
            'showNotification',
            'refreshPublicOpportunities'
        ];
        
        const issues = [];
        
        requiredFunctions.forEach(funcPath => {
            const parts = funcPath.split('.');
            let obj = window;
            
            for (let part of parts) {
                if (!obj || typeof obj[part] === 'undefined') {
                    issues.push(`‚ùå Missing: ${funcPath}`);
                    return;
                }
                obj = obj[part];
            }
            
            console.log(`‚úÖ Available: ${funcPath}`);
        });
        
        return {
            passed: issues.length === 0,
            issues: issues
        };
    }
    
    // ============================================
    // 4. CHECK FIREBASE CONNECTION
    // ============================================
    function checkFirebase() {
        if (typeof firebase === 'undefined') {
            return {
                passed: false,
                message: '‚ùå Firebase library not loaded'
            };
        }
        
        if (!firebase.apps.length) {
            return {
                passed: false,
                message: '‚ùå Firebase not initialized'
            };
        }
        
        return {
            passed: true,
            message: '‚úÖ Firebase connected'
        };
    }
    
    // ============================================
    // 5. CHECK KABIRU INTEGRATION
    // ============================================
    function checkKabiruIntegration() {
        const issues = [];
        
        // Check if withdrawal function exists
        if (typeof initiateKabiruWithdrawal !== 'function') {
            issues.push('‚ùå Missing: initiateKabiruWithdrawal()');
        } else {
            console.log('‚úÖ Kabiru withdrawal function available');
        }
        
        // Check if mining link is intact
        const kabiruLinks = document.querySelectorAll('a[href*="https://magero1985.github.io/Kabiru-Mining-Portal-/"]');
        if (kabiruLinks.length === 0) {
            issues.push('‚ö†Ô∏è Warning: No Kabiru Mining links found');
        } else {
            console.log(`‚úÖ Found ${kabiruLinks.length} Kabiru Mining link(s)`);
        }
        
        return {
            passed: issues.length === 0,
            issues: issues
        };
    }
    
    // ============================================
    // 7. COMPREHENSIVE HEALTH CHECK
    // ============================================
    function runHealthCheck() {
        console.log('\n' + '='.repeat(60));
        console.log('üè• TAU AFRICA INTEGRATION HEALTH CHECK');
        console.log('='.repeat(60) + '\n');
        
        const results = {
            storage: checkStorage(),
            dataFlow: checkDataFlow(),
            functions: checkFunctions(),
            firebase: checkFirebase(),
            kabiru: checkKabiruIntegration()
        };
        
        console.log('\nüìã SUMMARY:');
        console.log('‚îÄ'.repeat(60));
        
        let allPassed = true;
        
        if (results.storage.passed) {
            console.log('‚úÖ Storage: HEALTHY');
        } else {
            console.log('‚ùå Storage: ISSUES FOUND');
            results.storage.issues.forEach(issue => console.log('  ' + issue));
            allPassed = false;
        }
        
        console.log(`‚úÖ Data Flow: ${results.dataFlow.members} members, ${results.dataFlow.tasks} tasks, ${results.dataFlow.activities} activities`);
        
        if (results.functions.passed) {
            console.log('‚úÖ Core Functions: ALL AVAILABLE');
        } else {
            console.log('‚ùå Core Functions: ISSUES FOUND');
            results.functions.issues.forEach(issue => console.log('  ' + issue));
            allPassed = false;
        }
        
        console.log(results.firebase.message);
        
        if (results.kabiru.passed) {
            console.log('‚úÖ Kabiru Integration: INTACT');
        } else {
            console.log('‚ö†Ô∏è Kabiru Integration: WARNINGS');
            results.kabiru.issues.forEach(issue => console.log('  ' + issue));
        }
        
        console.log('\n' + '='.repeat(60));
        
        if (allPassed) {
            console.log('üéâ ALL SYSTEMS OPERATIONAL');
            if (typeof showNotification === 'function') {
                showNotification('‚úÖ Integration Health Check: PASSED', 'success');
            }
        } else {
            console.log('‚ö†Ô∏è SOME ISSUES DETECTED (see details above)');
            if (typeof showNotification === 'function') {
                showNotification('‚ö†Ô∏è Integration check found issues - check console', 'info');
            }
        }
        
        console.log('='.repeat(60) + '\n');
        
        return results;
    }
    
    // ============================================
    // 8. AUTO-FIX COMMON ISSUES
    // ============================================
    function fixDuplicateBridges() {
    // Remove duplicate bridge links if any
    const bridges = document.querySelectorAll('a[href*="bridge.html"], button[onclick*="openAdminBridge"]');
    if (bridges.length > 1) {
        console.log(`‚ö†Ô∏è Found ${bridges.length} bridge links - removing duplicates`);
        for (let i = 1; i < bridges.length; i++) {
            bridges[i].remove();
        }
    }
}

function autoFix() {
    console.log('üîß Auto-fixing common issues...');
    
    fixDuplicateBridges(); // Now this function exists!
    checkStorage();
        
        // Ensure notification system exists
        if (!document.getElementById('notification')) {
            const notif = document.createElement('div');
            notif.id = 'notification';
            notif.className = 'notification';
            document.body.appendChild(notif);
            console.log('‚úÖ Created notification element');
        }
        
        console.log('‚úÖ Auto-fix complete');
    }
    
    // ============================================
    // 9. EXPOSE GLOBAL API
    // ============================================
    window.TauIntegration = {
        healthCheck: runHealthCheck,
        checkStorage: checkStorage,
        checkDataFlow: checkDataFlow,
        checkFunctions: checkFunctions,
        checkFirebase: checkFirebase,
        checkKabiru: checkKabiruIntegration,
        autoFix: autoFix
    };
    
    // ============================================
    // 10. RUN ON LOAD
    // ============================================
    autoFix();
    
    setTimeout(() => {
        runHealthCheck();
    }, 2000);
    
    console.log('‚úÖ TAU Integration Health Check loaded');
    console.log('üí° Run window.TauIntegration.healthCheck() anytime to check status');
    
})();
 </script>

    <script>    
// REAL-TIME SERVICE - MAIN APP VERSION
(function() {
    'use strict';
    
    window.realtimeService = {
        
        // Listen to YOUR OWN notifications
        subscribeToMyNotifications: function(memberId, callback) {
            if (!firebase || !firebase.firestore) return null;
            const db = firebase.firestore();
            
            return db.collection('notifications')
                .where('memberId', '==', memberId)
                .where('read', '==', false)
                .orderBy('timestamp', 'desc')
                .onSnapshot(callback);
        },
        
        // Listen to YOUR OWN transfer status
        subscribeToMyTransfers: function(memberId, callback) {
            if (!firebase || !firebase.firestore) return null;
            const db = firebase.firestore();
            
            return db.collection('kabiru_transfers')
                .where('memberId', '==', memberId)
                .orderBy('timestamp', 'desc')
                .limit(10)
                .onSnapshot(callback);
        },
        
        // Listen to YOUR OWN profile updates
        subscribeToMyProfile: function(memberId, callback) {
            if (!firebase || !firebase.firestore) return null;
            const db = firebase.firestore();
            
            return db.collection('members').doc(memberId)
                .onSnapshot(callback);
        },
        
        // Listen to public opportunities
        subscribeToOpportunities: function(callback) {
            if (!firebase || !firebase.firestore) return null;
            const db = firebase.firestore();
            
            return db.collection('values')
                .where('validated', '==', true)
                .where('status', '==', 'Approved')
                .orderBy('created', 'desc')
                .limit(20)
                .onSnapshot(callback);
        }
    };
    
    console.log('‚úÖ Real-time Service loaded');
})();
</script>
    <script>
// ============================================
// FIRESTORE QUERY IMPLEMENTATION - FINAL
// Add this to Main App (index.html)
// ============================================
(function() {
    'use strict';
    
    console.log('üî• Initializing Firestore Integration...');
    
    const db = firebase.firestore();
    
    // ============================================
    // REAL-TIME LISTENERS FOR MAIN APP
    // ============================================
    
    window.TauFirestoreSync = {
        
        // Start all listeners when user logs in
        startSync(memberId) {
            console.log('üéØ Starting Firestore sync for:', memberId);
            
            const listeners = [];
            
            // 1. Listen to YOUR notifications (Index 6)
            const unsubNotifs = db.collection('notifications')
                .where('memberId', '==', memberId)
                .where('read', '==', false)
                .orderBy('timestamp', 'desc')
                .onSnapshot(
                    snapshot => {
                        console.log('üì¨ Notifications update:', snapshot.size);
                        
                        const notifications = [];
                        snapshot.forEach(doc => {
                            notifications.push({ id: doc.id, ...doc.data() });
                        });
                        
                        // Update badge
                        const badge = document.getElementById('tauNotifBadge');
                        if (badge) {
                            badge.textContent = notifications.length;
                            badge.style.display = notifications.length > 0 ? 'block' : 'none';
                        }
                        
                        // Save to localStorage
                        const allNotifs = JSON.parse(localStorage.getItem('tauNotifications') || '{}');
                        allNotifs[memberId] = notifications;
                        localStorage.setItem('tauNotifications', JSON.stringify(allNotifs));
                        
                        // Show new notifications
                        if (notifications.length > 0 && typeof showNotification === 'function') {
                            const latest = notifications[0];
                            if (!latest.shown) {
                                showNotification(`${latest.title}: ${latest.message}`, 'info');
                            }
                        }
                    },
                    error => console.error('Notification listener error:', error)
                );
            
            listeners.push(unsubNotifs);
            
            // 2. Listen to YOUR pending transfers (Index 1)
            const unsubTransfers = db.collection('kabiru_transfers')
                .where('memberId', '==', memberId)
                .where('status', '==', 'pending')
                .orderBy('timestamp', 'desc')
                .onSnapshot(
                    snapshot => {
                        console.log('üí∏ Pending transfers:', snapshot.size);
                        
                        if (snapshot.size > 0 && typeof showNotification === 'function') {
                            showNotification(`‚è≥ ${snapshot.size} pending transfer(s) to Kabiru Mining`, 'info');
                        }
                        
                        const transfers = [];
                        snapshot.forEach(doc => {
                            transfers.push({ id: doc.id, ...doc.data() });
                        });
                        
                        localStorage.setItem('tauPendingTransfers', JSON.stringify(transfers));
                    },
                    error => console.error('Transfer listener error:', error)
                );
            
            listeners.push(unsubTransfers);
            
            // 3. Listen to YOUR profile updates (Direct doc)
            const unsubProfile = db.collection('members').doc(memberId)
                .onSnapshot(
                    doc => {
                        if (doc.exists) {
                            console.log('üë§ Profile updated from Firestore');
                            
                            const profileData = { id: doc.id, ...doc.data() };
                            
                            // Update localStorage
                            const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
                            const index = members.findIndex(m => m.id === memberId);
                            
                            if (index >= 0) {
                                members[index] = { ...members[index], ...profileData };
                                localStorage.setItem('tauAfricaDB', JSON.stringify(members));
                            }
                            
                            // Update session
                            sessionStorage.setItem('tauCurrentUser', JSON.stringify(profileData));
                            
                            // Trigger UI refresh
                            if (typeof updateStats === 'function') updateStats();
                        }
                    },
                    error => console.error('Profile listener error:', error)
                );
            
            listeners.push(unsubProfile);
            
            // 4. Listen to validated public values (Index 8)
            const unsubValues = db.collection('values')
                .where('status', '==', 'Approved')
                .orderBy('created', 'desc')
                .limit(20)
                .onSnapshot(
                    snapshot => {
                        console.log('üíé Public values:', snapshot.size);
                        
                        const values = [];
                        snapshot.forEach(doc => {
                            values.push({ id: doc.id, ...doc.data() });
                        });
                        
                        localStorage.setItem('tauPublicValues', JSON.stringify(values));
                        
                        // Refresh opportunities display
                        if (typeof refreshPublicValues === 'function') {
                            refreshPublicValues();
                        }
                    },
                    error => console.error('Values listener error:', error)
                );
            
            listeners.push(unsubValues);
            
            console.log('‚úÖ All Firestore listeners active');
            
            // Store unsubscribe functions
            window.tauFirestoreListeners = listeners;
            
            return listeners;
        },
        
        // Stop all listeners on logout
        stopSync() {
            console.log('üõë Stopping Firestore listeners...');
            
            if (window.tauFirestoreListeners) {
                window.tauFirestoreListeners.forEach(unsub => unsub());
                window.tauFirestoreListeners = null;
            }
        }
    };
    
    // ============================================
    // AUTO-START ON LOGIN
    // ============================================
    
    // Hook into existing authentication
    if (window.TauDB && window.TauDB.authenticate) {
        const originalAuth = window.TauDB.authenticate;
        
        window.TauDB.authenticate = function(identifier, phoneLastFour) {
            const result = originalAuth.call(this, identifier, phoneLastFour);
            
            if (result.success && result.member) {
                // Start Firestore sync
                setTimeout(() => {
                    window.TauFirestoreSync.startSync(result.member.id);
                }, 1000);
            }
            
            return result;
        };
    }
    
    // Hook into logout
    if (window.TauDB && window.TauDB.logout) {
        const originalLogout = window.TauDB.logout;
        
        window.TauDB.logout = function() {
            window.TauFirestoreSync.stopSync();
            return originalLogout.call(this);
        };
    }
    
    // ============================================
    // AUTO-START IF ALREADY LOGGED IN
    // ============================================
    
    setTimeout(() => {
        const currentMember = window.TauDB?.getCurrentMember();
        if (currentMember) {
            console.log('üîÑ Detected existing session, starting sync...');
            window.TauFirestoreSync.startSync(currentMember.id);
        }
    }, 2000);
    
    console.log('‚úÖ Firestore Integration Loaded');
    
})();
</script>
    <script>
        // Test rules are working
async function testRules() {
    console.log('üß™ Testing Firestore Rules...');
    
    const db = firebase.firestore();
    
    try {
        // Test 1: Read members (should work if authenticated)
        const snapshot = await db.collection('members').limit(1).get();
        console.log('‚úÖ Read members: OK');
        
        // Test 2: Write test doc (should work if authenticated)
        await db.collection('_test_').doc('test').set({ test: true });
        console.log('‚úÖ Write test: OK');
        
        // Test 3: Query with index (should work)
        const query = await db.collection('members')
            .where('team', '==', 'TASK')
            .orderBy('dateJoined', 'desc')
            .limit(1)
            .get();
        console.log('‚úÖ Index query: OK');
        
        alert('‚úÖ All rules tests passed!');
        
    } catch (error) {
        console.error('‚ùå Rules test failed:', error);
        alert('‚ùå Rules test failed: ' + error.message);
    }
}

testRules();
    </script>
</body>
                    
            </html>
